{"id":"bn-12d","title":"Implement graph centrality metrics (PageRank, betweenness, HITS, critical path)","description":"# Context\n\nThe triage engine computes multiple centrality metrics on the dependency graph to determine item priority. These metrics answer: \"what should I work on next?\" based on the structure of work, not human guesswork.\n\n# Goals\n\n- PageRank (incremental DF-PageRank when possible, full recompute fallback)\n- Betweenness centrality\n- HITS (hubs and authorities)\n- Eigenvector centrality\n- Critical path analysis (longest path in DAG, zero-slack items)\n- Cycle detection and reporting\n- Degree centrality (in/out)\n- Topological sort\n\n# Background\n\nPhase 1 (sync, < 20ms): degree centrality, topological sort, density.\nPhase 2 (incremental, cached): PageRank, betweenness, HITS, eigenvector, critical path, cycles.\n\nDF-PageRank (Sahu et al. 2024) tracks which vertices change rank after edge changes, only recomputes those. Falls back to full recompute when approximation/stability checks fail.\n\n# Implementation Approach\n\nUse petgraph for graph algorithms. Implement PageRank as iterative power method on adjacency matrix. Implement DF-PageRank as optimization layer. Betweenness via Brandes' algorithm. HITS via iterative hub/authority update. Critical path via longest-path on DAG (topological order + DP). Cache results with content hash of graph edges.\n\n## Files to Create/Modify\n\n- crates/bones-triage/src/metrics/pagerank.rs — PageRank + DF-PageRank\n- crates/bones-triage/src/metrics/betweenness.rs — Betweenness centrality\n- crates/bones-triage/src/metrics/hits.rs — HITS\n- crates/bones-triage/src/metrics/critical_path.rs — Critical path analysis\n- crates/bones-triage/src/metrics/basic.rs — Degree, topo sort, density\n- crates/bones-triage/src/metrics/mod.rs — Module and caching\n\n## Acceptance Criteria\n\n- [ ] PageRank converges for typical dependency graphs\n- [ ] DF-PageRank produces results within epsilon of full recompute\n- [ ] DF-PageRank falls back to full recompute when stability checks fail\n- [ ] Betweenness correctly identifies bridge nodes\n- [ ] Critical path correctly identifies zero-slack items\n- [ ] Cycle detection reports all cycles in the graph\n- [ ] All metrics cached and invalidated on graph changes\n- [ ] Benchmarks: metric computation time at Tier S/M/L\n\n# How This Serves Overarching Goals\n\n\"The graph knows priority.\" These metrics are the quantitative backbone of bn next and bn triage — computing priority from structure rather than human assignment.","acceptance_criteria":"PageRank (incremental + fallback); betweenness; HITS; eigenvector; critical path (longest path, zero-slack); cycle detection; degree centrality; topological sort","status":"open","priority":2,"issue_type":"epic","created_at":"2026-02-16T02:23:46.879473121Z","created_by":"bones-dev","updated_at":"2026-02-16T04:54:17.503135974Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["algorithms","graph","phase-2","triage"],"dependencies":[{"issue_id":"bn-12d","depends_on_id":"bn-30j","type":"blocks","created_at":"2026-02-16T02:27:06.966176041Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-12d","depends_on_id":"bn-7fz","type":"blocks","created_at":"2026-02-16T04:54:17.503089356Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-12d.1","title":"Implement static graph metrics: degree centrality, topological sort, density","description":"# Context\nPhase 1 metrics from the plan — synchronous, < 20ms. These are the baseline graph statistics computed on every triage invocation before incremental/cached metrics.\n\n# Implementation\n- `crates/bones-triage/src/metrics/basic.rs`\n- Degree centrality: in-degree + out-degree per node (via petgraph)\n- Topological sort: Kahn's algorithm on the condensation DAG\n- Graph density: edges / (nodes * (nodes-1))\n- Component count and sizes\n- All operate on the normalized graph from bn-30j\n\n# Acceptance Criteria\n- [ ] Degree centrality correct for known test graphs\n- [ ] Topological sort produces valid ordering (all deps before dependents)\n- [ ] Density computed correctly\n- [ ] All metrics < 20ms at Tier S (1k items)\n- [ ] Unit tests with hand-computed expected values on small graphs","acceptance_criteria":"Degree centrality (in-degree and out-degree) computed per node\nTopological sort of dependency DAG (blocks edges only)\nGraph density metric (edges / max possible edges)\nAll metrics computed synchronously in <20ms for Tier S\nUnit tests: known-topology graphs with hand-computed expected values","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:24:02.153562549Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:16.183819641Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["graph","phase-2","triage"],"dependencies":[{"issue_id":"bn-12d.1","depends_on_id":"bn-12d","type":"parent-child","created_at":"2026-02-16T04:24:02.153562549Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":58,"issue_id":"bn-12d.1","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:07Z"}]}
{"id":"bn-12d.2","title":"Implement DF-PageRank with incremental update and full-recompute fallback","description":"# Context\nPageRank identifies items that unblock the most downstream work. DF-PageRank (Desrosiers-Bhatt) supports incremental updates when the graph changes slightly, falling back to full recompute when approximation or stability checks fail.\n\n# Implementation\n- `crates/bones-triage/src/metrics/pagerank.rs`\n- Standard PageRank on condensation DAG (from bn-30j)\n- Incremental: when few edges change, update affected nodes only\n- Stability check: compare incremental result to full recompute periodically\n- If stability check fails, use full recompute result and log warning\n- Damping factor: 0.85 (configurable)\n- Convergence threshold: 1e-6\n\n# Acceptance Criteria\n- [ ] PageRank values correct for known test graphs\n- [ ] Incremental update matches full recompute on stable graphs\n- [ ] Fallback triggers when incremental diverges\n- [ ] Cached with content hash, invalidated on new events\n- [ ] Unit tests with hand-computed expected values","acceptance_criteria":"DF-PageRank (dependency-flow variant) computed on blocks graph\nIncremental update: recompute only affected neighborhood when graph changes\nStability check: verify incremental result within epsilon of full recompute\nAutomatic fallback to full recompute when stability check fails\nCache invalidation on new events (content hash check)\nUnit tests: known PageRank values on small graphs, incremental vs full equivalence","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:24:02.294981624Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:16.316885233Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["graph","phase-2","triage"],"dependencies":[{"issue_id":"bn-12d.2","depends_on_id":"bn-12d","type":"parent-child","created_at":"2026-02-16T04:24:02.294981624Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":59,"issue_id":"bn-12d.2","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:07Z"}]}
{"id":"bn-12d.3","title":"Implement betweenness centrality, HITS, and eigenvector centrality","description":"# Context\nAdditional centrality metrics that identify bottleneck items (betweenness), authoritative items (HITS authorities), and hub items (HITS hubs). Eigenvector centrality identifies items connected to other high-centrality items.\n\n# Implementation\n- `crates/bones-triage/src/metrics/betweenness.rs` — Brandes' algorithm\n- `crates/bones-triage/src/metrics/hits.rs` — HITS (hub/authority scores)\n- `crates/bones-triage/src/metrics/eigenvector.rs` — Power iteration\n- All operate on condensation DAG\n- Cached with content hash\n\n# Acceptance Criteria\n- [ ] Betweenness correct for known topologies (star, chain, diamond)\n- [ ] HITS hub/authority scores correct for known graphs\n- [ ] Eigenvector centrality converges for connected graphs\n- [ ] Graceful handling of disconnected components\n- [ ] Unit tests with hand-computed values","acceptance_criteria":"Betweenness centrality: fraction of shortest paths through each node\nHITS: hub and authority scores for each node\nEigenvector centrality: influence measure based on neighbor influence\nAll three metrics cached with graph content hash\nUnit tests: known-topology regression with hand-computed values","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:24:02.414344525Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:16.442268242Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["graph","phase-2","triage"],"dependencies":[{"issue_id":"bn-12d.3","depends_on_id":"bn-12d","type":"parent-child","created_at":"2026-02-16T04:24:02.414344525Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":60,"issue_id":"bn-12d.3","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:07Z"}]}
{"id":"bn-12d.4","title":"Implement critical path analysis and cycle detection","description":"# Context\nCritical path identifies the longest dependency chain (bottleneck). Items with zero slack are critical — any delay delays the whole project. Cycle detection identifies and reports dependency cycles.\n\n# Implementation\n- `crates/bones-triage/src/metrics/critical_path.rs`\n- Longest path in DAG (dp on topological order)\n- Slack computation: latest_finish - earliest_finish per item\n- Zero-slack items are critical path members\n- `crates/bones-triage/src/metrics/cycles.rs`\n- Cycle detection: DFS-based back-edge detection on original (non-condensation) graph\n- Report cycles with item IDs and suggested edges to break\n- bn cycles command output\n\n# Acceptance Criteria\n- [ ] Critical path correct for chain, diamond, parallel DAGs\n- [ ] Zero-slack items correctly identified\n- [ ] Cycles detected and reported with all participating items\n- [ ] Suggested edge removal to break cycles\n- [ ] Unit tests for each topology type","acceptance_criteria":"Critical path: longest path through dependency DAG to any leaf\nCritical path nodes flagged as bottlenecks in triage output\nCycle detection: identify all SCCs, report cycles with involved items\nHandles disconnected components (multiple independent subgraphs)\nUnit tests: known critical path on sample graphs, cycle detection accuracy","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:24:02.529104087Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:16.569423924Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["graph","phase-2","triage"],"dependencies":[{"issue_id":"bn-12d.4","depends_on_id":"bn-12d","type":"parent-child","created_at":"2026-02-16T04:24:02.529104087Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":61,"issue_id":"bn-12d.4","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:08Z"}]}
{"id":"bn-144","title":"Implement gated advanced topology analysis (spectral sparsification, path homology)","description":"# Context\n\nAdvanced graph analysis for large projects: spectral sparsification (approximate metrics on subgraph) and directed persistent path homology (topological health signatures). Both are gated behind precondition checks — they activate only when mathematically valid.\n\n# Goals\n\n- Spectral sparsification: construct subgraph preserving Laplacian within (1+e) factor\n- Only activated when directed-Laplacian preconditions met (Eulerian or approved mode)\n- Path homology: H0 (connected components), H1 (structural cycles with persistence scores)\n- Only activated via bn health --topology=advanced\n- Default health uses SCC/cycle diagnostics (always on, no gating)\n- Runtime checks emit \"preconditions not met\" with fallback\n\n# Implementation Approach\n\nSpectral sparsifier: BSS-style for undirected approximation of directed graph (symmetrize or eulerianize first). Path homology: compute directed path complex, boundary operators, homology groups. Both gated by graph property checks.\n\n## Files to Create/Modify\n\n- crates/bones-triage/src/topology/sparsify.rs — Spectral sparsification\n- crates/bones-triage/src/topology/homology.rs — Path homology\n- crates/bones-triage/src/topology/mod.rs — Gating and fallback logic\n\n## Acceptance Criteria\n\n- [ ] Sparsifier only activates when preconditions met\n- [ ] Sparsified metrics approximate full-graph metrics within epsilon\n- [ ] Path homology correctly identifies independent streams (H0) and structural cycles (H1)\n- [ ] Advanced mode opt-in only (--topology=advanced)\n- [ ] Default health diagnostics work without advanced math\n- [ ] Clear messages when preconditions not met\n\n# How This Serves Overarching Goals\n\n\"No other issue tracker on Earth does this.\" Advanced topology is the alien-level mathematics, but gated behind validity checks to avoid misleading results.","acceptance_criteria":"Spectral graph sparsification: reduce edge count while preserving metric approximations\nPath homology analysis for project health topology\nBoth analyses gated behind bn health --topology=advanced flag\nPrecondition checks: only run when graph meets size/density requirements\nClear output explaining what the analysis found and what it means\nUnit tests: known-topology regression, precondition gate behavior","status":"open","priority":4,"issue_type":"task","created_at":"2026-02-16T02:26:26.923160137Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:37.058634171Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["advanced","phase-4","topology","triage"],"dependencies":[{"issue_id":"bn-144","depends_on_id":"bn-12d","type":"blocks","created_at":"2026-02-16T02:27:08.730150560Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-144","depends_on_id":"bn-30j","type":"blocks","created_at":"2026-02-16T02:27:08.623140768Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-189","title":"CLI input validation and sanitization","description":"# Context\n\nInput validation is the first security boundary. This bead ensures malformed or unsafe CLI input is rejected before it can affect event/state layers.\n\n# Scope\n\n- Validate item IDs, actor identifiers, labels, and field length bounds\n- Validate dependency targets and state/flag combinations\n- Fuzz CLI parsing paths for robustness\n- Standardize validation error codes/messages for human + JSON modes\n\n# Acceptance Criteria\n\n- [ ] Invalid inputs are rejected pre-mutation with actionable messages\n- [ ] Validation behavior is deterministic across equivalent input forms\n- [ ] Fuzzing uncovers no crashes on user-reachable parse paths\n- [ ] JSON error responses include stable machine-readable codes\n- [ ] Coverage path is explicit: unit (validator/parser tests), e2e/workflow (bn-2yo + bn-3i7 invalid-input scenarios), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"Validate all CLI inputs before processing (titles, IDs, labels, agent names)\nReject empty titles, invalid ID formats, labels with special characters\nAgent name validation: non-empty, alphanumeric plus hyphens\nSize validation: must be one of xxs/xs/s/m/l/xl/xxl\nClear error messages for each validation failure\nUnit tests: valid inputs pass, each invalid input type caught","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:40:52.368437150Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:03.611842980Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-1","security"],"dependencies":[{"issue_id":"bn-189","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:41:27.468357968Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-189","depends_on_id":"bn-2lv","type":"parent-child","created_at":"2026-02-16T03:09:20.942847576Z","created_by":"1","metadata":"{}","thread_id":""}]}
{"id":"bn-1as","title":"Structural similarity and fusion backend for duplicate detection","description":"# Context\n\nThis bead builds the backend ranking machinery that powers high-quality duplicate detection once semantic vectors are available.\n\n# Scope\n\n- Structural similarity features (labels/deps/assignees/parent/graph proximity)\n- RRF fusion engine combining lexical, semantic, and structural candidate lists\n- Duplicate-risk scoring API with configurable thresholds\n- Explainability payloads (per-layer contributions) for downstream CLI surfaces\n\n# Out of Scope\n\n- CLI command UX wiring for `bn search`/`bn dup` (handled by bn-sgf)\n\n# Acceptance Criteria\n\n- [ ] Structural similarity signals are deterministic and test-covered\n- [ ] Fusion output quality beats lexical-only baseline on evaluation fixtures\n- [ ] Backend API exposes per-layer breakdowns for command output\n- [ ] Threshold configuration is externally controllable (config/env)\n- [ ] Coverage path is explicit: unit (backend similarity/fusion tests), e2e/workflow (bn-sgf + bn-2ly), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"Structural similarity (labels/deps/assignees/parent/graph); RRF fusion combines 3 layers; duplicate-risk API with thresholds; explainability payloads","status":"open","priority":2,"issue_type":"epic","created_at":"2026-02-16T02:25:20.784577275Z","created_by":"bones-dev","updated_at":"2026-02-16T04:56:03.423670816Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["dedup","fusion","phase-3","search"],"dependencies":[{"issue_id":"bn-1as","depends_on_id":"bn-2c5","type":"blocks","created_at":"2026-02-16T02:27:07.523501530Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1as","depends_on_id":"bn-30j","type":"blocks","created_at":"2026-02-16T02:27:07.635104538Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":86,"issue_id":"bn-1as","author":"bones-dev","text":"Decomposed into children: bn-3fg (structural similarity features) and bn-ihh (duplicate risk scoring API with RRF fusion).","created_at":"2026-02-16T04:56:03Z"}]}
{"id":"bn-1cr","title":"E2E onboarding workflows (install -> init -> first item)","description":"# Context\n\nFirst-run experience determines adoption. This bead validates installation and onboarding flows end-to-end so users can get value quickly without manual debugging.\n\n# Scope\n\n- Install path validation (`cargo install`/local install script)\n- `bn init` behavior in fresh and already-initialized repos\n- First-item workflow after init (`create` -> `list` -> `show`)\n- Common setup misconfiguration scenarios (missing actor, non-git directory)\n\n# Acceptance Criteria\n\n- [ ] Clean install + init + first-item flow succeeds on supported targets\n- [ ] Re-init behavior is safe and predictable\n- [ ] Setup errors are actionable and point to next command\n- [ ] Logs/diagnostics are preserved for onboarding failures\n\n# Coverage Path\n\n- Unit verification: bn-8hi, bn-1st.1\n- E2E/workflow verification: this bead\n- Diagnostic logging/artifacts: bn-1js, bn-m80\n","acceptance_criteria":"E2E test: bn init creates correct directory structure\nE2E test: fresh init -> bn create -> bn list -> bn show works\nE2E test: bn init in existing git repo works correctly\nE2E test: bn init refuses to overwrite existing .bones/\nFull workflow from install to first item creation","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T03:20:46.091247267Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:39.240128924Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cross-cutting","e2e","operations","phase-2","quality-gate","testing"],"dependencies":[{"issue_id":"bn-1cr","depends_on_id":"bn-1js","type":"blocks","created_at":"2026-02-16T03:20:53.441923075Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1cr","depends_on_id":"bn-1st","type":"parent-child","created_at":"2026-02-16T03:20:53.665546328Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1cr","depends_on_id":"bn-1st.1","type":"blocks","created_at":"2026-02-16T03:20:53.213664127Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1cr","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T03:20:53.323810264Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1cr","depends_on_id":"bn-8hi","type":"blocks","created_at":"2026-02-16T03:20:53.101374318Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1cr","depends_on_id":"bn-m80","type":"blocks","created_at":"2026-02-16T03:20:53.552703282Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-1d7","title":"Implement bn migrate-from-beads utility","description":"# Context\n\nMany users will migrate from beads to Bones. This utility reads a beads SQLite database or JSONL export and produces a valid Bones event log.\n\n# Goals\n\n- Read beads SQLite database or JSONL export\n- Map beads types/statuses/priorities to Bones equivalents\n- Preserve comments, labels, assignees, dependencies\n- Emit Bones events with original timestamps and actors\n- Build initial SQLite projection from migrated events\n\n# Background\n\nMappings from plan:\n- Types: bug->bug, feature/task/chore->task, epic->goal\n- Statuses: open->open, in_progress->doing, closed/verified/wontfix->done, deferred->open+punt\n- Priorities: P0->urgent, P1-P4->default\n- Dependencies: blocks->blocks, related->relates, parent-child preserved\n\n# Implementation Approach\n\nRead beads DB via rusqlite, iterate issues, emit item.create events with mapped fields, then emit item.link events for dependencies, then item.comment events for comments. Write to .bones/events/ in TSJSON format. Run projection build at the end.\n\n## Files to Create/Modify\n\n- crates/bones-cli/src/cmd/migrate.rs — Migration command\n\n## Acceptance Criteria\n\n- [ ] Successfully imports a beads database with all issue types\n- [ ] Type/status/priority mappings are correct\n- [ ] Dependencies preserved with correct link types\n- [ ] Comments preserved with original authors and timestamps\n- [ ] Labels preserved\n- [ ] Resulting event log is valid TSJSON\n- [ ] SQLite projection builds correctly from migrated events\n- [ ] Handles edge cases: empty database, issues with no title, circular deps\n\n# How This Serves Overarching Goals\n\nSmooth migration path from beads lowers the adoption barrier. Users don't lose their existing issue history.","acceptance_criteria":"Read beads SQLite database and/or JSONL export\nMap beads types to Bones kinds (bug->bug, feature/task/chore->task, epic->goal)\nMap beads statuses to Bones states (open->open, in_progress->doing, closed->done, deferred->open+punt)\nMap beads priorities to urgency (P0->urgent, P1-P4->default)\nPreserve comments, labels, assignees, dependencies\nEmit Bones events with original timestamps and agents\nUnit tests: map each type/status/priority, round-trip beads->bones->verify","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:23:46.658636498Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:48.777401972Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","migration","phase-1"],"dependencies":[{"issue_id":"bn-1d7","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:26:51.258161817Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-1js","title":"Structured logging and tracing foundation","description":"# Context\n\nConsistent structured logs are required for debugging, benchmarking, and automation observability. This bead establishes the shared logging foundation consumed by other diagnostics features.\n\n# Scope\n\n- Tracing spans for replay, merge, projection, search, and triage phases\n- Configurable log levels and structured JSON output mode\n- Correlation IDs/session metadata for cross-command analysis\n- Log schema conventions for downstream tooling compatibility\n\n# Acceptance Criteria\n\n- [ ] Core subsystems emit structured spans with consistent field names\n- [ ] Log-level controls behave predictably across commands\n- [ ] JSON logs are machine-parseable and schema-documented\n- [ ] Correlation metadata links multi-step workflows end-to-end\n- [ ] Coverage path is explicit: unit (logger init/schema tests), e2e/workflow (bn-1cr + bn-36d + bn-if2), diagnostics/log artifacts (this bead is the source)\n","acceptance_criteria":"Structured logging via tracing crate with configurable verbosity\nBONES_LOG env var controls log level (error/warn/info/debug/trace)\nLogs go to stderr, never to stdout (preserve output mode)\nTiming spans for key operations (replay, projection, triage)\nNo logging output by default (only on explicit opt-in)\nUnit tests: log level filtering, timing span output format","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:41:04.253011462Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:03.305541326Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["observability","phase-1"],"dependencies":[{"issue_id":"bn-1js","depends_on_id":"bn-2vb","type":"blocks","created_at":"2026-02-16T02:41:31.295173916Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1js","depends_on_id":"bn-42v","type":"parent-child","created_at":"2026-02-16T03:09:30.662961381Z","created_by":"1","metadata":"{}","thread_id":""}]}
{"id":"bn-1k5u","title":"[track] Phase 5 test suite: multi-agent scheduling, sync, TUI, aggregation","description":"Quality gate ensuring Phase 5 features work correctly. Covers: Whittle/fallback scheduling correctness, Prolly Tree sync convergence, TUI rendering and interaction, multi-repo aggregation accuracy.\n\n## Acceptance Criteria\n- Whittle Index tests: known-optimal assignment on small problems\n- Fallback scheduler tests: fairness and anti-duplicate constraints\n- Prolly Tree sync: two diverged replicas converge after sync\n- TUI tests: rendering correctness for all views (list, detail, triage, search)\n- Multi-repo tests: cross-repo aggregation and ranking\n- All tests pass in CI","acceptance_criteria":"All test children complete and passing\nWhittle and fallback scheduling tested with known-optimal solutions\nProlly Tree sync tested with diverged replicas\nTUI rendering tested for all views\nMulti-repo aggregation tested across repos\nAll tests pass in CI","status":"open","priority":3,"issue_type":"track","owner":"bones-dev","created_at":"2026-02-16T05:01:44.731796245Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:47.193994190Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-5","testing"],"dependencies":[{"issue_id":"bn-1k5u","depends_on_id":"bn-3bh","type":"blocks","created_at":"2026-02-16T05:01:49.733609441Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1k5u","depends_on_id":"bn-3p1","type":"blocks","created_at":"2026-02-16T05:01:49.949305959Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1k5u","depends_on_id":"bn-3w3","type":"blocks","created_at":"2026-02-16T05:01:49.517582995Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1k5u","depends_on_id":"bn-afb","type":"blocks","created_at":"2026-02-16T05:01:49.365873015Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-1k5u.1","title":"Multi-agent scheduling tests: Whittle and fallback correctness","description":"Test suite for multi-agent scheduling correctness.\n\n## Acceptance Criteria\n- Whittle Index produces optimal assignment on known small problems\n- Fallback activates when indexability fails\n- Fairness constraint enforced\n- Anti-duplicate assignment verified\n- Regime explanation accurate\n- Tests deterministic","acceptance_criteria":"Whittle Index produces optimal assignment on known small problems\nFallback activates when indexability fails\nFairness constraint enforced across test scenarios\nAnti-duplicate assignment verified\nRegime explanation output accurate\nTests deterministic with fixed seeds","status":"open","priority":3,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T05:01:56.418288170Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:47.323138149Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-5","testing"],"dependencies":[{"issue_id":"bn-1k5u.1","depends_on_id":"bn-1k5u","type":"parent-child","created_at":"2026-02-16T05:01:56.418288170Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1k5u.1","depends_on_id":"bn-afb","type":"blocks","created_at":"2026-02-16T05:01:59.748555572Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-1k5u.2","title":"Prolly Tree sync and multi-repo integration tests","description":"Integration test suite for Prolly Tree sync and multi-repo aggregation.\n\n## Acceptance Criteria\n- Two repos with diverged events sync via Prolly Tree and converge\n- Multi-repo aggregation shows items from all repos\n- Missing repo handled gracefully\n- Sync is idempotent\n- Tests deterministic","acceptance_criteria":"Two repos with diverged events sync via Prolly Tree and converge\nMulti-repo aggregation shows items from all repos correctly\nMissing repo handled gracefully (warning, not crash)\nSync is idempotent (re-sync produces no extra events)\nTests deterministic","status":"open","priority":3,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T05:02:06.434577826Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:47.452320862Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-5","testing"],"dependencies":[{"issue_id":"bn-1k5u.2","depends_on_id":"bn-1k5u","type":"parent-child","created_at":"2026-02-16T05:02:06.434577826Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1k5u.2","depends_on_id":"bn-3p1","type":"blocks","created_at":"2026-02-16T05:02:10.161048015Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1k5u.2","depends_on_id":"bn-3w3","type":"blocks","created_at":"2026-02-16T05:02:10.015931432Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-1ky","title":"Implement full deterministic simulation campaign with real CRDT logic","description":"# Context\n\nThe DST skeleton (Phase 0) was built against stubs. Now that the real CRDT logic exists (Phase 1), this bead wires the simulator to the actual merge implementations and runs comprehensive simulation campaigns.\n\n# Goals\n\n- Wire simulator to real CRDT merge functions\n- Run multi-agent convergence campaigns (1000+ rounds, 8+ agents)\n- Verify all 5 invariants with real logic\n- Nightly CI simulation campaigns with tracked metrics\n- Seed regression file for reproducing any failure\n- \"Sometimes\" assertions validated\n\n# Implementation Approach\n\nReplace stub merge functions in simulator with real bones-core CRDT logic. Configure fault injection probabilities for realistic scenarios. Run campaigns as integration tests with configurable round counts.\n\n## Files to Create/Modify\n\n- crates/bones-sim/src/ — Wire to real CRDT implementations\n- tests/simulation_campaigns.rs — Campaign test entry points\n- .github/workflows/simulation.yml — Nightly CI workflow\n\n## Acceptance Criteria\n\n- [ ] Simulator uses real CRDT merge logic\n- [ ] 1000+ round campaigns converge for all tested seeds\n- [ ] All 5 invariants verified with real logic\n- [ ] Nightly CI runs simulation campaigns\n- [ ] Seed regression tracks all failures\n- [ ] \"Sometimes\" assertions pass (interesting states reached)\n- [ ] Triage metric stability verified under concurrent mutations\n\n# How This Serves Overarching Goals\n\nThis graduates DST from a skeleton to a production-grade verification tool. The nightly campaigns provide continuous confidence that Bones' convergence guarantees hold.","acceptance_criteria":"TigerBeetle-style simulation with seeded deterministic RNG\nSimulated agents with independent event queues\nConfigurable network: latency, partition, reorder, duplication\nConfigurable clocks: drift, skew, freeze\nConvergence oracle: all replicas produce identical state after delivery\nInvariants checked: commutativity, idempotence, causal consistency, triage stability\n100+ seeds run in CI without failure","status":"open","priority":2,"issue_type":"epic","created_at":"2026-02-16T02:25:21.007271600Z","created_by":"bones-dev","updated_at":"2026-02-16T04:59:15.201467285Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-4","simulation","testing","verification"],"dependencies":[{"issue_id":"bn-1ky","depends_on_id":"bn-2ne","type":"blocks","created_at":"2026-02-16T02:27:08.075117550Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1ky","depends_on_id":"bn-2y3","type":"blocks","created_at":"2026-02-16T02:27:07.965359609Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":95,"issue_id":"bn-1ky","author":"bones-dev","text":"Decomposed into 3 children: bn-1ky.1 (simulated agents + network model), bn-1ky.2 (convergence oracle + invariant checkers), bn-1ky.3 (CI campaign runner). Children are chained: .1 -> .2 -> .3. Child .1 depends on bn-2ne (skeleton) and bn-2y3 (CRDT state machine).","created_at":"2026-02-16T04:59:15Z"}]}
{"id":"bn-1ky.1","title":"Implement simulated agents and configurable network model","description":"Extend the Phase 0 simulation skeleton (bn-2ne) with full agent simulation. Each simulated agent has independent event queue. Configurable network: latency injection, partition simulation, event reordering, event duplication. Seeded deterministic RNG for reproducibility.\n\n## Acceptance Criteria\n- Simulated agents generate events independently\n- Network model supports: latency, partition, reorder, duplication\n- All randomness seeded for deterministic replay\n- Seed replay produces identical execution\n- Unit tests: agent independence, each network fault type","acceptance_criteria":"Simulated agents generate events independently with own event queues\nNetwork model supports: latency injection, partition, reorder, duplication\nAll randomness seeded for deterministic replay\nSeed replay produces identical execution\nUnit tests: agent independence, each network fault type","status":"open","priority":2,"issue_type":"task","owner":"bob","created_at":"2026-02-16T04:58:51.393737527Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:26.260131661Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-4","simulation"],"dependencies":[{"issue_id":"bn-1ky.1","depends_on_id":"bn-1ky","type":"parent-child","created_at":"2026-02-16T04:58:51.393737527Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1ky.1","depends_on_id":"bn-2ne","type":"blocks","created_at":"2026-02-16T04:59:10.464553230Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1ky.1","depends_on_id":"bn-2y3","type":"blocks","created_at":"2026-02-16T04:59:11.441879334Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":96,"issue_id":"bn-1ky.1","author":"bones-dev","text":"Test plan: Unit tests for agent independence (agents produce events without coordination). Network fault tests: latency injection delays delivery, partition drops events between partitioned groups, reorder shuffles delivery order, duplication delivers same event twice. Determinism test: run same seed twice, compare full execution traces byte-for-byte.","created_at":"2026-02-16T04:59:24Z"}]}
{"id":"bn-1ky.2","title":"Implement convergence oracle and invariant checkers","description":"Oracle that verifies CRDT convergence after all events are delivered. Checks all 5 invariants from the plan: strong convergence (identical state across replicas), commutativity (any ordering yields same result), idempotence (duplicate events don't change state), causal consistency (dependent events maintain order), triage stability (metrics converge regardless of event ordering).\n\n## Acceptance Criteria\n- Strong convergence check: all replicas produce identical state\n- Commutativity check: shuffled event orderings yield same result\n- Idempotence check: duplicate events are no-ops\n- Causal consistency check: dependent events maintain order\n- Triage stability check: metrics converge\n- Each invariant violation produces clear diagnostic with failing state\n- Unit tests: known-passing and known-failing scenarios for each invariant","acceptance_criteria":"Strong convergence check: all replicas produce identical state\nCommutativity check: shuffled event orderings yield same result\nIdempotence check: duplicate events are no-ops\nCausal consistency check: dependent events maintain order\nTriage stability check: metrics converge regardless of ordering\nEach invariant violation produces clear diagnostic with failing state\nUnit tests: known-passing and known-failing scenarios for each invariant","status":"open","priority":2,"issue_type":"task","owner":"bob","created_at":"2026-02-16T04:58:59.528898728Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:26.392682100Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-4","simulation"],"dependencies":[{"issue_id":"bn-1ky.2","depends_on_id":"bn-1ky","type":"parent-child","created_at":"2026-02-16T04:58:59.528898728Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1ky.2","depends_on_id":"bn-1ky.1","type":"blocks","created_at":"2026-02-16T04:59:12.355346288Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":97,"issue_id":"bn-1ky.2","author":"bones-dev","text":"Test plan: Known-passing scenario: all replicas get same events in same order, oracle passes all 5 invariants. Known-failing scenarios: (1) divergent state -> strong convergence fails, (2) order-dependent merge -> commutativity fails, (3) non-idempotent merge -> idempotence fails, (4) causal violation -> causal consistency fails, (5) unstable metrics -> triage stability fails. Diagnostic output test: verify failure messages include full state diff.","created_at":"2026-02-16T04:59:28Z"}]}
{"id":"bn-1ky.3","title":"Implement CI simulation campaign runner","description":"Campaign runner that executes 100+ deterministic seeds across various graph topologies and agent counts. Reports: pass/fail per seed, first failing seed, invariant violation details. Integrates with CI (exit code 0/1). Configurable: seed range, agent count, item count, network fault probability.\n\n## Acceptance Criteria\n- Runs 100+ seeds without failure on correct implementation\n- Reports first failing seed with full replay instructions\n- CI integration: exit 0 on pass, exit 1 on fail with diagnostics\n- Configurable parameters via CLI flags or env vars\n- Campaign completes within 5 minutes in CI\n- Unit tests: campaign runner handles pass and fail cases","acceptance_criteria":"Runs 100+ seeds without failure on correct implementation\nReports first failing seed with full replay instructions\nCI integration: exit 0 on pass, exit 1 on fail with diagnostics\nConfigurable: seed range, agent count, item count, fault probability\nCampaign completes within 5 minutes in CI\nUnit tests: campaign runner handles pass and fail cases","status":"open","priority":2,"issue_type":"task","owner":"bob","created_at":"2026-02-16T04:59:07.257560309Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:26.521033845Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-4","simulation"],"dependencies":[{"issue_id":"bn-1ky.3","depends_on_id":"bn-1ky","type":"parent-child","created_at":"2026-02-16T04:59:07.257560309Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1ky.3","depends_on_id":"bn-1ky.2","type":"blocks","created_at":"2026-02-16T04:59:13.004525659Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":98,"issue_id":"bn-1ky.3","author":"bones-dev","text":"Test plan: Campaign pass test: 100 seeds with correct CRDT, all pass. Campaign fail test: inject known-buggy merge, verify first failing seed reported with replay instructions. CI integration test: verify exit codes (0 on pass, 1 on fail). Configuration test: vary seed range, agent count, item count via CLI flags. Performance test: 100 seeds complete within 5 minutes.","created_at":"2026-02-16T04:59:30Z"}]}
{"id":"bn-1nr","title":"Implement parent-child containment and dependency graph","description":"# Context\n\nBones has two orthogonal graph types: parent-child (containment — determines goal completion) and blocks/relates (dependencies — determines scheduling). This bead implements both, including the item.link, item.unlink events and the parent field on items.\n\n# Goals\n\n- Parent-child relationships via parent LWW field\n- Blocking dependencies via blocked_by OR-Set\n- Relates links via related_to OR-Set\n- Causation field on events (audit trail, not a graph edge)\n- Goal progress computation (done/total children)\n- Cycle detection in blocking graph\n\n# Implementation Approach\n\n## Key Components\n\n1. Parent field: LWW Register(nullable ItemId). Set via --parent flag or bn move --parent command.\n2. Blocking graph: directed graph from blocked_by OR-Sets. Used for triage, ready-work detection.\n3. Relates graph: undirected, informational only. Not used for scheduling.\n4. Causation: stored on events, queryable for \"why does this exist?\" chains.\n5. Cycle detection: DFS-based, run on link creation to warn (not block) about cycles.\n6. Progress: for a goal, count children by state, compute percentage.\n\n## Files to Create/Modify\n\n- crates/bones-core/src/graph/mod.rs — Graph structures\n- crates/bones-core/src/graph/blocking.rs — Blocking dependency graph\n- crates/bones-core/src/graph/hierarchy.rs — Parent-child tree\n- crates/bones-core/src/graph/cycles.rs — Cycle detection\n\n## Acceptance Criteria\n\n- [ ] Items can be parented under goals\n- [ ] Reparenting works (move item from one goal to another)\n- [ ] Blocking links created/removed via events\n- [ ] Relates links created/removed via events\n- [ ] Cycle detection warns on circular blocking dependencies\n- [ ] Goal progress accurately reflects children states\n- [ ] Cross-goal dependencies work (task in Goal A blocked by task in Goal B)\n- [ ] Causation chains are queryable\n\n# How This Serves Overarching Goals\n\nThis implements the \"goals are containers, not dependency roots\" design that solves beads' br ready confusion. Two orthogonal graphs = clear semantics.","acceptance_criteria":"All 3 children (1nr.1-1nr.3) complete and passing tests\nParent-child containment with goal auto-close/reopen working\nBlocking dependencies prevent items from appearing in ready work\nCycle detection catches and prevents circular blocks\nIntegration test: goal with children auto-closes when all done","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-16T02:23:08.983903894Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:22.085801667Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","dependencies","graph","phase-1"],"dependencies":[{"issue_id":"bn-1nr","depends_on_id":"bn-2h9","type":"blocks","created_at":"2026-02-16T04:25:35.411257823Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1nr","depends_on_id":"bn-3m6","type":"blocks","created_at":"2026-02-16T02:26:50.335644164Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1nr","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T02:26:50.442462286Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":14,"issue_id":"bn-1nr","author":"1","text":"Critical review pass: user value = correct ready-work and goal-progress behavior that users depend on daily. Failure modes = graph cycle mishandling, conflating containment and blocking semantics, and stale progress computation after reparenting. Alternative considered: single unified edge model; rejected because it mixes planning semantics and causes ambiguous scheduling behavior. Chosen approach: two explicit graphs (containment vs blocking/related) with cycle checks on dependency edges only. Coverage path: unit verification in-bead graph/cycle tests, e2e/workflow bn-yot.4 + bn-yot.5, diagnostics/log artifacts bn-m80 + bn-1js.","created_at":"2026-02-16T02:59:17Z"}]}
{"id":"bn-1nr.1","title":"Implement parent-child containment model and goal progress","description":"# Context\nParent field is an LWW Register (nullable ItemId). Goals contain children. Progress = done/total children count.\n\n# Implementation\n- `crates/bones-core/src/graph/hierarchy.rs`\n- Parent field on WorkItem (LWW nullable ItemId)\n- Set via --parent flag on create or bn move --parent\n- Goal progress: query children by parent_id, count by state\n- Nested goals: progress rolls up through tree\n- Adding child to closed goal reopens it (if auto_complete enabled)\n\n# Acceptance Criteria\n- [ ] Items parented under goals via item.update event\n- [ ] Reparenting moves item from one goal to another\n- [ ] Goal progress accurately reflects children states\n- [ ] Nested goal progress rolls up correctly\n- [ ] Reparenting to non-goal type rejected with error\n- [ ] Unit tests for progress computation","acceptance_criteria":"Parent-child edge stored in items table (parent_id column)\nGoal progress computation: count children by state, report percentage\nGoal auto-close: when last child reaches done, emit system event closing goal\nGoal auto-reopen: adding child to closed goal reopens it\nNested goals: progress rolls up through the tree\nConfig: goals.auto_complete true/false\nUnit tests: reparent, progress calculation, auto-close/reopen, nested rollup","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:24:27.366180833Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:31.665679459Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","graph","phase-1"],"dependencies":[{"issue_id":"bn-1nr.1","depends_on_id":"bn-1nr","type":"parent-child","created_at":"2026-02-16T04:24:27.366180833Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":55,"issue_id":"bn-1nr.1","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:07Z"}]}
{"id":"bn-1nr.2","title":"Implement blocking and relates dependency links","description":"# Context\nTwo orthogonal link types: blocks (scheduling) and relates (informational). Stored as OR-Sets of ItemIds.\n\n# Implementation\n- `crates/bones-core/src/graph/blocking.rs`\n- blocked_by: OR-Set<ItemId> — drives triage, ready-work detection\n- related_to: OR-Set<ItemId> — informational, no scheduling impact\n- item.link / item.unlink events manage both types\n- Causation field on events for audit trail (not a graph edge)\n- Cross-goal dependencies are valid\n\n# Acceptance Criteria\n- [ ] Blocking links created/removed via item.link/item.unlink events\n- [ ] Relates links created/removed independently\n- [ ] Cross-goal dependencies work correctly\n- [ ] Causation chains queryable from event data\n- [ ] OR-Set convergence for concurrent link/unlink\n- [ ] Unit tests for link operations","acceptance_criteria":"blocks link: A must complete before B can start\nrelates link: informational connection, no scheduling impact\nLinks stored in deps table with (from_id, to_id, link_type)\nAdd/remove link operations via item.link/item.unlink events\nOR-Set semantics: concurrent add+remove of same link converges\nUnit tests: add/remove links, concurrent link operations, query blocked items","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:24:27.488180359Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:31.801032608Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","graph","phase-1"],"dependencies":[{"issue_id":"bn-1nr.2","depends_on_id":"bn-1nr","type":"parent-child","created_at":"2026-02-16T04:24:27.488180359Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":56,"issue_id":"bn-1nr.2","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:07Z"}]}
{"id":"bn-1nr.3","title":"Implement dependency cycle detection and graph validation","description":"# Context\nBlocking deps form a directed graph. Cycles make items permanently stuck. Detection warns on link creation.\n\n# Implementation\n- `crates/bones-core/src/graph/cycles.rs`\n- DFS-based cycle detection on the blocking graph\n- Run on every item.link(blocks) event\n- Warn (don't block) — cycles are user error, not system error\n- Report: participating items and the newly added edge that closed the cycle\n\n# Acceptance Criteria\n- [ ] Cycle detected when closing a cycle via new link\n- [ ] Warning message includes cycle path (item IDs)\n- [ ] Self-loops detected\n- [ ] 2-node mutual block detected\n- [ ] Large cycles (10+ items) detected\n- [ ] Performance: O(V+E) per detection check","acceptance_criteria":"Cycle detection on blocks graph (blocks links only, not relates)\nPrevent adding a link that would create a cycle (return error with cycle path)\nbn cycles command lists all SCCs with >1 node\nGraph validation: orphaned references, self-links, invalid item IDs\nUnit tests: detect cycle, prevent cycle creation, report cycle path","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:24:27.613878738Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:31.946675699Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","graph","phase-1"],"dependencies":[{"issue_id":"bn-1nr.3","depends_on_id":"bn-1nr","type":"parent-child","created_at":"2026-02-16T04:24:27.613878738Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":57,"issue_id":"bn-1nr.3","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:07Z"}]}
{"id":"bn-1st","title":"[track] Operational readiness: installation, distribution, release process","description":"# Context\n\nOperational readiness turns working code into a usable tool. This track coordinates installability, release automation, compatibility policy, and onboarding reliability.\n\n# Track Outcomes\n\n- Users can install and run `bn` on supported platforms\n- Tagged releases are reproducible and automatically validated\n- Event-format compatibility policy is explicit and enforced\n- First-run onboarding flow is reliable\n\n# Exit Criteria\n\n- [ ] Child beads bn-1st.1, bn-1st.2, bn-1st.3, bn-1cr are completed\n- [ ] Release and onboarding docs are linked from primary project docs\n- [ ] Coverage path is explicit: unit (release/install scripts), e2e/workflow (bn-1cr), diagnostics/log artifacts (bn-1js + bn-m80)\n\n# Notes\n\nThis is a planning track; implementation happens in child beads.","acceptance_criteria":"All 3 children (1st.1-1st.3) complete\ncargo install bones-cli works from crates.io or git\nBinary releases available for major platforms\nCI pipeline tests, builds, and publishes on tag\nEvent format versioning policy documented","status":"open","priority":2,"issue_type":"track","created_at":"2026-02-16T02:38:33.302201891Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:02.917237897Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cross-cutting","operations","phase-2","track"],"dependencies":[{"issue_id":"bn-1st","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:38:33.809435461Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-1st.1","title":"Set up cargo install, binary releases, and installation instructions","description":"# Context\n\nUsers must be able to install and run `bn` without building from source manually. This bead delivers distribution artifacts and install guidance for supported platforms.\n\n# Scope\n\n- `cargo install` support from crates.io\n- Prebuilt binaries for Linux/macOS (x86_64 + arm64)\n- Release artifact packaging and checksum publication\n- Shell completions (bash/zsh/fish) and install instructions\n- Local developer install helper (`just install`)\n\n# Acceptance Criteria\n\n- [ ] `cargo install` yields a working `bn` binary\n- [ ] Release artifacts are available for supported targets with checksums\n- [ ] Shell completions generate and install cleanly\n- [ ] Local install helper works consistently across dev environments\n- [ ] Coverage path is explicit: unit (packaging scripts), e2e/workflow (bn-1cr onboarding flow), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"cargo install bones-cli works (crate published or installable from git)\nBinary releases for Linux x86_64, macOS x86_64, macOS aarch64\nInstallation instructions in README and --help output\nBinary is statically linked (no runtime dependencies except libc)\nUnit tests: installed binary responds to --version and --help","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:38:33.474084002Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:03.049753198Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cross-cutting","distribution","operations","phase-2"],"dependencies":[{"issue_id":"bn-1st.1","depends_on_id":"bn-1st","type":"parent-child","created_at":"2026-02-16T02:38:33.474084002Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1st.1","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:38:33.915573582Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-1st.2","title":"Implement CI release pipeline: test, build, publish on tag","description":"# Scope\n\n- GitHub Actions workflow triggered on version tags (v*)\n- Steps: test -> clippy -> build (cross-compile) -> publish to crates.io -> create GitHub Release -> attach binaries\n- Fail-on-any: if tests or clippy fail, no release\n- Changelog generation from beads/git log\n\n# Acceptance Criteria\n\n- [ ] Tag push triggers full release pipeline\n- [ ] Binaries published for all platforms\n- [ ] crates.io publish works\n- [ ] Release includes changelog","acceptance_criteria":"CI pipeline: run tests on every push/PR\nCI pipeline: build release binaries on tag\nCI pipeline: publish to crates.io on tag (or manual trigger)\nPipeline runs on GitHub Actions (or equivalent)\nBuild matrix: Linux x86_64, macOS x86_64, macOS aarch64","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:38:33.586814325Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:03.192333469Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["ci","cross-cutting","operations","phase-2","release"],"dependencies":[{"issue_id":"bn-1st.2","depends_on_id":"bn-1st","type":"parent-child","created_at":"2026-02-16T02:38:33.586814325Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1st.2","depends_on_id":"bn-yot","type":"blocks","created_at":"2026-02-16T02:38:34.018841033Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-1st.3","title":"Define event format versioning and backward compatibility policy","description":"# Scope\n\n- Event format version in shard header (# bones event log v1)\n- What happens when a new version of bn reads v1 events? (must always work)\n- What happens when an old version reads v2 events? (graceful error with upgrade suggestion)\n- Policy: new event types can be added without version bump (unknown types are warnings, not errors)\n- Policy: field additions to existing event data are non-breaking (unknown fields ignored)\n- Policy: field removals or semantic changes require version bump\n\n# Acceptance Criteria\n\n- [ ] Version policy documented in docs/spec/compatibility.md\n- [ ] Parser handles unknown event types gracefully (warn, don't crash)\n- [ ] Parser handles unknown data fields gracefully (ignore, don't crash)\n- [ ] Version mismatch produces actionable upgrade message","acceptance_criteria":"Event format version header in .events files (# bones event log v1)\nBackward compatibility policy: v1 events always readable by future versions\nVersion bump policy documented (when to increment, migration path)\nReader detects version mismatch and reports clear error\nUnit tests: version detection, compatibility check","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:38:33.700381547Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:03.321807539Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["compatibility","cross-cutting","operations","phase-2","spec"],"dependencies":[{"issue_id":"bn-1st.3","depends_on_id":"bn-1st","type":"parent-child","created_at":"2026-02-16T02:38:33.700381547Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1st.3","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:38:34.121471040Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-1t8","title":"ADR: Event file sharding strategy","description":"# Context\n\nShard strategy is a long-lived storage contract. Picking it early prevents parser/rebuild rework and avoids cross-repo merge pain once real history exists.\n\n# Decision Questions\n\n- Partition key: actor-sharded, time-sharded, or hybrid\n- Rotation trigger: fixed time window, size threshold, or dual trigger\n- File naming and discovery pattern (including deterministic sorting rules)\n- Ordering guarantees within a shard and across shards during replay\n- Merge/conflict behavior under concurrent multi-agent writes\n\n# Deliverables\n\n- ADR document in `docs/adr/` with context, options, decision, consequences\n- Normative naming convention and shard rotation policy\n- Deterministic shard discovery/replay algorithm (pseudocode + invariants)\n- Migration/backward-compatibility note for future format revisions\n\n# Acceptance Criteria\n\n- [ ] One strategy is selected with explicit rejection rationale for at least one alternative\n- [ ] Naming + rotation + replay ordering rules are implementation-ready (no ambiguous terms)\n- [ ] Conflict/merge implications are documented for git-native workflows\n- [ ] Decision is linked from bn-3rr.1 ADR index and referenced by bn-x2e\n- [ ] Coverage path is explicit: unit (bn-x2e shard parsing/discovery tests), e2e (bn-yot.3 replay scenarios), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"ADR documents: YYYY-MM monthly sharding, frozen shard policy, symlink convention\nADR covers: shard manifest format, rotation policy, git-friendliness rationale\nADR records alternatives considered (daily, weekly, size-based, item-based)\nDecision is self-contained (reader needs no external context)\nADR follows project ADR template format","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:42:57.347858033Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:01.409664705Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["adr","architecture","phase-0"],"comments":[{"id":2,"issue_id":"bn-1t8","author":"1","text":"Critical review revision: user value = reduce future data-migration pain by locking shard contract before parser/storage code lands. Risks = replay nondeterminism across shards, high merge-conflict frequency, and ambiguous rotation triggering partial-write bugs. Alternatives considered: actor-sharded and hybrid actor+time shards; rejected as defaults because they increase hot-file contention or discovery complexity for common single-repo workflows. Chosen default direction is time-sharded with deterministic ordering because it balances replay performance, merge ergonomics, and implementation simplicity.","created_at":"2026-02-16T02:58:09Z"},{"id":26,"issue_id":"bn-1t8","author":"bones-dev","text":"TERMINOLOGY UPDATE: 'actor-sharded' is now 'agent-sharded'. Consider file naming like YYYY-MM-agent.events or agent-only.events.","created_at":"2026-02-16T03:14:26Z"},{"id":28,"issue_id":"bn-1t8","author":"bones-dev","text":"DECISION PRE-MADE: The plan specifies time-sharded files: .bones/events/YYYY-MM.events with current.events symlink. Monthly rotation, frozen shards never modified. This ADR should document the decision and rejection rationale for alternatives (actor-sharded, size-based rotation), not re-decide. See ws/default/notes/plan.md 'File Organization: Time-Sharded' section.","created_at":"2026-02-16T04:23:32Z"}]}
{"id":"bn-1wo","title":"Implement bn similar command to find items similar to a given item","description":"bn similar <id> finds items most similar to a given item across all three search layers (lexical, semantic, structural). Consumes the fusion scoring API (bn-ihh). Shows ranked results with per-layer score breakdown. Supports --json.","acceptance_criteria":"bn similar <id> returns ranked similar items\nResults include per-layer scores (lexical, semantic, structural)\nResults include composite fusion score\nSupports --limit flag\nSupports --json output\nUnit tests for ranking accuracy","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T04:57:06.994068777Z","created_by":"bones-dev","updated_at":"2026-02-16T04:57:39.524710633Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-3","search"],"dependencies":[{"issue_id":"bn-1wo","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T04:57:32.128454417Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-1wo","depends_on_id":"bn-ihh","type":"blocks","created_at":"2026-02-16T04:57:31.648991210Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":88,"issue_id":"bn-1wo","author":"bones-dev","text":"Implementation must ship unit tests alongside the code.","created_at":"2026-02-16T04:57:39Z"}]}
{"id":"bn-1xs","title":"Implement optional git hooks for projection refresh and format checks","description":"# Context\nOptional git hooks that keep the local projection in sync and catch format issues.\n\n# Implementation\n- post-merge hook: trigger incremental projection refresh\n- pre-commit hook: validate event format in staged shard changes\n- Hooks are optional and idempotent\n- Installation via bn init --hooks or bn hooks install\n- Failure messages are actionable (not cryptic)","acceptance_criteria":"post-merge hook triggers incremental projection refresh\npre-commit hook validates event format in staged changes\nHooks are optional (system works without them)\nHooks are idempotent (safe to run multiple times)\nInstallation via bn hooks install, removal via bn hooks remove\nUnit tests: hook installation, format validation, idempotence","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:48:11.698277524Z","created_by":"bones-dev","updated_at":"2026-02-16T04:50:22.838405034Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["git","phase-2"],"dependencies":[{"issue_id":"bn-1xs","depends_on_id":"bn-2lz","type":"blocks","created_at":"2026-02-16T04:48:34.426063868Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":72,"issue_id":"bn-1xs","author":"bones-dev","text":"Implementation must ship unit tests alongside the code. Tests should be in the same PR/commit as the implementation.","created_at":"2026-02-16T04:50:22Z"}]}
{"id":"bn-1yo","title":"Set up ONNX Runtime and MiniLM-L6-v2 model loading","description":"# Context\nFirst step of semantic search: integrate the ONNX Runtime (ort crate) and load the int8-quantized MiniLM-L6-v2 model (~23MB).\n\n# Implementation\n- Add ort dependency with bundled ONNX Runtime\n- Model loading: find model file, load ONNX session, validate input/output shapes\n- Model location: .bones/models/minilm-l6-v2-int8.onnx (or bundled in binary)\n- Model download/install: bn model install or auto-download on first use\n- Graceful missing-model handling: detect absence, log warning, disable semantic search","acceptance_criteria":"ort crate integrated with bundled ONNX Runtime\nMiniLM-L6-v2 int8 model loads successfully (~23MB)\nInput/output tensor shapes validated on load\nModel location configurable (default: .bones/models/)\nGraceful handling when model file missing (warning + disable semantic)\nUnit tests: model loading, shape validation, missing model fallback","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:54:34.279709617Z","created_by":"bones-dev","updated_at":"2026-02-16T04:54:52.316811594Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-3","search","semantic"],"dependencies":[{"issue_id":"bn-1yo","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T04:54:51.717896490Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":81,"issue_id":"bn-1yo","author":"bones-dev","text":"Implementation must ship unit tests alongside the code.","created_at":"2026-02-16T04:54:52Z"}]}
{"id":"bn-201","title":"Create benchmark corpus and tiered SLO reporting framework","description":"# Context\n\nPerformance claims must be tied to repeatable benchmarks. Before implementation, we need a benchmark framework with synthetic datasets at multiple scales.\n\n# Goals\n\n- Define three benchmark tiers (S: 1k items/50k events, M: 10k/500k, L: 100k/5M)\n- Build synthetic dataset generator for each tier\n- Create benchmark harness tracking p50/p95/p99 latencies\n- Establish bytes-per-event reporting by event class\n\n# Implementation Approach\n\n## Key Components\n\n1. Dataset generator: realistic synthetic TSJSON event logs with varied event types, description lengths, dependency graph structures\n2. Benchmark harness: Criterion.rs-based, reporting p50/p95/p99 per operation\n3. Tier definitions: constants/configs for each tier\n4. CI stub: GitHub Actions workflow for benchmark trend tracking\n\n## Files to Create/Modify\n\n- benches/corpus.rs — Synthetic dataset generator\n- benches/operations.rs — Benchmark entry points\n- benches/report.rs — SLO reporting\n\n## Acceptance Criteria\n\n- [ ] Dataset generator produces valid TSJSON at all three tiers\n- [ ] Realistic distributions (event types, description lengths, dep graph structure)\n- [ ] Criterion.rs benchmarks compile and run (against stubs)\n- [ ] p50/p95/p99 reporting for tracked operations (create, next, search, rebuild)\n- [ ] Bytes-per-event reporting by event class\n- [ ] Deterministic generation (seeded)\n\n# How This Serves Overarching Goals\n\nBenchmark-driven development prevents overclaiming and catches regressions. Replaces fixed promises with measured, reproducible results.","acceptance_criteria":"Benchmark corpus generator for Tier S (1k items/50k events), Tier M (10k/500k), Tier L (100k/5M)\nCorpus includes realistic distribution of event types, agent counts, dependency patterns\nSLO reporting framework: measure and report p50/p95/p99 latencies per operation per tier\nTracked operations: bn create, bn next, bn search, bn rebuild, bytes/event\nResults stored in reproducible format for CI comparison\nUnit tests: corpus generator produces valid events, SLO reporter formats correctly","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:20:42.849819926Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:01.534609131Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["benchmarks","foundation","phase-0","testing"],"dependencies":[{"issue_id":"bn-201","depends_on_id":"bn-2vb","type":"blocks","created_at":"2026-02-16T02:26:33.587855534Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-201","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T03:43:31.340678186Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-20h","title":"[track] Phase 2 test suite: triage algorithm correctness and stability","description":"# Context\n\nTriage algorithms must produce stable, correct results. This track covers unit tests for each metric, regression tests for known graph topologies, and stability tests under graph perturbation.\n\n# Scope\n\n- Unit tests per metric (PageRank, betweenness, HITS, critical path)\n- Known-topology regression tests (hand-computed expected values)\n- Metric stability under small graph perturbations\n- DF-PageRank vs full-recompute equivalence tests\n- Composite score sanity tests (urgent items first, punted excluded)\n- Thompson Sampling convergence tests\n- Cycle detection completeness","acceptance_criteria":"All 3 test children (20h.1-20h.3) complete and passing\nTest suite covers graph metrics, PageRank, and composite scoring\nTests are deterministic (fixed graph topologies, no randomness)\nTests run in CI within 30 seconds","status":"open","priority":2,"issue_type":"track","created_at":"2026-02-16T02:36:58.038993557Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:26.649185148Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-2","testing","track","triage"],"dependencies":[{"issue_id":"bn-20h","depends_on_id":"bn-3hf","type":"blocks","created_at":"2026-02-16T02:36:58.568547079Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-20h.1","title":"Unit tests for graph metrics: known-topology regression with hand-computed values","description":"# Scope\n\nBuild 5-10 hand-crafted dependency graphs with known properties:\n- Linear chain (A->B->C->D): critical path = full chain, PageRank highest at root\n- Diamond (A->B, A->C, B->D, C->D): betweenness highest at A and D\n- Star (A->B, A->C, A->D, A->E): PageRank highest at A, degree centrality obvious\n- Disconnected components: verify independent streams detected\n- Single cycle: verify cycle detection reports it\n- Complete DAG (every node blocks every downstream node): transitive reduction should simplify\n\nFor each: compute expected metric values by hand, assert algorithm output matches within epsilon.\n\n# Acceptance Criteria\n\n- [ ] 5+ hand-crafted topologies with expected values\n- [ ] All metrics correct within epsilon for each topology\n- [ ] Regression file committed so future changes are caught","acceptance_criteria":"Hand-computed expected values for degree, betweenness, HITS on 3+ known topologies\nRegression tests: star graph, chain graph, diamond graph, disconnected components\nTests verify numeric precision within defined epsilon\nTests verify topological sort order correctness","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:36:58.227507492Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:26.783129688Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-2","regression","testing","triage"],"dependencies":[{"issue_id":"bn-20h.1","depends_on_id":"bn-12d","type":"blocks","created_at":"2026-02-16T02:36:58.673231856Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-20h.1","depends_on_id":"bn-20h","type":"parent-child","created_at":"2026-02-16T02:36:58.227507492Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-20h.2","title":"DF-PageRank equivalence tests: incremental vs full recompute on random graphs","description":"# Scope\n\nGenerate random dependency graphs (100-1000 nodes). Compute full PageRank. Add/remove single edges. Compute DF-PageRank incrementally. Verify results match full recompute within epsilon.\n\nVary graph properties: sparse vs dense, with/without cycles, deep chains vs wide fans.\n\n# Acceptance Criteria\n\n- [ ] 100+ random graphs tested\n- [ ] DF-PageRank matches full recompute within 1e-6 for all tested graphs\n- [ ] Fallback triggered correctly when stability check fails\n- [ ] Performance improvement measured (DF vs full recompute timing)","acceptance_criteria":"Incremental PageRank matches full recompute on random graphs within epsilon\nTest with add-edge, remove-edge, add-node mutations\nTest fallback trigger: verify full recompute fires when stability check fails\nProperty test: PageRank values sum to 1.0 (within epsilon)\nTest on at least 5 random graph topologies per seed","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:36:58.348898624Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:26.916632239Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["pagerank","phase-2","testing","triage"],"dependencies":[{"issue_id":"bn-20h.2","depends_on_id":"bn-12d","type":"blocks","created_at":"2026-02-16T02:36:58.780535921Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-20h.2","depends_on_id":"bn-20h","type":"parent-child","created_at":"2026-02-16T02:36:58.348898624Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-20h.3","title":"Composite score sanity tests: urgency overrides, punt exclusion, feedback learning","description":"# Scope\n\n- Urgent items always sort above non-urgent regardless of graph metrics\n- Punted items never appear in bn next results\n- Items with no deps but high urgency rank above items with many deps but default urgency\n- Thompson Sampling: after 100 bn did events for high-PageRank items, weights shift toward PageRank\n- Thompson Sampling: after 100 bn skip events for betweenness-central items, weights shift away\n\n# Acceptance Criteria\n\n- [ ] Urgency override verified for all ranking scenarios\n- [ ] Punt exclusion verified\n- [ ] Thompson Sampling weight adaptation verified directionally","acceptance_criteria":"Composite score respects urgency override (urgent items always rank highest)\nPunt items excluded from bn next output\nFeedback learning: bn did/bn skip events shift weight distributions\nSanity: score ordering is stable when graph is unchanged\nTest with mock feedback events and verify weight adaptation direction","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:36:58.459524423Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:27.040981991Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-2","scoring","testing","triage"],"dependencies":[{"issue_id":"bn-20h.3","depends_on_id":"bn-20h","type":"parent-child","created_at":"2026-02-16T02:36:58.459524423Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-20h.3","depends_on_id":"bn-sep","type":"blocks","created_at":"2026-02-16T02:36:58.892752983Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-21d","title":"Performance introspection and timing surfaces","description":"# Context\n\nPerformance regressions need visibility before users feel pain. This bead adds timing instrumentation and SLO-aware reporting for key command phases.\n\n# Scope\n\n- `bn --timing` output for parse/replay/project/query/render phases\n- Throughput and latency metrics for core operations\n- Threshold warnings against benchmark tiers\n- Persistable timing records for trend analysis\n\n# Acceptance Criteria\n\n- [ ] Timing output is deterministic, human-readable, and JSON-compatible\n- [ ] Reported values align with benchmark harness expectations\n- [ ] SLO warnings trigger only when thresholds are truly exceeded\n- [ ] Timing collection overhead is measured and bounded\n- [ ] Coverage path is explicit: unit (timing aggregation tests), e2e/workflow (bn-if2 + bn-36d timing runs), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"Timing surfaces for key operations: replay, projection, triage, search\nPerformance report: p50/p95/p99 latencies per operation\nAvailable via bn stats --timing or BONES_TIMING=1 env var\nNo overhead when timing is disabled\nUnit tests: timing data collected when enabled, absent when disabled","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:41:09.917801338Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:24.270146238Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["observability","performance","phase-2"],"dependencies":[{"issue_id":"bn-21d","depends_on_id":"bn-1js","type":"blocks","created_at":"2026-02-16T02:41:31.761088992Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-21d","depends_on_id":"bn-201","type":"blocks","created_at":"2026-02-16T02:41:31.883097410Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-21d","depends_on_id":"bn-42v","type":"parent-child","created_at":"2026-02-16T03:09:31.117437505Z","created_by":"1","metadata":"{}","thread_id":""}]}
{"id":"bn-21x","title":"Assignee and agent identity management","description":"# Context\n\nAssignment and agent identity are core coordination primitives for autonomous and human workflows. This bead adds assignment commands and a consistent agent-discovery model.\n\n# Scope\n\n- `bn assign <id> <agent>` / `bn unassign <id>` operations\n- Multi-assignee support via OR-Set semantics\n- `bn agents` inventory command with assignment/activity summaries\n- `bn mine` shortcut using resolved current-agent identity\n\n# Acceptance Criteria\n\n- [ ] Assignment add/remove converges correctly under concurrent edits\n- [ ] Agent identity resolution is deterministic and documented\n- [ ] `bn mine` behavior is stable across env/config combinations\n- [ ] `bn agents` output is accurate in human and JSON modes\n- [ ] Coverage path is explicit: unit (assignment/identity tests), e2e/workflow (bn-2yo), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"Agent identity resolution: --agent flag > AGENT env > BONES_AGENT env > config\nAgent string recorded in every mutating event\nbn agents lists all agents that have contributed events\nAgent identity is free-form (validated for non-empty, safe characters)\nUnit tests: resolution order, agent listing, validation","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:43:50.275283960Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:01.852625178Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","model","phase-2"],"dependencies":[{"issue_id":"bn-21x","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:44:07.643516152Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-21x","depends_on_id":"bn-2y3","type":"blocks","created_at":"2026-02-16T02:44:07.423737744Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-21x","depends_on_id":"bn-3m6","type":"blocks","created_at":"2026-02-16T02:44:07.535006703Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":22,"issue_id":"bn-21x","author":"bones-dev","text":"TERMINOLOGY UPDATE: 'actor' is now 'agent' throughout bones. bn agents (not bn actors) lists known agents. bn mine uses $BONES_AGENT or $AGENT. The event format field is 'agent' not 'actor'. All CLI flags use --agent.","created_at":"2026-02-16T03:14:19Z"}]}
{"id":"bn-23o","title":"Label namespace commands and inventory views","description":"# Context\n\nCore tagging (`bn tag`/`bn untag`) is in bn-2da. This bead provides the richer label namespace workflow needed for cleanup, analytics, and migration use cases.\n\n# Scope\n\n- Canonical label commands: `bn label add`, `bn label rm`, `bn labels`\n- Global label inventory with item counts and optional prefix filtering\n- Label normalization/validation rules (case strategy, whitespace, reserved chars)\n- Compatibility mapping between `tag` verbs and `label` namespace commands\n\n# Acceptance Criteria\n\n- [ ] Label add/remove converge correctly under concurrent edits\n- [ ] Global inventory reflects current projection state and counts accurately\n- [ ] Normalization rules are deterministic and documented\n- [ ] `tag` and `label` commands are behaviorally equivalent where expected\n- [ ] Coverage path is explicit: unit (label normalization + OR-Set tests), e2e/workflow (bn-2yo), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"bn labels lists all labels in use with item counts\nbn labels --namespace groups labels by prefix (e.g., area:backend, area:frontend)\nLabel autocomplete data available via --json for shell completion\nLabel inventory includes unused labels from config\nUnit tests: label listing, namespace grouping, count accuracy","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:42:31.912161605Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:42.640324219Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-2"],"dependencies":[{"issue_id":"bn-23o","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T03:13:39.003746786Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-23o","depends_on_id":"bn-2y3","type":"blocks","created_at":"2026-02-16T02:42:48.177567666Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-23o","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T02:42:48.294655301Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-251","title":"Implement arena allocator and mmap for zero-allocation hot paths","description":"# Context\n\nFor the triage engine hot paths (bn next, bn triage), avoid dynamic allocation. Arena allocator for event replay, mmap for binary event cache, pre-allocated graph structures.\n\n# Goals\n\n- Arena allocator (bumpalo) for event replay and graph construction\n- Memory-mapped binary cache file for zero-copy reads\n- Pre-allocated graph structures based on item count\n- Consistent low-latency for bn next\n\n# Implementation Approach\n\nUse bumpalo for arena allocation on hot paths. Use memmap2 for mmap of events.bin. Pre-allocate adjacency lists and metric arrays based on item count from cache header.\n\n## Files to Create/Modify\n\n- crates/bones-triage/src/alloc.rs — Arena-based graph construction\n- crates/bones-core/src/cache/mmap.rs — Memory-mapped cache reading\n\n## Acceptance Criteria\n\n- [ ] bn next uses arena allocation for graph construction\n- [ ] Binary cache read via mmap (zero-copy)\n- [ ] No heap allocation on the critical path (bn next)\n- [ ] Benchmark improvement measured at Tier M/L\n- [ ] No correctness regression from allocation changes\n\n# How This Serves Overarching Goals\n\nConsistent sub-millisecond latency for bn next at scale. The triage engine should feel instant.","acceptance_criteria":"Arena allocator (bumpalo) for event replay allocations\nmmap for binary event file access (memmap2)\nPre-allocated graph structures for triage computation\nBenchmark: zero-allocation hot path verified via allocator instrumentation\nPerformance improvement demonstrated on Tier M corpus vs baseline\nUnit tests: arena lifecycle, mmap read correctness","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-16T02:26:01.910525183Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:36.942215939Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["memory","performance","phase-4"],"dependencies":[{"issue_id":"bn-251","depends_on_id":"bn-30j","type":"blocks","created_at":"2026-02-16T02:27:08.515189743Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-251","depends_on_id":"bn-3h6","type":"blocks","created_at":"2026-02-16T02:27:08.404958265Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-26o","title":"Git integration: merge driver, hooks, and sync workflows","description":"# Context\n\n`bn init` ownership lives in bn-8hi. This bead adds git-native collaboration mechanics after initialization exists.\n\n# Scope\n\n- Git merge driver behavior for event shards (safe concat/order policy)\n- Optional git hooks: post-merge projection refresh, pre-commit format/integrity checks\n- `bn sync` workflows for pull/replay/push consistency guidance\n- `.gitattributes`/`.gitignore` integration for event vs cache artifacts\n\n# Out of Scope\n\n- Initial repository bootstrapping and directory creation (bn-8hi)\n\n# Acceptance Criteria\n\n- [ ] Merge driver preserves deterministic replay order under concurrent histories\n- [ ] Hooks are optional, idempotent, and failure messages are actionable\n- [ ] Sync workflow guidance handles diverged branches safely\n- [ ] Git metadata files are generated/updated without clobbering user customizations\n- [ ] Coverage path is explicit: unit (merge/ordering checks), e2e/workflow (bn-doc + bn-3i7 conflict scenarios), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"Git merge driver for event shards: safe concat preserving deterministic replay order\nOptional git hooks: post-merge projection refresh, pre-commit format check\nHooks are idempotent and failure messages are actionable\nbn sync guidance for pull/replay/push consistency\n.gitattributes and .gitignore entries managed by bn init\nUnit tests: merge driver produces correct output, hooks are idempotent","status":"open","priority":2,"issue_type":"epic","owner":"bones-dev","created_at":"2026-02-16T02:41:45.403698418Z","created_by":"bones-dev","updated_at":"2026-02-16T04:48:34.791020245Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["git","integration","phase-2"],"dependencies":[{"issue_id":"bn-26o","depends_on_id":"bn-1t8","type":"blocks","created_at":"2026-02-16T03:19:46.138741260Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-26o","depends_on_id":"bn-2vb","type":"blocks","created_at":"2026-02-16T02:42:03.390231955Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-26o","depends_on_id":"bn-8hi","type":"blocks","created_at":"2026-02-16T03:19:46.027251995Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-26o","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:42:03.274933959Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":64,"issue_id":"bn-26o","author":"bones-dev","text":"Decomposed into children: bn-2lz (merge driver), bn-1xs (git hooks), bn-6dv (sync workflow + gitattributes).","created_at":"2026-02-16T04:48:34Z"}]}
{"id":"bn-27p","title":"Output modes: human, JSON, and table","description":"# Context\n\nCLI output is both UI and API. This bead standardizes formatting modes so humans can scan quickly and agents can parse reliably.\n\n# Scope\n\n- Global format mode support: human, JSON, table/TSV\n- Deterministic field ordering and truncation rules by mode\n- TTY-aware defaults with explicit override flags\n- Shared formatter primitives for command reuse\n\n# Acceptance Criteria\n\n- [ ] All supported commands produce valid output in each mode\n- [ ] JSON mode is schema-stable and streaming-safe where applicable\n- [ ] Human/table modes remain legible for large result sets\n- [ ] Mode auto-detection never surprises explicit user flags\n- [ ] Coverage path is explicit: unit (formatter tests), e2e/workflow (bn-2yo + bn-36d + bn-if2), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"Human-readable text output as default mode for all commands\nJSON output via --json flag producing structured, machine-parseable output\nTable output mode for list-style commands (aligned columns)\nOutput mode selection: --json flag or BONES_OUTPUT env var\nAll output modes go to stdout, errors to stderr\nUnit tests: same data renders correctly in all three modes","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:41:48.452792851Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:02.972555173Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-1","ux"],"dependencies":[{"issue_id":"bn-27p","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:42:03.497876724Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-298","title":"Implement shard manifests and bn verify command","description":"# Context\n\nEach time-sharded .events file needs a companion manifest recording event count, root Merkle hash, and byte length. On startup, Bones verifies manifests before replaying events, detecting corruption before it reaches the projection.\n\n# Goals\n\n- Generate manifest for each shard (event count, Merkle root hash, byte length)\n- Verify manifests on startup/rebuild\n- Implement bn verify command for manual integrity checking\n- Handle manifest-missing gracefully (regenerate from shard)\n\n# Implementation Approach\n\n## Key Components\n\n1. Manifest file: .bones/events/YYYY-MM.manifest (TOML or JSON, committed to git alongside .events)\n2. Manifest generation: computed when shard is frozen (end of month) or on demand\n3. Startup verification: compare manifest against shard, warn on mismatch\n4. bn verify: check all shards, report integrity status, optionally regenerate manifests\n\n## Files to Create/Modify\n\n- crates/bones-core/src/shard.rs — Extend with manifest support\n- crates/bones-core/src/verify.rs — Verification logic\n\n## Acceptance Criteria\n\n- [ ] Manifests generated for frozen shards\n- [ ] Startup detects shard corruption via manifest mismatch\n- [ ] bn verify reports per-shard integrity status\n- [ ] Missing manifests regenerated without error\n- [ ] Injected corruption detected before projection build\n\n# How This Serves Overarching Goals\n\nShard manifests add tamper evidence and corruption detection to the git-native event log, strengthening the Merkle-DAG integrity guarantees.","acceptance_criteria":"Manifests written per shard with event count and Merkle hash; bn verify checks all manifests; corruption detected before replay; report integrity status","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:23:09.073885417Z","created_by":"bones-dev","updated_at":"2026-02-16T04:08:01.148252291Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","integrity","phase-1","verification"],"dependencies":[{"issue_id":"bn-298","depends_on_id":"bn-2o3","type":"blocks","created_at":"2026-02-16T02:26:50.702432500Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-298","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:26:50.557516702Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":15,"issue_id":"bn-298","author":"1","text":"Critical review pass: user value = early corruption detection before bad shards poison projection or user trust. Failure modes = false positives from nondeterministic hashing, false negatives from incomplete coverage, and recovery paths that leave users blocked. Alternative considered: rely only on replay-time parser errors; rejected because it detects corruption too late and with weak diagnostics. Chosen approach: explicit shard manifests +  integrity command. Coverage path: unit verification in-bead manifest/hash tests, e2e/workflow bn-36d and bn-3fs.2 fault scenarios, diagnostics/log artifacts bn-m80 + bn-1js.","created_at":"2026-02-16T02:59:23Z"},{"id":16,"issue_id":"bn-298","author":"1","text":"Critical review revision (corrected): user value = detect shard corruption before replay so users get deterministic recovery guidance. Main risks = nondeterministic manifest hashing, incomplete verification coverage, and unclear remediation steps. Alternative considered: parser-only corruption detection during replay; rejected because detection is late and diagnostics are weak. Chosen approach: explicit per-shard manifests plus verify command with remediation output. Coverage path: unit verification in-bead manifest/hash tests, e2e/workflow bn-36d and bn-3fs.2 fault scenarios, diagnostics/log artifacts bn-m80 + bn-1js.","created_at":"2026-02-16T02:59:29Z"}]}
{"id":"bn-29r","title":"Project stats and reporting commands","description":"# Context\n\nProject-level reporting helps teams and agents evaluate flow health and detect stagnation. This bead implements stats/reporting outputs over the projection model.\n\n# Scope\n\n- `bn stats` summaries by status/kind/urgency\n- Time-window metrics (opened/closed velocity, aging/staleness)\n- Actor activity rollups and dependency-shape summaries\n- Human and `--json` output modes\n\n# Acceptance Criteria\n\n- [ ] Reported metrics match source projection data for test fixtures\n- [ ] Time-window calculations are deterministic and timezone-safe\n- [ ] JSON output is stable for dashboard automation\n- [ ] Large-project stats execute within documented latency bounds\n- [ ] Coverage path is explicit: unit (aggregation/query tests), e2e/workflow (bn-3ls), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"bn stats reports: item counts by state/kind, event counts by type/agent, shard sizes\nbn stats --json produces machine-readable output\nStatistics computed from SQLite projection (not event replay)\nHandles empty repos gracefully (zero counts, not errors)\nUnit tests: stats accuracy on known corpus","status":"open","priority":3,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:43:58.188549167Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:28.160057201Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-3","ux"],"dependencies":[{"issue_id":"bn-29r","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:44:08.180177031Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-29r","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T02:44:08.071531356Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-2a7","title":"bn search and bn dup commands (lexical baseline)","description":"# Context\n\nUsers need searchable work immediately; waiting for semantic infrastructure delays obvious value. This bead delivers a reliable lexical baseline command surface first.\n\n# Scope\n\n- `bn search <query>` using SQLite FTS5/BM25 lexical ranking\n- `bn dup <id>` using lexical candidate retrieval + simple threshold heuristic\n- Output modes: concise human view and stable `--json` schema\n- Deterministic ranking ties and pagination behavior\n\n# Out of Scope\n\n- Semantic embeddings and structural fusion upgrades (handled by bn-2c5 + bn-1as + bn-sgf)\n\n# Acceptance Criteria\n\n- [ ] `bn search` returns relevant lexical matches with deterministic ordering\n- [ ] `bn dup` returns explainable lexical candidates for an item\n- [ ] JSON outputs are stable and parseable for automation\n- [ ] Error handling for empty/corrupt indexes is actionable\n- [ ] Coverage path is explicit: unit (query/threshold tests), e2e/workflow (bn-36d), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"bn search <query> performs FTS5 lexical search with BM25 ranking\nbn dup <id> finds items similar to a given item (lexical baseline)\nResults include match score and highlighted matches\nSupports --limit for result count\nJSON output mode with scores\nUnit tests: keyword search, dup detection, ranking order","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:43:19.951627462Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:43.202224093Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-2","search"],"dependencies":[{"issue_id":"bn-2a7","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:43:33.780648748Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2a7","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T03:17:22.405105097Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-2c5","title":"Integrate MiniLM-L6-v2 ONNX embedding model for semantic search","description":"# Context\n\nSemantic search bridges the vocabulary gap that causes duplicate issues. \"auth timeout\" must match \"authentication fails after 30 seconds.\" This requires embedding items as 384-dim vectors and doing cosine similarity search.\n\n# Goals\n\n- Integrate all-MiniLM-L6-v2 via ONNX Runtime (ort crate)\n- int8 quantized model (~23MB)\n- Compute embeddings on create/update (lazy, ~5ms per item)\n- Store embeddings in sqlite-vec extension\n- KNN search via sqlite-vec\n- bn search --semantic for semantic-only search\n- Graceful degradation: FTS5-only fallback if model unavailable\n\n# Background\n\nEmbedding input: \"{title}. {description_first_500_chars}. Labels: {labels_joined}. Kind: {kind}.\"\nsqlite-vec: KNN brute-force, pure C, works inside SQLite. Pre-v1 but widely used.\n\n# Implementation Approach\n\n## Key Components\n\n1. Model management: download on first use or ship with binary. bn setup --download-model.\n2. Embedding computation: ort crate for ONNX inference. Tokenize input, run model, get 384-dim f32 vector.\n3. sqlite-vec storage: CREATE VIRTUAL TABLE items_vec USING vec0(item_id TEXT, embedding FLOAT[384])\n4. KNN search: query with embedding vector, get top-K by distance\n5. Fallback: if model not available, skip semantic layer, use FTS5 only\n\n## Files to Create/Modify\n\n- crates/bones-search/src/embed.rs — ONNX model loading and inference\n- crates/bones-search/src/vec_store.rs — sqlite-vec integration\n- crates/bones-search/src/semantic.rs — Semantic search queries\n\n## Acceptance Criteria\n\n- [ ] Model loads and produces embeddings\n- [ ] Embeddings stored in sqlite-vec\n- [ ] KNN search returns semantically similar items\n- [ ] \"auth timeout\" matches \"authentication fails after 30 seconds\" (cosine > 0.8)\n- [ ] Embedding computed on create/update in ~5ms\n- [ ] Graceful fallback when model unavailable\n- [ ] bn rebuild re-embeds all items\n- [ ] Benchmarks: embedding time, KNN search time at Tier S/M\n\n# How This Serves Overarching Goals\n\nThis solves the duplicate problem that plagued beads. Agents filing \"the same bead five times\" becomes structurally impossible when semantic similarity catches vocabulary-gap matches.","acceptance_criteria":"MiniLM-L6-v2 int8 ONNX loads via ort; embeddings computed ~5ms/item; stored in sqlite-vec; KNN search works; FTS5-only fallback when model unavailable","status":"open","priority":2,"issue_type":"epic","created_at":"2026-02-16T02:24:29.771691619Z","created_by":"bones-dev","updated_at":"2026-02-16T04:54:52.196581463Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["embeddings","phase-3","search","semantic"],"dependencies":[{"issue_id":"bn-2c5","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T02:27:07.417419477Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":80,"issue_id":"bn-2c5","author":"bones-dev","text":"Decomposed into children: bn-1yo (ONNX setup + model loading), bn-vpa (embedding pipeline + sqlite-vec), bn-2j7 (KNN vector search).","created_at":"2026-02-16T04:54:52Z"}]}
{"id":"bn-2ce","title":"Dependency workflow commands (dep add/rm/list/tree)","description":"# Context\n\nDependency workflows are where planning quality lives or dies. This bead implements explicit dependency commands on top of core CLI scaffolding, including safety checks and visibility tools.\n\n# Scope\n\n- `bn dep add <blocked> <blocker>` / `bn dep rm <blocked> <blocker>`\n- `bn dep list <id>` showing incoming/outgoing blockers\n- `bn dep tree <id>` for transitive dependency visualization\n- Backward-compatible aliases for legacy verbs (`bn link`/`bn unlink --blocks`)\n- Cycle handling policy: detect and report with clear remediation guidance\n\n# Out of Scope\n\n- Project-level critical path ranking is handled by triage commands (bn-3hf / bn-12d)\n\n# Acceptance Criteria\n\n- [ ] Add/remove dependency commands emit correct events and converge in projection\n- [ ] `bn dep list` and `bn dep tree` reflect transitive state accurately\n- [ ] Circular dependencies are detected and reported deterministically\n- [ ] Alias behavior (`link`/`unlink`) maps cleanly to `dep` commands\n- [ ] Coverage path is explicit: unit (graph mutation + cycle detection tests in this bead), e2e/workflow (bn-3i7), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"bn dep add <from> --blocks <to> adds blocking dependency\nbn dep rm <from> <to> removes dependency link\nbn dep list <id> shows all deps (blocks and relates) for an item\nbn dep tree <id> shows recursive dependency tree\nAll commands support --json output\nUnit tests: add/remove deps, list, tree traversal, cycle prevention","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:42:29.210420283Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:42.474516381Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","graph","phase-2"],"dependencies":[{"issue_id":"bn-2ce","depends_on_id":"bn-1nr","type":"blocks","created_at":"2026-02-16T02:42:47.960816982Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2ce","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T03:08:00.192876008Z","created_by":"1","metadata":"{}","thread_id":""}]}
{"id":"bn-2da","title":"Implement core CLI lifecycle commands (create, list, show, do, done, tag, move)","description":"# Context\n\nDeliver first user value fast: users and agents can create, inspect, and move work through the core lifecycle with stable machine-readable output. Keep this bead intentionally narrow so it lands early and de-risks later command families.\n\n# Goals\n\n- Implement lifecycle commands: `bn create`, `bn list`, `bn show`, `bn do`, `bn done`, `bn tag`/`bn untag`, `bn move --parent`\n- Support `--json` for every command in scope with stable key contracts\n- Ensure mutating commands append TSJSON events and projection reads stay consistent\n- Return actionable, non-ambiguous errors for invalid transitions and missing IDs\n\n# Out of Scope (covered elsewhere)\n\n- Dependency workflow commands (`link`/`unlink`/`dep`) -> bn-2ce\n- `bn verify` -> bn-298\n- `bn rebuild` incremental/full controls -> bn-36a\n- `bn stats` -> bn-29r\n- `bn export` -> bn-3ju\n- `bn search`/`bn dup` -> bn-2a7\n- `bn history`/`bn log` -> bn-v45\n- Goal progress command/reporting -> bn-3lp\n\n# Implementation Approach\n\nUse clap derive with one module per command group and a shared output layer for text/JSON parity. Read paths come from projection queries; write paths emit domain events via bones-core.\n\n## Files to Create/Modify\n\n- crates/bones-cli/src/main.rs\n- crates/bones-cli/src/cmd/\n- crates/bones-cli/src/output.rs\n\n## Acceptance Criteria\n\n- [ ] All commands in scope work for happy path and common user mistakes\n- [ ] `--json` output is valid and stable for every command in scope\n- [ ] Invalid transitions and unknown IDs return actionable remediation text\n- [ ] Event appends and projection reads remain consistent across command sequences\n- [ ] Coverage path is explicit: unit (command parser/handler tests in this bead), e2e/workflow (bn-yot.4), diagnostics/logging artifacts (bn-1js + bn-m80)\n\n# Why This Scope\n\nNarrowing to lifecycle commands minimizes time-to-first-value and avoids duplicate ownership with specialized command beads.","acceptance_criteria":"All 5 children (2da.1-2da.5) complete and passing tests\nFull CLI lifecycle: create -> list -> show -> do -> done -> tag works end-to-end\nAll commands support --json output\nAgent attribution recorded correctly in events\nIntegration test: full lifecycle via CLI produces correct event log and projection","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-16T02:23:09.174905443Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:22.240622897Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-1","ux"],"dependencies":[{"issue_id":"bn-2da","depends_on_id":"bn-2h9","type":"blocks","created_at":"2026-02-16T04:25:35.645810147Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2da","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:26:51.152354468Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2da","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T02:26:50.815576004Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":1,"issue_id":"bn-2da","author":"1","text":"Critical review revision: user value = unblock core create->do->done workflows for humans/agents as early as possible. Main risks = (1) command-surface sprawl delaying first usable release, (2) duplicate ownership with existing command beads causing inconsistent behavior, (3) weak machine-contract stability for --json. Alternative considered: keep one large bead with every CLI command; rejected because it lengthens critical path and hides responsibility boundaries. Chosen approach: lifecycle-first scope in bn-2da, with advanced commands kept in bn-298/bn-36a/bn-29r/bn-3ju/bn-2a7/bn-v45/bn-3lp. Coverage path explicitly mapped: unit tests in this bead, workflow e2e in bn-yot.4, diagnostics artifacts through bn-1js + bn-m80.","created_at":"2026-02-16T02:56:46Z"}]}
{"id":"bn-2da.1","title":"Set up clap CLI framework with shared output layer (text/JSON)","description":"# Context\nAll CLI commands share a common framework: clap derive for parsing, a shared output layer for text vs --json parity, agent identity resolution, and error formatting.\n\n# Implementation\n- `crates/bones-cli/src/main.rs` — clap App with subcommands\n- `crates/bones-cli/src/output.rs` — OutputMode enum (Human, Json), shared render functions\n- Agent identity resolution: --agent flag > AGENT env > BONES_AGENT env > config file > error\n- Error formatting: structured errors with suggestion text (human) / error_code (JSON)\n- Common flags: --json, --agent, --verbose, --quiet\n\n# Acceptance Criteria\n- [ ] clap App parses all planned subcommands (create, list, show, do, done, tag, untag, move)\n- [ ] --json flag switches output to valid JSON for every command\n- [ ] Agent identity resolution follows the 4-step chain\n- [ ] Missing agent on mutating commands produces clear error\n- [ ] Read-only commands work without agent","acceptance_criteria":"clap CLI framework with subcommands for all planned commands\nShared output layer: text (default) and JSON (--json flag) output modes\nError output goes to stderr, data output goes to stdout\nAgent resolution: --agent flag > AGENT env > BONES_AGENT env > config file\nMutating commands error if no agent is set\nUnit tests: argument parsing, agent resolution order, output mode selection","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:07:01.098870092Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:43.680508984Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-1"],"dependencies":[{"issue_id":"bn-2da.1","depends_on_id":"bn-2da","type":"parent-child","created_at":"2026-02-16T04:07:01.098870092Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":44,"issue_id":"bn-2da.1","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:05Z"}]}
{"id":"bn-2da.2","title":"Implement bn create command","description":"# Context\n`bn create \"Title\"` is the primary entry point. Emits an item.create event with all specified fields.\n\n# Implementation\n- `crates/bones-cli/src/cmd/create.rs`\n- Flags: --kind (task|goal|bug), -s/--size, --urgent/--punt, --parent, --blocks, --labels\n- Generates item ID via terseid\n- Emits item.create event to active shard\n- Refreshes SQLite projection incrementally\n- Outputs: created item ID and summary\n\n# Acceptance Criteria\n- [ ] Creates items with all supported flags\n- [ ] Default kind is task, default urgency is default\n- [ ] --parent validates parent exists\n- [ ] --blocks validates target exists\n- [ ] --json output includes id, title, kind, state, urgency\n- [ ] Event written to correct shard with correct agent attribution","acceptance_criteria":"bn create <title> creates a new task (default kind)\nSupports --kind (task/goal/bug), --size, --parent, --blocks, --urgent, --punt flags\nEmits item.create event to active shard\nTriggers duplicate detection warning if similar items exist (FTS5)\nReturns created item ID\nUnit tests: create with various flags, event emission, duplicate warning trigger","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:07:01.226880895Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:43.802537813Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-1"],"dependencies":[{"issue_id":"bn-2da.2","depends_on_id":"bn-2da","type":"parent-child","created_at":"2026-02-16T04:07:01.226880895Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2da.2","depends_on_id":"bn-2da.1","type":"blocks","created_at":"2026-02-16T04:07:06.474080598Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":45,"issue_id":"bn-2da.2","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:06Z"}]}
{"id":"bn-2da.3","title":"Implement bn list and bn show commands","description":"# Context\n`bn list` shows all open items (with filters). `bn show <id>` shows full item details. Both are read-only, querying SQLite.\n\n# Implementation\n- `crates/bones-cli/src/cmd/list.rs` — List with filters: --state, --kind, --label, --urgency\n- `crates/bones-cli/src/cmd/show.rs` — Full item detail: all fields, deps, comments, parent\n- Human output: formatted table (list) or detail view (show)\n- JSON output: array of items (list) or single item object (show)\n- Partial ID resolution for show: \"a7x\" resolves to \"bn-a7x\"\n\n# Acceptance Criteria\n- [ ] bn list shows all open items by default\n- [ ] Filters: --state, --kind, --label narrow results correctly\n- [ ] bn show displays all item fields including deps and comments\n- [ ] Partial ID resolution works\n- [ ] --json output is valid and stable\n- [ ] Empty list returns empty array (not error)","acceptance_criteria":"bn list shows all open items by default\nSupports --state, --label, --kind, --urgency filters\nOutput includes ID, title, state, labels, urgency\nbn show <id> displays full item details including comments and dependencies\nPartial ID resolution via terseid IdResolver\nJSON output mode for both commands\nUnit tests: list with filters, show with full details, partial ID resolution","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:07:01.343661317Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:43.945479580Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-1"],"dependencies":[{"issue_id":"bn-2da.3","depends_on_id":"bn-2da","type":"parent-child","created_at":"2026-02-16T04:07:01.343661317Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2da.3","depends_on_id":"bn-2da.1","type":"blocks","created_at":"2026-02-16T04:07:06.597751411Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":46,"issue_id":"bn-2da.3","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:06Z"}]}
{"id":"bn-2da.4","title":"Implement bn do and bn done state transition commands","description":"# Context\n`bn do <id>` moves to \"doing\", `bn done <id>` moves to \"done\". These emit item.move events.\n\n# Implementation\n- `crates/bones-cli/src/cmd/transitions.rs`\n- bn do: validate item exists and is in valid source state, emit item.move {state: \"doing\"}\n- bn done: validate item exists, emit item.move {state: \"done\"}, optional --reason flag\n- Invalid transitions produce clear error (e.g., \"cannot do an item already done\")\n- Goal auto-complete: if done-ing the last child of a goal, emit goal close event (if auto_complete enabled)\n\n# Acceptance Criteria\n- [ ] bn do moves open items to doing\n- [ ] bn done moves doing/open items to done\n- [ ] --reason flag recorded in event data\n- [ ] Invalid transitions produce clear error with current state\n- [ ] Goal auto-complete triggers when applicable\n- [ ] --json output confirms new state","acceptance_criteria":"bn do <id> transitions item to doing state\nbn done <id> transitions item to done state\nbn done supports --reason flag for closing note\nState transitions emit item.move events\nInvalid transitions rejected with clear error message\nAgent recorded in event\nUnit tests: valid transitions, invalid transitions, reason flag, event emission","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:07:01.457007761Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:44.072559129Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-1"],"dependencies":[{"issue_id":"bn-2da.4","depends_on_id":"bn-2da","type":"parent-child","created_at":"2026-02-16T04:07:01.457007761Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2da.4","depends_on_id":"bn-2da.1","type":"blocks","created_at":"2026-02-16T04:07:06.717750019Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":47,"issue_id":"bn-2da.4","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:06Z"}]}
{"id":"bn-2da.5","title":"Implement bn tag, bn untag, and bn move --parent commands","description":"# Context\nLabel management (tag/untag) and reparenting (move --parent) are common item modifications.\n\n# Implementation\n- `crates/bones-cli/src/cmd/tag.rs` — bn tag <id> <label...> / bn untag <id> <label...>\n- `crates/bones-cli/src/cmd/move.rs` — bn move <id> --parent <goal_id>\n- tag: emits item.update event adding labels\n- untag: emits item.update event removing labels\n- move --parent: emits item.update event changing parent field, validates parent is a goal\n\n# Acceptance Criteria\n- [ ] bn tag adds one or more labels\n- [ ] bn untag removes one or more labels\n- [ ] bn move --parent reparents item under a goal\n- [ ] Reparenting validates target is kind=goal\n- [ ] Duplicate tag additions are idempotent (no error)\n- [ ] --json output confirms changes","acceptance_criteria":"bn tag <id> <labels...> adds labels to item (item.update event)\nbn untag <id> <label> removes label from item (item.update event)\nbn move <id> --parent <goal-id> reparents item (item.update event)\nOR-Set semantics for labels (concurrent add/remove converges)\nUnit tests: add/remove labels, reparent, concurrent label operations","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:07:01.569037615Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:44.201716773Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-1"],"dependencies":[{"issue_id":"bn-2da.5","depends_on_id":"bn-2da","type":"parent-child","created_at":"2026-02-16T04:07:01.569037615Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2da.5","depends_on_id":"bn-2da.1","type":"blocks","created_at":"2026-02-16T04:07:06.839978167Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":48,"issue_id":"bn-2da.5","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:06Z"}]}
{"id":"bn-2h9","title":"Establish coding conventions and patterns document","description":"# Context\nBefore multiple agents work in parallel, shared conventions must be documented to ensure consistent code across crates. Without this, agents will make different choices for error handling, logging, module structure, and testing, creating integration friction.\n\n# Goals\nWrite a CONVENTIONS.md (or similar) that all implementing agents reference. This is the \"how we write code here\" guide.\n\n# Scope\nDocument and establish:\n\n## Error Handling\n- Use `anyhow::Result` for application code (CLI, commands)\n- Use `thiserror` for library error types (bones-core, bones-triage, bones-search)\n- Every error type includes a user-facing message and machine-readable error code\n- No bare unwrap() on user-reachable paths; use .context(\"explanation\")?\n\n## Logging\n- Use `tracing` crate (not log)\n- Structured fields: tracing::info!(item_id = %id, event_type = %ty, \"event appended\")\n- Levels: error (user-visible failures), warn (recoverable issues), info (key operations), debug (detailed flow), trace (per-line/per-event)\n\n## Module Organization\n- One file per logical component, not one file per struct\n- Public API at mod.rs, implementation in submodules\n- #[cfg(test)] mod tests at bottom of each file\n\n## Testing\n- Unit tests: in-file #[cfg(test)] mod tests\n- Integration tests: tests/ directory at crate root\n- Property tests: proptest with 10k iterations for local, 1M for CI\n- Every public function has at least one test\n- Test names: test_<function>_<scenario> (e.g., test_parse_line_valid_create_event)\n\n## Naming\n- Types: PascalCase (EventType, WorkItem, LwwRegister)\n- Functions: snake_case\n- Constants: SCREAMING_SNAKE_CASE\n- Crate-internal items: pub(crate), not pub\n- ItemId not ItemID, FTS not Fts\n\n## Serialization\n- serde for all data types\n- JSON field names: snake_case\n- Timestamps: u64 unix epoch seconds\n- Hashes: lowercase hex strings\n\n## Dependencies\n- Prefer bundled/vendored where possible (rusqlite with bundled-sqlcipher)\n- Pin major versions in Cargo.toml\n- New dependencies require justification in PR description\n\n# Acceptance Criteria\n- [ ] CONVENTIONS.md exists in project root\n- [ ] Covers: error handling, logging, modules, testing, naming, serialization, dependencies\n- [ ] Reviewed for consistency with plan.md\n- [ ] All examples compile","acceptance_criteria":"Coding conventions document covers: error handling patterns, module structure, naming conventions, test patterns\nDocument addresses: Result vs panic policy, public API surface rules, documentation requirements\nConventions are specific and enforceable (not vague guidelines)\nDocument lives in repo and is referenced by AGENTS.md\nAll subsequent implementation beads follow these conventions","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:25:28.547930613Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:01.166809639Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["conventions","foundation","phase-0"]}
{"id":"bn-2j3","title":"Implement MCP server (bn mcp)","description":"# Context\n\nbn mcp starts an MCP server exposing the full Bones API. Makes Bones instantly usable from any MCP-aware agent without CLI shelling.\n\n# Goals\n\n- MCP server exposing all Bones operations as tools\n- Tools for: create, list, show, do, done, next, triage, search, link, tag\n- Proper MCP protocol compliance (JSON-RPC over stdio)\n- Same functionality as CLI --json output\n\n# Implementation Approach\n\nUse an MCP server library for Rust (or implement the simple JSON-RPC protocol directly). Each CLI command maps to an MCP tool. Tools accept structured parameters and return JSON responses identical to CLI --json output.\n\n## Files to Create/Modify\n\n- crates/bones-cli/src/cmd/mcp.rs — MCP server entry point\n- crates/bones-cli/src/mcp/ — MCP protocol implementation and tool definitions\n\n## Acceptance Criteria\n\n- [ ] MCP server starts and accepts connections via stdio\n- [ ] All core operations available as MCP tools\n- [ ] Tool responses match CLI --json output\n- [ ] Works with Claude, Cursor, and other MCP-aware agents\n- [ ] Proper error handling and reporting via MCP protocol\n\n# How This Serves Overarching Goals\n\n\"Agents first, humans welcome.\" MCP makes Bones a first-class citizen in agent tool ecosystems without requiring shell access.","status":"deferred","priority":3,"issue_type":"task","created_at":"2026-02-16T02:26:02.132115732Z","created_by":"bones-dev","updated_at":"2026-02-16T02:28:17.273534234Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["integration","mcp","phase-5"],"dependencies":[{"issue_id":"bn-2j3","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:27:09.085927834Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-2j7","title":"Implement KNN vector search via sqlite-vec","description":"# Context\nThird step: use stored vectors to find semantically similar items.\n\n# Implementation\n- KNN query: embed query text → find nearest N vectors via sqlite-vec\n- Cosine similarity scoring\n- Result filtering: exclude done/archived items (configurable)\n- bn search --semantic: semantic-only search mode\n- Expose as API for fusion layer (bn-sgf) to combine with lexical + structural\n\n# Dependencies\nNeeds embedding pipeline (sibling bead) operational.","acceptance_criteria":"KNN query: embed query text then find nearest N vectors\nCosine similarity scoring returned with results\nResult filtering by state (exclude done/archived by default)\nAPI exposed for fusion layer consumption\nbn search --semantic flag triggers semantic-only search\nUnit tests: KNN accuracy on known vectors, filtering, scoring","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:54:34.530813104Z","created_by":"bones-dev","updated_at":"2026-02-16T04:54:52.555995814Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-3","search","semantic"],"dependencies":[{"issue_id":"bn-2j7","depends_on_id":"bn-vpa","type":"blocks","created_at":"2026-02-16T04:54:51.957071803Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":83,"issue_id":"bn-2j7","author":"bones-dev","text":"Implementation must ship unit tests alongside the code.","created_at":"2026-02-16T04:54:52Z"}]}
{"id":"bn-2jr","title":"Define normative CRDT merge specification","description":"# Context\n\nBones is a CRDT-first issue tracker. Before any code is written, the merge semantics must be fully specified as a normative protocol document. Without this, two implementations could diverge on tie-breaking and silently produce different states — defeating the entire CRDT convergence guarantee.\n\n# Goals\n\n- Produce a normative specification for all CRDT merge operations in Bones\n- Define the exact total order for LWW tie-breaking\n- Define the epoch+phase state merge semantics\n- Establish conformance test criteria\n\n# Background\n\nThe plan specifies field-level CRDTs: LWW Registers (title, description, kind, size, urgency, parent), OR-Sets via DAG replay (assignees, labels, blocked_by, related_to), and G-Set (comments). The state field uses an epoch+phase model for deterministic reopen/close behavior.\n\nDeterministic LWW tie-breaking order (from plan):\n1. Compare ITC causal dominance\n2. If concurrent, compare wall_ts\n3. If equal, compare actor_id lexicographically\n4. If equal, compare event_hash lexicographically\n\nState merge: (epoch, phase) where reopen increments epoch, join is max(epoch) then max(phase_rank) within epoch. Phase rank: open < doing < done < archived.\n\n# Reasoning/Justification\n\nThis spec must exist before implementation because:\n- CRDTs are only correct if all replicas use identical merge rules\n- The tie-breaking chain must be total (no ambiguity)\n- The epoch+phase model is non-standard and needs formal definition\n- Property tests (Phase 0) need a spec to test against\n\n# Implementation Approach\n\n## Key Components\n\n1. **LWW Register Spec**: Define the total order function comparing two concurrent writes. Specify behavior for each step of the tie-breaking chain. Define what \"ITC causal dominance\" means precisely (partial order from ITC stamps).\n\n2. **OR-Set Spec (via DAG replay)**: Define how add/remove operations merge when replayed from the Eg-Walker DAG. Specify the LCA walk and divergent-branch replay semantics.\n\n3. **State (Epoch+Phase) Spec**: Define phase_rank ordering: open < doing < done < archived. Define epoch increment rules. Define the join operation formally.\n\n4. **G-Set Spec**: Trivial — union of all observed elements. Document the redaction extension (item.redact events replace payload in projection but don't remove from G-Set).\n\n5. **Redaction Spec**: How item.redact events interact with the Merkle-DAG, how projections handle redacted content, deterministic behavior across replicas.\n\n## Files to Create/Modify\n\n- docs/spec/merge-semantics.md — The normative merge specification\n- docs/spec/state-machine.md — State transition rules and epoch model\n\n## Acceptance Criteria\n\n- [ ] LWW total order fully specified with no ambiguity\n- [ ] OR-Set merge semantics fully specified for DAG replay\n- [ ] Epoch+phase join operation formally defined\n- [ ] Redaction semantics specified\n- [ ] Spec is self-contained (can be implemented from spec alone)\n- [ ] Reviewed for semilattice law compliance (associativity, commutativity, idempotence)\n\n# How This Serves Overarching Goals\n\nThis is the mathematical foundation of Bones. Every convergence guarantee, every \"CRDTs make merge conflicts structurally impossible\" claim rests on this spec being correct and complete.","acceptance_criteria":"LWW total order unambiguous; OR-Set merge specified for DAG replay; epoch+phase join formally defined; redaction semantics specified; spec self-contained","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-16T02:19:54.710454394Z","created_by":"bones-dev","updated_at":"2026-02-16T04:08:01.261931765Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["crdt","foundation","phase-0","spec"],"comments":[{"id":25,"issue_id":"bn-2jr","author":"bones-dev","text":"TERMINOLOGY UPDATE: the normative merge spec uses 'agent' not 'actor'. LWW tie-breaking order: ITC dominance > wall_ts > agent_id (lexicographic) > event_hash (lexicographic).","created_at":"2026-02-16T03:14:23Z"}]}
{"id":"bn-2lv","title":"Security and validation track","description":"# Context\n\nSecurity and validation work must be planned as a coordinated stream so parser hardening, CLI validation, and redaction guarantees ship together instead of as disconnected patches.\n\n# Track Outcomes\n\n- Inputs are validated before mutation paths execute\n- Event payloads and on-disk format are hardened against malformed/corrupt data\n- Redaction behavior is verifiable and auditable\n- Dependency graph operations cannot create invalid project state silently\n\n# Exit Criteria\n\n- [ ] Child beads bn-189, bn-foy, bn-xrg, bn-3uy are completed\n- [ ] Security-related error paths produce actionable remediation guidance\n- [ ] Coverage path is explicit and met: unit (child bead tests), e2e/workflow (bn-3i7 + bn-36d where applicable), diagnostics/log artifacts (bn-1js + bn-m80)\n\n# Notes\n\nThis is a planning track; implementation happens in child beads.","acceptance_criteria":"CLI input validation complete (bn-189)\nEvent format validation complete (bn-foy)\nRedaction verification complete (bn-xrg)\nDependency cycle prevention working (bn-3uy)\nNo SQL injection vectors in query layer\nNo command injection in CLI layer","status":"open","priority":2,"issue_type":"track","owner":"bones-dev","created_at":"2026-02-16T02:40:46.260025887Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:02.776786277Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cross-cutting","phase-2","security","track"]}
{"id":"bn-2ly","title":"[track] Phase 3 test suite: search quality, duplicate detection accuracy","description":"# Context\n\nSearch quality directly determines duplicate prevention quality. This track validates lexical baseline behavior and hybrid ranking upgrades under realistic datasets.\n\n# Scope\n\n- Gold dataset of duplicate/related/unrelated item pairs\n- NDCG@k and ranking-quality metrics for search outputs\n- Duplicate detection precision/recall at configured thresholds\n- False-positive impact monitoring for duplicate warnings\n- Degradation behavior: lexical-only mode when semantic components are unavailable\n\n# Exit Criteria\n\n- [ ] Child beads bn-2ly.1 and bn-2ly.2 are completed\n- [ ] Hybrid ranking quality exceeds lexical baseline on agreed metrics\n- [ ] Fallback behavior remains deterministic and user-visible\n- [ ] Coverage path is explicit: unit (search/dedup backend tests), e2e/workflow (bn-sgf + this track datasets), diagnostics/log artifacts (bn-1js + bn-m80)\n\n# Notes\n\nThis is a planning/validation track; implementation is in child and dependent feature beads.","acceptance_criteria":"All 2 children (2ly.1-2ly.2) complete and passing\nSearch quality meets defined thresholds on gold dataset\nDuplicate detection accuracy meets defined thresholds\nGraceful degradation tested for all optional subsystem failures","status":"open","priority":2,"issue_type":"track","created_at":"2026-02-16T02:37:22.943273444Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:27.533347237Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-3","search","testing","track"],"dependencies":[{"issue_id":"bn-2ly","depends_on_id":"bn-1as","type":"blocks","created_at":"2026-02-16T02:37:23.326183928Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2ly","depends_on_id":"bn-sgf","type":"blocks","created_at":"2026-02-16T03:18:03.069674430Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-2ly.1","title":"Build gold evaluation dataset for search quality and duplicate detection","description":"# Scope\n\nCreate a curated dataset of 200+ item pairs labeled as:\n- duplicate (same problem, different words): 50+ pairs\n- related (same area, different problems): 50+ pairs\n- unrelated (different area, different problems): 100+ pairs\n\nSources: real beads from mcp_agent_mail_rust, synthetic variations, adversarial examples (similar words but different meaning).\n\nUse this dataset to:\n- Measure NDCG@k at k=5,10,20\n- Measure duplicate detection precision/recall at configured thresholds\n- Track regression across model or algorithm changes\n\n# Acceptance Criteria\n\n- [ ] 200+ labeled pairs committed as test fixture\n- [ ] Evaluation harness computes NDCG, precision, recall automatically\n- [ ] CI fails if duplicate F1 regresses below threshold","acceptance_criteria":"Gold dataset: 100+ items with known-correct search results and duplicate pairs\nDataset covers: exact matches, synonym matches, structural-only matches, false positives\nGround truth labels: relevant/not-relevant per query, duplicate/not-duplicate per pair\nDataset stored in tests/ directory in reproducible format\nEvaluation harness: precision, recall, F1 scores reported per layer and fused","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:37:23.112766098Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:27.657839757Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["evaluation","phase-3","search","testing"],"dependencies":[{"issue_id":"bn-2ly.1","depends_on_id":"bn-2c5","type":"blocks","created_at":"2026-02-16T02:37:23.435630518Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2ly.1","depends_on_id":"bn-2ly","type":"parent-child","created_at":"2026-02-16T02:37:23.112766098Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-2ly.2","title":"Test graceful degradation: FTS5-only mode, missing model, corrupt vectors","description":"# Scope\n\n- Model file missing: search falls back to FTS5-only, no crash, clear log message\n- Model file corrupt: same as missing, detected on load\n- sqlite-vec table missing/corrupt: search falls back to FTS5-only, rebuild fixes it\n- bn create --check-duplicates with no semantic layer: lexical-only check still works\n- bn search --semantic with no model: clear error, suggest bn setup --download-model\n- bn rebuild with model unavailable: rebuilds everything except vectors, warns\n\n# Acceptance Criteria\n\n- [ ] Every degradation scenario produces a working (if reduced) search\n- [ ] No panics or crashes in any degradation scenario\n- [ ] Clear user-facing messages for each degradation","acceptance_criteria":"FTS5-only mode: search works when semantic model is missing\nMissing model: clear warning, automatic fallback to lexical-only\nCorrupt vectors: detected on load, rebuild triggered\nPartial index: search works with incomplete vector coverage\nUnit tests: simulate each degradation, verify fallback behavior","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:37:23.219005679Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:27.783044202Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-3","resilience","search","testing"],"dependencies":[{"issue_id":"bn-2ly.2","depends_on_id":"bn-2c5","type":"blocks","created_at":"2026-02-16T02:37:23.540037555Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2ly.2","depends_on_id":"bn-2ly","type":"parent-child","created_at":"2026-02-16T02:37:23.219005679Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-2lz","title":"Implement git merge driver for event shard files","description":"# Context\nGit merge driver that handles concurrent modifications to event shard files.\n\n# Implementation\n- Custom merge driver registered in .gitattributes for *.events files\n- Strategy: safe concatenation preserving deterministic replay order\n- Sort events by (timestamp, agent, event_hash) for deterministic order\n- Handle concurrent writes to same shard from different branches\n- Integration with bn init (registers merge driver)","acceptance_criteria":"Custom merge driver registered in .gitattributes for *.events files\nEvents sorted deterministically (timestamp, agent, event_hash) after merge\nMerge produces valid TSJSON output with no duplicate events\nDriver handles concurrent writes to same shard from different branches\nUnit tests: merge two divergent shards, verify output order and dedup","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:48:11.579133201Z","created_by":"bones-dev","updated_at":"2026-02-16T04:50:22.714633695Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["git","phase-2"],"dependencies":[{"issue_id":"bn-2lz","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T04:48:34.302325621Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":71,"issue_id":"bn-2lz","author":"bones-dev","text":"Implementation must ship unit tests alongside the code. Tests should be in the same PR/commit as the implementation.","created_at":"2026-02-16T04:50:22Z"}]}
{"id":"bn-2ne","title":"Build deterministic simulation skeleton with seed replay","description":"# Context\n\nDeterministic simulation testing (DST) is the highest-confidence verification for distributed systems (FoundationDB, TigerBeetle). For Bones, DST simulates multiple agents producing events concurrently with configurable network faults and verifies convergence under all interleavings.\n\n# Goals\n\n- Build a simulation framework running multiple virtual Bones agents\n- All randomness seeded and deterministic (same seed = same execution)\n- Support fault injection: network partition, event reorder, duplication, clock skew\n- Convergence oracle: after all events delivered, all replicas produce identical state\n- Seed replay for reproducing failures\n\n# Background\n\nInvariants to check:\n1. Strong convergence: all replicas identical after full delivery\n2. Commutativity: any event ordering yields same state\n3. Idempotence: duplicate delivery does not change state\n4. Causal consistency: dependent events maintain order\n5. Triage stability: metrics converge regardless of event ordering\n\n# Implementation Approach\n\n## Key Components\n\n1. SimulatedAgent: local event log, CRDT state, ITC stamp\n2. SimulatedNetwork: routes events with configurable delays, drops, reordering, partitions\n3. SimulatedClock: per-agent wall clock with configurable drift and skew\n4. FaultInjector: random faults based on configured probabilities\n5. ConvergenceOracle: compare materialized state across all agents after draining\n6. SeedReplay: record seed + fault config for exact replay of failures\n\n## Files to Create/Modify\n\n- crates/bones-sim/src/mod.rs — Simulator core\n- crates/bones-sim/src/agent.rs — Simulated agent\n- crates/bones-sim/src/network.rs — Simulated network with fault injection\n- crates/bones-sim/src/clock.rs — Simulated clocks\n- crates/bones-sim/src/oracle.rs — Convergence oracle\n\n## Acceptance Criteria\n\n- [ ] Simulator runs N agents for M rounds with seeded RNG\n- [ ] Same seed always produces identical execution trace\n- [ ] Network supports: delay, drop, reorder, partition\n- [ ] Clock supports: drift, skew, freeze\n- [ ] Convergence oracle detects state divergence\n- [ ] Seed replay reproduces failures exactly\n- [ ] \"Sometimes\" assertions verify interesting states are reachable\n- [ ] Framework compiles and runs against CRDT stubs\n\n# How This Serves Overarching Goals\n\nDST replaces manual testing of distributed scenarios with exhaustive automated exploration. This is a key differentiator over beads and a major reliability multiplier.","acceptance_criteria":"N agents M rounds with seeded RNG; same seed same trace; network faults (delay/drop/reorder/partition); clock faults; convergence oracle detects divergence; seed replay exact","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:20:29.777428777Z","created_by":"bones-dev","updated_at":"2026-02-16T04:08:01.523307010Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["foundation","phase-0","simulation","testing"],"dependencies":[{"issue_id":"bn-2ne","depends_on_id":"bn-2jr","type":"blocks","created_at":"2026-02-16T02:26:33.465570951Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2ne","depends_on_id":"bn-2vb","type":"blocks","created_at":"2026-02-16T02:26:33.836132376Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-2o3","title":"Implement Eg-Walker event DAG with causal parent tracking","description":"# Context\n\nThe Eg-Walker approach (Diamond Types / Loro) eliminates per-element CRDT metadata by encoding causality in the DAG structure. Each event records causal parent hash(es), and merge replays only the divergent portion from the LCA.\n\n# Goals\n\n- Event DAG structure with parent hash tracking\n- LCA (Lowest Common Ancestor) finding for divergent branches\n- Divergent-branch replay for CRDT state reconstruction\n- Integration with ITC stamps for causal ordering\n- Merkle-DAG integrity: each event hash includes parent hashes\n\n# Background\n\nImpact vs traditional CRDTs: ~40% smaller events, merge cost O(divergent) not O(all), no tombstone accumulation. Hash function: BLAKE3 truncated to 16 bytes.\n\n# Implementation Approach\n\n## Key Components\n\n1. Event hash computation: content-address from (parent_hashes + timestamp + actor + type + item_id + data)\n2. DAG storage: in-memory indexed by event hash, efficient parent/descendant traversal\n3. LCA algorithm: BFS from both tips toward roots\n4. Divergent replay: collect events on both branches since LCA, replay through CRDT merge\n5. DAG construction from event log: read TSJSON, link events via hashes\n\n## Files to Create/Modify\n\n- crates/bones-core/src/dag/mod.rs — DAG structure\n- crates/bones-core/src/dag/hash.rs — Content-addressed hashing (BLAKE3)\n- crates/bones-core/src/dag/lca.rs — LCA finding\n- crates/bones-core/src/dag/replay.rs — Divergent branch replay\n\n## Acceptance Criteria\n\n- [ ] Events correctly hash including parent references\n- [ ] DAG constructed from event log matches expected structure\n- [ ] LCA correctly found for divergent branches\n- [ ] Divergent replay produces correct merged state\n- [ ] Merkle integrity: modifying any event changes all descendant hashes\n- [ ] Incremental append: adding events is O(1) per event\n- [ ] Property tests: hash determinism, LCA correctness, replay convergence\n\n# How This Serves Overarching Goals\n\nThe Eg-Walker DAG makes CRDTs efficient: plain values for operations, structural causality. Directly reduces event size and merge cost.","acceptance_criteria":"All 3 children (2o3.1-2o3.3) complete and passing tests\nEvents form a content-addressed Merkle-DAG with causal ordering\nLCA-based merge produces correct results for concurrent branches\nIntegration test: multi-agent event streams merge correctly","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-16T02:21:39.514336079Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:21.552968561Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","crdt","dag","phase-1"],"dependencies":[{"issue_id":"bn-2o3","depends_on_id":"bn-2h9","type":"blocks","created_at":"2026-02-16T04:25:35.179961403Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2o3","depends_on_id":"bn-2zf","type":"blocks","created_at":"2026-02-16T02:26:41.289979501Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2o3","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T03:43:30.462802092Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":7,"issue_id":"bn-2o3","author":"1","text":"Critical review pass: user value = fast conflict resolution and smaller event footprint during multi-agent merges. Failure modes = incorrect LCA detection, replay-order nondeterminism, and unstable hashing that breaks Merkle integrity. Alternative considered: classical per-field CRDT metadata/tombstones; rejected because metadata growth and replay cost worsen with long histories. Chosen approach: Eg-Walker DAG replay from LCA with content-addressed hashes. Coverage path: unit verification in-bead hash/LCA/replay property tests, e2e/workflow bn-yot.3 + bn-yot.5, diagnostics/log artifacts bn-3oz + bn-1js + bn-m80.","created_at":"2026-02-16T02:58:59Z"}]}
{"id":"bn-2o3.1","title":"Implement content-addressed event hashing (BLAKE3 Merkle-DAG)","description":"# Context\nEach event is content-addressed: its hash includes parent hashes, creating a Merkle-DAG. Provides tamper evidence and O(log N) sync diffing.\n\n# Implementation\n- `crates/bones-core/src/dag/hash.rs`\n- Hash = BLAKE3(parent_hashes || timestamp || agent || type || item_id || data)\n- Truncate to 16 bytes for compact IDs\n- Parent hashes stored in event data payload\n- Linear events have one parent hash, merge points have two\n\n# Acceptance Criteria\n- [ ] Hash is deterministic (same input → same hash)\n- [ ] Hash includes all event fields including parent hashes\n- [ ] Modifying any ancestor changes all descendant hashes\n- [ ] BLAKE3 via the blake3 crate, truncated to 16 bytes\n- [ ] Hash serializes as hex string for TSJSON embedding","acceptance_criteria":"Each event hashed with BLAKE3 including causal parent hash(es)\nHash covers: parent_hashes + timestamp + agent + type + item_id + data\nGenesis events (no parents) have well-defined hash computation\nHash is deterministic: same inputs always produce same hash\nUnit tests: known-input hash verification, multi-parent hash chaining","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:07:32.503583603Z","created_by":"bones-dev","updated_at":"2026-02-16T04:41:57.862974832Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","dag","phase-1"],"dependencies":[{"issue_id":"bn-2o3.1","depends_on_id":"bn-2o3","type":"parent-child","created_at":"2026-02-16T04:07:32.503583603Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":49,"issue_id":"bn-2o3.1","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:06Z"}]}
{"id":"bn-2o3.2","title":"Implement in-memory DAG structure with parent/descendant traversal","description":"# Context\nThe DAG indexes events by hash for efficient parent lookup and descendant traversal. Built incrementally as events are replayed.\n\n# Implementation\n- `crates/bones-core/src/dag/mod.rs` — EventDag struct\n- HashMap<Hash, DagNode> where DagNode = { event, parents: Vec<Hash>, children: Vec<Hash> }\n- Insert: O(1) per event (hash, link to parents, register as child)\n- Tip detection: nodes with no children are branch tips\n- Construction from event log: parse events, extract parent hashes from data, build links\n\n# Acceptance Criteria\n- [ ] DAG constructed correctly from event log\n- [ ] Parent and child links bidirectional\n- [ ] Incremental append: adding events is O(1) per event\n- [ ] Tip detection identifies current branch heads\n- [ ] Handles linear chains and forking/merging topologies","acceptance_criteria":"In-memory DAG stores events as nodes with parent edges\nEfficient parent traversal: get all ancestors of a node\nEfficient descendant traversal: get all events causally after a node\nTopological iteration over DAG in causal order\nSupport for multiple roots (concurrent genesis from different agents)\nUnit tests: build DAG from event sequence, verify traversal orders","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:07:32.621779859Z","created_by":"bones-dev","updated_at":"2026-02-16T04:41:57.989655071Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","dag","phase-1"],"dependencies":[{"issue_id":"bn-2o3.2","depends_on_id":"bn-2o3","type":"parent-child","created_at":"2026-02-16T04:07:32.621779859Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2o3.2","depends_on_id":"bn-2o3.1","type":"blocks","created_at":"2026-02-16T04:07:36.926460938Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":50,"issue_id":"bn-2o3.2","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:06Z"}]}
{"id":"bn-2o3.3","title":"Implement LCA finding and divergent-branch replay","description":"# Context\nWhen two branches diverge, we need the Lowest Common Ancestor (LCA) to identify the divergent portion, then replay both branches through CRDT merge to produce unified state.\n\n# Implementation\n- `crates/bones-core/src/dag/lca.rs` — find_lca(tip_a, tip_b) -> Hash\n- BFS from both tips toward roots, first intersection is LCA\n- `crates/bones-core/src/dag/replay.rs` — replay_divergent(dag, lca, tip_a, tip_b) -> MergedState\n- Collect events on each branch since LCA\n- Replay through CRDT merge logic (WorkItemState.merge)\n- Handle: one tip is ancestor of other (LCA == ancestor tip, no divergence)\n\n# Acceptance Criteria\n- [ ] LCA correctly found for divergent branches\n- [ ] LCA returns tip itself when one branch is ancestor of other\n- [ ] Divergent replay produces correct merged state\n- [ ] Replay handles multiple items affected by divergent events\n- [ ] Performance: O(divergent events), not O(all events)","acceptance_criteria":"Find Lowest Common Ancestor(s) of two events in the DAG\nIdentify divergent branches: events on one side but not the other\nReplay divergent events to merge concurrent branches\nMerge cost is O(divergent events), not O(all events)\nUnit tests: linear chain LCA, diamond merge LCA, multi-branch replay","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:07:32.743869866Z","created_by":"bones-dev","updated_at":"2026-02-16T04:41:58.119717531Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","dag","phase-1"],"dependencies":[{"issue_id":"bn-2o3.3","depends_on_id":"bn-2o3","type":"parent-child","created_at":"2026-02-16T04:07:32.743869866Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2o3.3","depends_on_id":"bn-2o3.2","type":"blocks","created_at":"2026-02-16T04:07:37.041103169Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":51,"issue_id":"bn-2o3.3","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:06Z"}]}
{"id":"bn-2oz","title":"Implement bn did and bn skip feedback commands","description":"# Context\nFeedback surface commands that wire user actions to the Thompson Sampling backend.\n\n# Implementation\n- bn did <id>: record positive feedback (agent worked on recommended item)\n- bn skip <id>: record negative feedback (agent skipped recommendation)\n- Both emit feedback events to .bones/feedback.jsonl\n- Wire to bn-3vq Thompson Sampling posterior updates\n- All support --json output","acceptance_criteria":"bn did <id> records positive feedback to .bones/feedback.jsonl\nbn skip <id> records negative feedback to .bones/feedback.jsonl\nFeedback events include agent, timestamp, and item context\nEvents wired to Thompson Sampling backend (bn-3vq) for weight updates\nUnit tests: feedback recording, event format, backend wiring","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:47:38.017042130Z","created_by":"bones-dev","updated_at":"2026-02-16T04:50:22.593812136Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-2","triage"],"dependencies":[{"issue_id":"bn-2oz","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T04:47:53.795101608Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2oz","depends_on_id":"bn-3vq","type":"blocks","created_at":"2026-02-16T04:47:53.669791554Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":70,"issue_id":"bn-2oz","author":"bones-dev","text":"Implementation must ship unit tests alongside the code. Tests should be in the same PR/commit as the implementation.","created_at":"2026-02-16T04:50:22Z"}]}
{"id":"bn-2qf","title":"Implement bn next and bn triage core triage commands","description":"# Context\nCore triage commands that expose computed priority to users and agents.\n\n# Implementation\n- bn next: return single highest-priority unblocked item with score explanation\n- bn next --agent N: multi-agent assignment surface (delegates to scheduler backend)\n- bn triage: full project triage report (top picks, blockers, quick wins, cycles summary)\n- Both commands consume composite score from bn-sep backend\n- All support --json output\n\n# How This Serves Project Goals\nbn next is THE primary value proposition - one command to know what to work on.","acceptance_criteria":"bn next returns highest-priority unblocked item with score explanation\nbn next --agent N assigns N items to N agents via scheduler\nbn triage produces ranked report: top picks, blockers, quick wins\nBoth commands consume composite score from bn-sep/bn-4us backend\nDeterministic output for unchanged graph state\nUnit tests: next selection, multi-agent assignment, triage report format","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:47:37.753875310Z","created_by":"bones-dev","updated_at":"2026-02-16T04:50:22.356103995Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-2","triage"],"dependencies":[{"issue_id":"bn-2qf","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T04:47:53.273828346Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2qf","depends_on_id":"bn-sep","type":"blocks","created_at":"2026-02-16T04:47:53.106732021Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":68,"issue_id":"bn-2qf","author":"bones-dev","text":"Implementation must ship unit tests alongside the code. Tests should be in the same PR/commit as the implementation.","created_at":"2026-02-16T04:50:22Z"}]}
{"id":"bn-2ri","title":"Clock skew detection and timestamp policy","description":"# Context\n\nWall-clock skew is inevitable in distributed agent systems. This bead defines safe timestamp handling so display sorting is useful without compromising causal correctness.\n\n# Scope\n\n- Detect and flag significant local/remote clock skew\n- Preserve ITC causal ordering as source of truth for merge correctness\n- Define display-order policy when wall timestamps are inconsistent\n- Reproducible skew simulation scenarios for validation\n\n# Acceptance Criteria\n\n- [ ] Events are never rejected solely due to wall-clock skew\n- [ ] Skew warnings trigger deterministically beyond configured thresholds\n- [ ] Causal merge outcomes remain identical under skewed timestamps\n- [ ] Display/order behavior under skew is documented and test-covered\n- [ ] Coverage path is explicit: unit (skew policy tests), e2e/workflow (bn-385 + bn-zr8 skew fixtures), diagnostics/log artifacts (bn-1js + bn-3oz)\n","acceptance_criteria":"Detect clock skew: warn if event timestamp is far from system time\nTimestamp policy: events use wall clock, ITC handles causal ordering\nConfigurable skew threshold (default: 5 minutes)\nWarning on write if timestamp anomaly detected\nUnit tests: normal timestamps pass, skewed timestamps warn","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:43:08.782417523Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:01.979722171Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["crdt","edge-case","phase-2"],"dependencies":[{"issue_id":"bn-2ri","depends_on_id":"bn-2zf","type":"blocks","created_at":"2026-02-16T02:43:32.900212237Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-2uw","title":"Advanced list/query UX: filtering, sorting, pagination","description":"# Context\n\n`bn list` in bn-2da delivers baseline visibility. This bead adds advanced query ergonomics so users can reliably slice large worksets and automation can page through results safely.\n\n# Scope\n\n- Extended filters: status, kind/type, urgency, label(s), parent, assignee, date ranges\n- Sorting modes: created, updated, urgency, computed score (when triage available)\n- Stable pagination semantics: limit/offset (and deterministic tie-break ordering)\n- Multi-filter AND behavior with clear error messages for invalid combinations\n\n# Acceptance Criteria\n\n- [ ] Filter combinations produce correct deterministic result sets\n- [ ] Pagination is stable between invocations when data is unchanged\n- [ ] Sorting has explicit tie-break rules to prevent output jitter\n- [ ] JSON output includes pagination metadata for automation\n- [ ] Coverage path is explicit: unit (query-builder and ordering tests), e2e/workflow (bn-2yo), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"bn list supports --sort (by priority, created, updated, state)\nbn list supports combined filters (--state doing --label backend --kind bug)\nPagination: --limit N --offset M for large result sets\nFilter expressions compose correctly (AND semantics)\nUnit tests: sort orders, combined filters, pagination boundaries","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:42:26.577008569Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:42.310716919Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-2"],"dependencies":[{"issue_id":"bn-2uw","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T03:13:27.215733772Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2uw","depends_on_id":"bn-3m6","type":"blocks","created_at":"2026-02-16T02:42:47.852902455Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2uw","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T02:42:47.741515209Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-2vb","title":"Set up Rust project skeleton with Cargo workspace","description":"# Context\n\nThe Rust project needs its basic structure before any Bones code is written: Cargo workspace, crate layout, CI configuration, and dependency declarations.\n\n# Goals\n\n- Create a Cargo workspace with logical crate separation\n- Set up CI (GitHub Actions) with clippy, fmt, test, bench steps\n- Declare initial dependencies\n- Establish code conventions (error handling, logging)\n\n# Implementation Approach\n\n## Workspace layout\n\n- bones-core — Event engine, CRDT logic, ITC, Merkle-DAG (library)\n- bones-triage — Graph algorithms, composite scoring, scheduling (library)\n- bones-search — FTS5, semantic vectors, RRF fusion (library)\n- bones-cli — CLI binary (bn command)\n- bones-sim — Deterministic simulation framework (library + test binary)\n\n## Key dependencies\n\nserde, serde_json, rusqlite (bundled), anyhow, clap, chrono, tracing, proptest\n\n## Files to Create/Modify\n\n- Cargo.toml — Workspace root\n- crates/bones-core/Cargo.toml + src/lib.rs\n- crates/bones-triage/Cargo.toml + src/lib.rs\n- crates/bones-search/Cargo.toml + src/lib.rs\n- crates/bones-cli/Cargo.toml + src/main.rs\n- crates/bones-sim/Cargo.toml + src/lib.rs\n- .github/workflows/ci.yml\n- rustfmt.toml, clippy.toml\n\n## Acceptance Criteria\n\n- [ ] cargo build succeeds across all crates\n- [ ] cargo test runs (no tests yet, but infrastructure works)\n- [ ] cargo clippy passes with no warnings\n- [ ] cargo fmt --check passes\n- [ ] CI workflow defined\n\n# How This Serves Overarching Goals\n\nClean project structure enables parallel development. The workspace layout maps to Bones' architectural layers (core -> triage -> search -> cli).","acceptance_criteria":"cargo build succeeds; cargo test runs; cargo clippy clean; cargo fmt --check passes; CI workflow defined","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-16T02:20:55.560033663Z","created_by":"bones-dev","updated_at":"2026-02-16T04:51:44.695399556Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["foundation","infrastructure","phase-0"],"comments":[{"id":11,"issue_id":"bn-2vb","author":"bones-dev","text":"Add terseid as a git dependency: terseid = { git = \"https://github.com/bobisme/terseid.git\" }. This provides ID generation, parsing, and CLI resolution for all bones item IDs.","created_at":"2026-02-16T02:59:09Z"},{"id":77,"issue_id":"bn-2vb","author":"Bob","text":"NOTE: rust edition 2024 is current","created_at":"2026-02-16T04:51:20Z"},{"id":78,"issue_id":"bn-2vb","author":"Bob","text":"use cargo add to add/manage deps, don't edit Cargo.toml directly","created_at":"2026-02-16T04:51:44Z"}]}
{"id":"bn-2wh","title":"Concurrent access model and file locking","description":"# Context\n\nMultiple agents may write in parallel. This bead defines concurrency controls for shard writes and projection access so throughput improves without corrupting state.\n\n# Scope\n\n- Writer concurrency strategy (per-actor shards + append guarantees)\n- Projection access coordination (WAL + advisory locks)\n- Race handling for conflicting creates/updates under concurrent writers\n- Multi-process stress scenarios and lock-contention behavior\n\n# Acceptance Criteria\n\n- [ ] Concurrent writers do not corrupt shard files or lose accepted events\n- [ ] Projection reads remain available during write-heavy workloads\n- [ ] Lock acquisition/backoff behavior is deterministic and observable\n- [ ] Stress tests demonstrate stable behavior under contention\n- [ ] Coverage path is explicit: unit (lock/concurrency primitives), e2e/workflow (bn-385 + bn-zr8 stress/fault scenarios), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"File locking for active shard writes (prevent concurrent corruption)\nLock strategy: advisory file locks (flock) with timeout\nMultiple readers allowed concurrent with single writer\nLock failure produces clear error with PID of holder if available\nUnit tests: concurrent write prevention, reader/writer coexistence","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:41:52.790889544Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:01.485793960Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["crdt","phase-2","reliability"],"dependencies":[{"issue_id":"bn-2wh","depends_on_id":"bn-2zf","type":"blocks","created_at":"2026-02-16T02:42:03.829617372Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2wh","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:42:03.604994162Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2wh","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T02:42:03.718799196Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-2y3","title":"Implement CRDT state machine (LWW, OR-Set, G-Set, epoch+phase)","description":"# Context\n\nThis is the core merge logic for all work item fields. Each field uses a specific CRDT type, and all must satisfy semilattice laws. This bead implements the actual merge functions that the property test harness (bn-hws) tests against.\n\n# Goals\n\n- Implement LWW Register with deterministic tie-breaking (ITC > wall_ts > actor_id > event_hash)\n- Implement OR-Set via DAG replay (add/remove convergence)\n- Implement G-Set (grow-only, for comments)\n- Implement epoch+phase state type with join semantics\n- All merge functions satisfy associativity, commutativity, idempotence\n\n# Background\n\nField-level CRDT assignments from plan:\n- LWW: title, description, kind, size, urgency, parent\n- OR-Set: assignees, labels, blocked_by, related_to\n- G-Set: comments\n- Epoch+Phase: state (open < doing < done < archived; reopen increments epoch)\n\n# Implementation Approach\n\n## Key Components\n\n1. LWW Register<T>: holds value + ITC stamp + wall_ts + actor_id + event_hash. Merge compares by the 4-step tie-breaking chain.\n2. ORSet<T>: backed by DAG replay. Add/remove operations stored as events. Materialized by replaying from LCA.\n3. GSet<T>: trivial union. Elements are event hashes referencing comment content.\n4. EpochPhase: (u64, Phase) where Phase is an enum with explicit rank ordering.\n5. WorkItem: struct aggregating all fields with their CRDT types.\n\n## Files to Create/Modify\n\n- crates/bones-core/src/crdt/lww.rs — LWW Register\n- crates/bones-core/src/crdt/orset.rs — OR-Set via DAG replay\n- crates/bones-core/src/crdt/gset.rs — G-Set\n- crates/bones-core/src/crdt/state.rs — Epoch+Phase\n- crates/bones-core/src/crdt/mod.rs — Module exports and WorkItem aggregate\n- crates/bones-core/src/item.rs — WorkItem struct\n\n## Acceptance Criteria\n\n- [ ] LWW merge produces deterministic winner for all tie-breaking cases\n- [ ] OR-Set add/remove operations converge correctly\n- [ ] G-Set union works for concurrent additions\n- [ ] Epoch+phase join: max epoch, then max phase rank\n- [ ] Reopen correctly increments epoch\n- [ ] All property tests from bn-hws pass\n- [ ] WorkItem merges all fields correctly as aggregate\n- [ ] Edge cases: empty sets, identical timestamps, same actor concurrent writes\n\n# How This Serves Overarching Goals\n\nThis is the heart of Bones' \"CRDTs over coordination\" philosophy. Correct merge logic = correct convergence = no merge conflicts ever.","acceptance_criteria":"All 5 children (2y3.1-2y3.5) complete and passing tests\nWorkItem aggregate merges correctly across all field types\nSemilattice properties hold for whole-item merge (property tests pass)\nIntegration test: divergent WorkItem states converge to identical result","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-16T02:22:29.391487318Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:21.702185022Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","crdt","phase-1"],"dependencies":[{"issue_id":"bn-2y3","depends_on_id":"bn-2h9","type":"blocks","created_at":"2026-02-16T04:25:34.943248388Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2y3","depends_on_id":"bn-2jr","type":"blocks","created_at":"2026-02-16T02:26:41.399819746Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2y3","depends_on_id":"bn-2o3","type":"blocks","created_at":"2026-02-16T02:26:41.628256964Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2y3","depends_on_id":"bn-2zf","type":"blocks","created_at":"2026-02-16T02:26:41.514578477Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2y3","depends_on_id":"bn-hws","type":"blocks","created_at":"2026-02-16T02:26:41.734909556Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":9,"issue_id":"bn-2y3","author":"1","text":"Critical review pass: user value = mathematically deterministic conflict resolution across all item fields, eliminating manual merge conflict work. Failure modes = tie-break inconsistencies, OR-Set remove/add divergence, and epoch-phase reopen bugs causing state regressions. Alternative considered: simpler LWW-only model for all fields; rejected because it loses set semantics and correctness under concurrent edits. Chosen approach: mixed CRDT field model with formal merge laws from bn-2jr. Coverage path: unit verification bn-hws + in-bead merge tests, e2e/workflow bn-yot.3 + bn-385, diagnostics/log artifacts bn-3oz + bn-1js.","created_at":"2026-02-16T02:59:04Z"},{"id":24,"issue_id":"bn-2y3","author":"bones-dev","text":"TERMINOLOGY UPDATE: LWW tie-breaking step 3 compares agent_id (not actor_id) lexicographically.","created_at":"2026-02-16T03:14:21Z"}]}
{"id":"bn-2y3.1","title":"Implement LWW Register with deterministic 4-step tie-breaking","description":"# Context\nLWW (Last-Writer-Wins) Register is the CRDT for scalar fields: title, description, kind, size, urgency, parent. The merge uses a 4-step deterministic tie-breaking chain that guarantees bit-identical convergence.\n\n# Implementation\n- `crates/bones-core/src/crdt/lww.rs` — LwwRegister<T>\n- Struct: { value: T, itc_stamp: Stamp, wall_ts: u64, agent_id: String, event_hash: Hash }\n- merge(a, b): (1) ITC causal dominance → winner, (2) if concurrent: higher wall_ts wins, (3) if equal: lexicographically greater agent_id wins, (4) if equal: lexicographically greater event_hash wins\n- The total order must have NO ties — step 4 (event_hash) guarantees uniqueness\n\n# Acceptance Criteria\n- [ ] merge() produces deterministic winner for all 4 tie-breaking steps\n- [ ] ITC causal dominance correctly identified (uses leq from bn-2zf)\n- [ ] Concurrent writes resolved by wall_ts, then agent_id, then event_hash\n- [ ] Semilattice properties: commutative, associative, idempotent\n- [ ] Self-merge is identity (idempotence)\n- [ ] Edge cases: identical timestamps + different agents, same agent concurrent writes","acceptance_criteria":"LWW Register generic over value type T\n4-step deterministic tie-breaking: ITC causal > wall_ts > agent_id > event_hash\nMerge is commutative, associative, and idempotent (semilattice laws)\nProperty tests: semilattice conformance via quickcheck/proptest\nUnit tests: causal win, timestamp win, agent tiebreak, hash tiebreak","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:05:21.251130379Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:04.872172647Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","crdt","phase-1"],"dependencies":[{"issue_id":"bn-2y3.1","depends_on_id":"bn-2y3","type":"parent-child","created_at":"2026-02-16T04:05:21.251130379Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":34,"issue_id":"bn-2y3.1","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:04Z"}]}
{"id":"bn-2y3.2","title":"Implement OR-Set via Eg-Walker DAG replay","description":"# Context\nOR-Set (Observed-Remove Set) for collection fields: assignees, labels, blocked_by, related_to. Instead of classical OR-Sets with tombstones, uses the Eg-Walker DAG to determine causality. An add is visible unless causally superseded by a remove.\n\n# Implementation\n- `crates/bones-core/src/crdt/orset.rs` — OrSet<T>\n- Operations stored as events in the DAG (add/remove with causal parent hashes)\n- Materialization: replay events from LCA, apply add/remove in causal order\n- An element is present if: most recent causal operation for it is an add\n- Concurrent add+remove: add wins (add-wins semantics, standard for OR-Sets)\n\n# Acceptance Criteria\n- [ ] Concurrent adds converge (both present)\n- [ ] Concurrent add+remove: element present (add-wins)\n- [ ] Causal remove after add: element absent\n- [ ] Multiple add/remove cycles converge correctly\n- [ ] Semilattice properties hold\n- [ ] Empty set merge is empty set\n- [ ] Works with DAG replay from bn-2o3","acceptance_criteria":"OR-Set implemented via Eg-Walker DAG replay (not classical per-element metadata)\nAdd/remove operations converge without conflicts across replicas\nConcurrent add+remove of same element: add wins (OR-Set semantics)\nUsed for: assignees, labels, blocked_by, related_to fields\nProperty tests: concurrent add/remove convergence\nUnit tests: add, remove, concurrent operations, replay from different orderings","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:05:21.367415983Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:04.997499389Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","crdt","phase-1"],"dependencies":[{"issue_id":"bn-2y3.2","depends_on_id":"bn-2y3","type":"parent-child","created_at":"2026-02-16T04:05:21.367415983Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":35,"issue_id":"bn-2y3.2","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:04Z"}]}
{"id":"bn-2y3.3","title":"Implement G-Set (grow-only set) for comments","description":"# Context\nComments are append-only — they are never deleted or edited. G-Set (Grow-only Set) is the simplest CRDT: merge is set union.\n\n# Implementation\n- `crates/bones-core/src/crdt/gset.rs` — GSet<T>\n- Elements are event hashes referencing comment content\n- merge(a, b) = a.union(b)\n- Trivially satisfies all semilattice laws\n\n# Acceptance Criteria\n- [ ] Union merge works correctly\n- [ ] Duplicate insertions are idempotent\n- [ ] Semilattice properties hold (trivially)\n- [ ] Integrates with redaction (redacted comments show [redacted] in projection, but event hash remains in G-Set)","acceptance_criteria":"G-Set (grow-only): comments can be added but never removed\nEach comment stored with agent, timestamp, body, and event hash\nMerge is union of both sets (idempotent dedup by event hash)\nComments ordered by timestamp for display but set membership is unordered\nUnit tests: add comments, merge two G-Sets, dedup on replay","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:05:21.488373057Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:05.122465595Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","crdt","phase-1"],"dependencies":[{"issue_id":"bn-2y3.3","depends_on_id":"bn-2y3","type":"parent-child","created_at":"2026-02-16T04:05:21.488373057Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":36,"issue_id":"bn-2y3.3","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:04Z"}]}
{"id":"bn-2y3.4","title":"Implement epoch+phase state CRDT with reopen semantics","description":"# Context\nWork item state (open/doing/done/archived) uses a non-standard (epoch, phase) CRDT. This handles the concurrent close/reopen problem: if agent A closes an item while agent B reopens it, the higher epoch wins.\n\n# Implementation\n- `crates/bones-core/src/crdt/state.rs` — EpochPhase CRDT\n- Phase enum: Open=0, Doing=1, Done=2, Archived=3 (rank ordering)\n- Reopen: increments epoch, sets phase=Open\n- merge(a, b): max(epoch), then max(phase_rank) within same epoch\n- This preserves semilattice laws while supporting reopen\n\n# Acceptance Criteria\n- [ ] Phase ranking: Open < Doing < Done < Archived\n- [ ] Same epoch: higher phase wins\n- [ ] Different epochs: higher epoch wins regardless of phase\n- [ ] Reopen increments epoch correctly\n- [ ] Concurrent close+reopen: higher epoch (reopen) wins\n- [ ] Semilattice properties hold (commutative, associative, idempotent)\n- [ ] Edge: multiple reopens produce monotonically increasing epochs","acceptance_criteria":"State represented as (epoch, phase) tuple\nphase in {open, doing, done, archived} with defined rank ordering\nReopen increments epoch and sets phase=open\nMerge: max(epoch), then max(phase_rank) within same epoch\nPreserves semilattice laws while supporting reopen semantics\nProperty tests: semilattice conformance for epoch+phase merge\nUnit tests: normal transitions, concurrent state changes, reopen across epochs","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:05:38.576983158Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:05.254720546Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","crdt","phase-1"],"dependencies":[{"issue_id":"bn-2y3.4","depends_on_id":"bn-2y3","type":"parent-child","created_at":"2026-02-16T04:05:38.576983158Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":37,"issue_id":"bn-2y3.4","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:05Z"}]}
{"id":"bn-2y3.5","title":"Implement WorkItem aggregate composing all field CRDTs","description":"# Context\nA WorkItem is the composite CRDT combining all field-level CRDTs into a single mergeable aggregate. This is what the projection layer materializes and the CLI displays.\n\n# Implementation\n- `crates/bones-core/src/crdt/item_state.rs` or `crates/bones-core/src/item.rs` — WorkItemState\n- Fields: title (LWW), description (LWW), kind (LWW), state (EpochPhase), size (LWW), urgency (LWW), parent (LWW nullable), assignees (OrSet), labels (OrSet), blocked_by (OrSet<ItemId>), related_to (OrSet<ItemId>), comments (GSet)\n- merge(a, b): delegate to each field's CRDT merge\n- Apply event: given an Event, update the appropriate field's CRDT\n- Default state: all LWWs empty, all sets empty, state=(0, Open)\n\n# Acceptance Criteria\n- [ ] All fields merge correctly as aggregate\n- [ ] Event application updates correct field\n- [ ] merge(a, b) delegates to each field's merge\n- [ ] Default/empty WorkItemState works correctly\n- [ ] Round-trip: apply events then merge == merge then apply events (commutativity)","acceptance_criteria":"WorkItem struct composes all field CRDTs (LWW for title/desc/kind/state/size/urgency/parent, OR-Set for assignees/labels/deps, G-Set for comments)\nSingle merge function that delegates to each fields CRDT merge\nWhole-item merge preserves semilattice laws\nEvent application: take an Event and update the appropriate field CRDT\nProperty tests: whole-item merge commutativity/associativity/idempotence\nUnit tests: apply sequence of events, merge two divergent WorkItems","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:05:38.695613026Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:05.386497821Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","crdt","phase-1"],"dependencies":[{"issue_id":"bn-2y3.5","depends_on_id":"bn-2y3","type":"parent-child","created_at":"2026-02-16T04:05:38.695613026Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2y3.5","depends_on_id":"bn-2y3.1","type":"blocks","created_at":"2026-02-16T04:05:44.596551483Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2y3.5","depends_on_id":"bn-2y3.2","type":"blocks","created_at":"2026-02-16T04:05:44.707773669Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2y3.5","depends_on_id":"bn-2y3.3","type":"blocks","created_at":"2026-02-16T04:05:44.819905130Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2y3.5","depends_on_id":"bn-2y3.4","type":"blocks","created_at":"2026-02-16T04:05:44.935176709Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":38,"issue_id":"bn-2y3.5","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:05Z"}]}
{"id":"bn-2yo","title":"E2E extended CLI workflows (update/list filters/labels/comments)","description":"# Context\n\nCore lifecycle e2e coverage is in bn-yot.4, dependency workflows in bn-3i7, and operational workflows in bn-36d. This bead covers the remaining high-usage CLI surfaces so regressions are caught before release.\n\n# Scope\n\n- `bn update` / `bn close` / `bn reopen` mutation workflows\n- Advanced `bn list` filtering/sorting/pagination behavior\n- Label namespace workflows (`bn label add/rm`, `bn labels`)\n- Comment workflows (`bn comment add/list`) and visibility in `bn show`\n- Goal auto-close/reopen policy workflows (including override behavior)\n- JSON contract assertions for all commands in scope\n\n# Acceptance Criteria\n\n- [ ] Happy-path and representative error-path workflows pass\n- [ ] Pagination/filtering outputs are deterministic and automation-safe\n- [ ] Label and comment behavior converges under concurrent event scenarios\n- [ ] Goal policy workflows produce deterministic close/reopen outcomes\n- [ ] `--json` outputs parse and match expected schemas\n- [ ] Failed runs preserve diagnostics artifacts (structured logs + traces)\n\n# Coverage Path\n\n- Unit verification: bn-3t9, bn-2uw, bn-23o, bn-zlz, bn-3lp\n- E2E/workflow verification: this bead\n- Diagnostic logging/artifacts: bn-1js, bn-m80\n","acceptance_criteria":"E2E test: bn update modifies item fields correctly\nE2E test: bn list filters by state/label/kind/urgency\nE2E test: label operations (tag/untag) reflected in list output\nE2E test: comment operations (add/list) work correctly\nAll tests via CLI subprocess with both text and JSON output verification","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T03:14:08.701162709Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:38.863540021Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","e2e","phase-2","quality-gate","testing"],"dependencies":[{"issue_id":"bn-2yo","depends_on_id":"bn-1js","type":"blocks","created_at":"2026-02-16T03:14:14.208431663Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2yo","depends_on_id":"bn-23o","type":"blocks","created_at":"2026-02-16T03:14:13.977822104Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2yo","depends_on_id":"bn-2uw","type":"blocks","created_at":"2026-02-16T03:14:13.864935176Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2yo","depends_on_id":"bn-3lp","type":"blocks","created_at":"2026-02-16T03:16:04.913760746Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2yo","depends_on_id":"bn-3t9","type":"blocks","created_at":"2026-02-16T03:14:13.753304362Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2yo","depends_on_id":"bn-m80","type":"blocks","created_at":"2026-02-16T03:14:14.320275536Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2yo","depends_on_id":"bn-zlz","type":"blocks","created_at":"2026-02-16T03:14:14.096388817Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-2zf","title":"Implement Interval Tree Clocks (ITC)","description":"# Context\n\nInterval Tree Clocks replace vector clocks for causal ordering. Clock size scales with currently-active agents, not all historical agents — critical for ephemeral AI agent swarms.\n\n# Goals\n\n- Implement ITC with fork, join, event, and peek operations\n- Implement causal dominance comparison (partial order)\n- Implement compact binary serialization\n- All operations O(log n) in the number of active participants\n\n# Background\n\nSource: Almeida, Baquero & Fonte (2008). The ITC partitions [0, 1) among active participants. Fork splits an interval, join reclaims it. Stamp = (ID tree, Event tree). Causal comparison via tree dominance.\n\n# Implementation Approach\n\n## Key Components\n\n1. ID tree: binary tree representing identity partition of [0, 1)\n2. Event tree: binary tree of counters representing event history\n3. Stamp: pair of (ID tree, Event tree)\n4. Operations: fork, join, event, peek, leq, concurrent\n5. Serialization: compact binary encoding (~20-50 bytes typical)\n\n## Files to Create/Modify\n\n- crates/bones-core/src/clock/itc.rs — ITC implementation\n- crates/bones-core/src/clock/mod.rs — Clock module\n- tests/itc_properties.rs — Property tests\n\n## Technical Considerations\n\n- Tree normalization crucial for compact representation\n- leq comparison is the foundation of LWW tie-breaking\n- Consider flat array representation internally for cache efficiency\n\n## Acceptance Criteria\n\n- [ ] fork() produces valid stamps covering original interval\n- [ ] join() recombines stamps correctly\n- [ ] event() increments monotonically\n- [ ] leq() correctly identifies causal dominance\n- [ ] concurrent() correctly identifies concurrent stamps\n- [ ] Property tests: fork/join roundtrip, monotonicity, transitivity\n- [ ] Serialization roundtrip: deserialize(serialize(stamp)) == stamp\n- [ ] Serialized size <= 50 bytes for typical stamps\n\n# How This Serves Overarching Goals\n\nITC keeps clock size proportional to active agents, enabling efficient ephemeral swarm operation without unbounded vector clock growth.","acceptance_criteria":"All 3 children (2zf.1-2zf.3) complete and passing tests\nITC stamps can be forked/joined/compared across concurrent agents\nSerialization format documented and roundtrip-verified\nProperty tests confirm O(active agents) scaling","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-16T02:21:39.410581260Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:21.421816748Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["clocks","core","crdt","phase-1"],"dependencies":[{"issue_id":"bn-2zf","depends_on_id":"bn-2h9","type":"blocks","created_at":"2026-02-16T04:25:35.296216676Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2zf","depends_on_id":"bn-2vb","type":"blocks","created_at":"2026-02-16T02:26:41.175180945Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":6,"issue_id":"bn-2zf","author":"1","text":"Critical review pass: user value = scalable causality tracking for ephemeral agent swarms without vector-clock blowup. Failure modes = incorrect leq/concurrency semantics causing non-deterministic merges, serialization overhead that hurts hot paths, and fork/join bugs that break monotonicity. Alternative considered: vector clocks; rejected due unbounded dimension growth and poor fit for dynamic agent churn. Chosen approach: ITC with strict normalization and serialization constraints. Coverage path: unit verification bn-yot.2 + in-bead property tests, e2e/workflow bn-yot.5 and bn-385, diagnostics/log artifacts bn-3oz + bn-1js.","created_at":"2026-02-16T02:58:53Z"}]}
{"id":"bn-2zf.1","title":"Implement ITC ID tree and Event tree data structures","description":"# Context\nThe ITC stamp is a pair of (ID tree, Event tree). The ID tree partitions [0,1) among agents. The Event tree tracks causal history as a binary tree of counters.\n\n# Implementation\n- `crates/bones-core/src/clock/itc.rs`\n- IdTree: binary tree where leaves are 0 (not owned) or 1 (owned)\n- EventTree: binary tree of counters, effective count = sum along root-to-leaf path\n- Stamp: (IdTree, EventTree) pair\n- Tree normalization: collapse single-child nodes for compact representation\n- Consider flat array representation for cache efficiency\n\n# Acceptance Criteria\n- [ ] IdTree correctly represents interval partitions\n- [ ] EventTree correctly tracks causal history\n- [ ] Tree normalization produces minimal representation\n- [ ] Stamp struct combines ID and Event trees\n- [ ] Memory layout is cache-friendly","acceptance_criteria":"ID tree type: binary tree of 0/1 leaf values representing agent ownership intervals\nEvent tree type: binary tree of integer values representing event counts per interval\nBoth trees support normalization (canonicalization of equivalent representations)\nMemory-efficient representation (avoid unnecessary tree depth)\nUnit tests: construct, normalize, equality for known tree shapes","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:24:52.562010328Z","created_by":"bones-dev","updated_at":"2026-02-16T04:41:51.020308292Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["clocks","core","phase-1"],"dependencies":[{"issue_id":"bn-2zf.1","depends_on_id":"bn-2zf","type":"parent-child","created_at":"2026-02-16T04:24:52.562010328Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":52,"issue_id":"bn-2zf.1","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:06Z"}]}
{"id":"bn-2zf.2","title":"Implement ITC operations: fork, join, event, peek, leq, concurrent","description":"# Context\nCore ITC operations for agent lifecycle and causal comparison. These are the public API that the CRDT layer uses.\n\n# Implementation\n- fork(stamp) -> (stamp_a, stamp_b): split interval for new agent\n- join(a, b) -> stamp: merge intervals when agent retires\n- event(stamp) -> stamp: increment (called on every event emission)\n- peek(stamp) -> value: read without incrementing\n- leq(a, b) -> bool: causal dominance (a happened-before b)\n- concurrent(a, b) -> bool: neither dominates\n- All operations O(log n) in active participants\n\n# Acceptance Criteria\n- [ ] fork() produces two stamps covering original interval\n- [ ] join() recombines correctly\n- [ ] event() monotonically increases\n- [ ] leq() identifies causal dominance correctly\n- [ ] concurrent() identifies concurrent stamps\n- [ ] Property tests: fork/join roundtrip, monotonicity, transitivity of leq\n- [ ] Multi-agent scenario: 2/4/8/16 agents fork/work/retire cycle","acceptance_criteria":"fork: split stamp into two causally independent stamps\njoin: merge two stamps into one (reunify intervals)\nevent: increment local event counter, return updated stamp\npeek: read current event state without modifying stamp\nleq: causal ordering comparison (a happened-before b)\nconcurrent: detect concurrent stamps (neither leq the other)\nAll operations are O(log n) where n = active agents\nUnit tests: fork/join roundtrip, causal ordering chains, concurrent detection","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:24:52.684313245Z","created_by":"bones-dev","updated_at":"2026-02-16T04:41:51.143744810Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["clocks","core","phase-1"],"dependencies":[{"issue_id":"bn-2zf.2","depends_on_id":"bn-2zf","type":"parent-child","created_at":"2026-02-16T04:24:52.684313245Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2zf.2","depends_on_id":"bn-2zf.1","type":"blocks","created_at":"2026-02-16T04:24:52.931267920Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":53,"issue_id":"bn-2zf.2","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:07Z"}]}
{"id":"bn-2zf.3","title":"Implement ITC compact binary serialization","description":"# Context\nITC stamps are embedded in every event. Compact serialization keeps event size small (~20-50 bytes typical).\n\n# Implementation\n- `crates/bones-core/src/clock/serde.rs`\n- Binary encoding: recursive tree structure as compact byte sequence\n- Leaf encoding: 1 bit for type, varint for value\n- Branch encoding: 1 bit for type, then left subtree, then right subtree\n- Document format as part of normative spec\n\n# Acceptance Criteria\n- [ ] Serialization roundtrip: deserialize(serialize(stamp)) == stamp\n- [ ] Serialized size <= 50 bytes for <= 8 active agents\n- [ ] Size <= 20 bytes for single-agent stamps\n- [ ] Format documented\n- [ ] Fuzz testing: random stamps always round-trip correctly","acceptance_criteria":"Compact binary format for ITC stamps (~20-50 bytes typical)\nSerialize/deserialize roundtrip preserves exact stamp state\nFormat documented with bit-level layout\nSize scales with active agents, not historical total\nUnit tests: roundtrip for various tree depths, size benchmarks vs vector clocks","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:24:52.810170433Z","created_by":"bones-dev","updated_at":"2026-02-16T04:41:51.270455036Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["clocks","core","phase-1"],"dependencies":[{"issue_id":"bn-2zf.3","depends_on_id":"bn-2zf","type":"parent-child","created_at":"2026-02-16T04:24:52.810170433Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2zf.3","depends_on_id":"bn-2zf.1","type":"blocks","created_at":"2026-02-16T04:24:53.055389205Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":54,"issue_id":"bn-2zf.3","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:07Z"}]}
{"id":"bn-2zs","title":"Integration test: search quality across all three layers with fusion","description":"End-to-end test that creates items with known semantic, lexical, and structural relationships, then verifies that search and duplicate detection surface the correct results with appropriate scores. Uses the gold evaluation dataset from bn-2ly.1.","acceptance_criteria":"Integration test exercises all three search layers (FTS5, semantic, structural)\nVerifies fusion ranking improves over individual layers\nTests duplicate detection at each threshold\nTests bn similar and bn dedup commands\nAll tests use gold evaluation dataset\nTests pass in CI","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T04:57:12.936231009Z","created_by":"bones-dev","updated_at":"2026-02-16T04:57:40.827282333Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-3","search"],"dependencies":[{"issue_id":"bn-2zs","depends_on_id":"bn-2j7","type":"blocks","created_at":"2026-02-16T04:57:34.750366193Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2zs","depends_on_id":"bn-2ly.1","type":"blocks","created_at":"2026-02-16T04:57:35.476719281Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-2zs","depends_on_id":"bn-ihh","type":"blocks","created_at":"2026-02-16T04:57:34.141891802Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":90,"issue_id":"bn-2zs","author":"bones-dev","text":"Implementation must ship unit tests alongside the code.","created_at":"2026-02-16T04:57:40Z"}]}
{"id":"bn-30j","title":"Build dependency graph from SQLite for triage computation","description":"# Context\n\nThe triage engine operates on a dependency graph constructed from SQLite. This bead builds the petgraph-based graph structure and the normalization pipeline (SCC condensation, transitive reduction) that feeds into all centrality and scheduling computations.\n\n# Goals\n\n- Construct directed dependency graph from SQLite blocking relationships\n- Implement SCC condensation (collapse strongly connected components into single nodes)\n- Implement transitive reduction (remove redundant edges)\n- Preserve original graph for display alongside normalized graph for metrics\n- Implement basic graph statistics (density, component count, edge count)\n\n# Implementation Approach\n\nUse petgraph crate. Query SQLite for all blocking edges, build DiGraph. Run Tarjan's SCC algorithm, build condensation DAG. Compute transitive reduction on condensation. Cache results with content hash of edge set.\n\n## Files to Create/Modify\n\n- crates/bones-triage/src/graph/build.rs — Graph construction from SQLite\n- crates/bones-triage/src/graph/normalize.rs — SCC condensation + transitive reduction\n- crates/bones-triage/src/graph/stats.rs — Basic statistics\n- crates/bones-triage/src/graph/mod.rs — Module\n\n## Acceptance Criteria\n\n- [ ] Graph correctly represents all blocking relationships\n- [ ] SCC condensation merges cyclic components\n- [ ] Transitive reduction removes redundant edges\n- [ ] Original graph preserved for display\n- [ ] Graph rebuilt when event log changes (cache invalidation)\n- [ ] Statistics: node count, edge count, density, SCC count\n\n# How This Serves Overarching Goals\n\nThe normalized graph is the foundation for all triage metrics. SCC condensation ensures stable centrality measures. The triage engine is the differentiator that makes Bones more than just an issue tracker.","acceptance_criteria":"DiGraph built from SQLite blocking edges; Tarjan SCC condensation; transitive reduction; original graph preserved; basic stats (density, components, edges); cached with content hash","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:23:46.773429411Z","created_by":"bones-dev","updated_at":"2026-02-16T04:08:33.988403694Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["graph","phase-2","triage"],"dependencies":[{"issue_id":"bn-30j","depends_on_id":"bn-1nr","type":"blocks","created_at":"2026-02-16T02:27:06.850220437Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-30j","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T02:27:06.740752800Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-34z","title":"Implement bn plan, bn health, bn cycles diagnostic commands","description":"# Context\nPlanning and health diagnostic commands that provide transparency into triage intelligence.\n\n# Implementation\n- bn plan: parallelizable execution plan for all open items\n- bn plan <goal-id>: plan scoped to a specific goal's children\n- bn health: project health dashboard (metrics, warnings, topology summary)\n- bn cycles: show dependency cycles with involved items\n- All support --json output","acceptance_criteria":"bn plan produces parallelizable execution plan showing independent work streams\nbn plan <goal-id> scopes plan to specific goal children\nbn health shows project health dashboard with key metrics and warnings\nbn cycles lists dependency cycles with all involved items\nAll commands produce --json output\nUnit tests: plan generation, health metrics, cycle reporting","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:47:37.892541484Z","created_by":"bones-dev","updated_at":"2026-02-16T04:50:22.475894311Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-2","triage"],"dependencies":[{"issue_id":"bn-34z","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T04:47:53.544088164Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-34z","depends_on_id":"bn-sep","type":"blocks","created_at":"2026-02-16T04:47:53.414742514Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":69,"issue_id":"bn-34z","author":"bones-dev","text":"Implementation must ship unit tests alongside the code. Tests should be in the same PR/commit as the implementation.","created_at":"2026-02-16T04:50:22Z"}]}
{"id":"bn-36a","title":"Incremental projection rebuild and invalidation","description":"# Context\n\nFast startup and command latency depend on replaying only new events when safe. This bead adds incremental rebuild with robust invalidation conditions.\n\n# Scope\n\n- Track high-water marks per shard/event sequence\n- Replay only unseen events on incremental refresh\n- Invalidation triggers for full rebuild (schema/version/corruption/shard drift)\n- `bn rebuild --full` override behavior and consistency checks\n\n# Acceptance Criteria\n\n- [ ] Incremental refresh matches full rebuild state exactly for unchanged schema\n- [ ] Invalidation triggers are deterministic and test-covered\n- [ ] Full rebuild fallback is automatic when safety conditions are violated\n- [ ] Incremental refresh meets documented latency target on small deltas\n- [ ] Coverage path is explicit: unit (high-water/invalidation tests), e2e/workflow (bn-yot.3 + bn-zr8), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"Incremental projection: only replay new events since last high-water mark\nInvalidation: detect when full rebuild is needed (schema change, corrupt DB)\nPerformance: incremental update for 100 new events completes in <50ms\nFallback: if incremental fails, trigger full rebuild with notification\nUnit tests: incremental update, invalidation trigger, fallback behavior","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:42:15.111024522Z","created_by":"bones-dev","updated_at":"2026-02-16T04:50:11.350260313Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["performance","phase-2","sqlite"],"dependencies":[{"issue_id":"bn-36a","depends_on_id":"bn-38t","type":"blocks","created_at":"2026-02-16T02:42:41.271200155Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-36a","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:42:41.384728513Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-36a","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T04:50:11.350222152Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-36d","title":"E2E workflows for operational CLI commands (search/verify/history)","description":"# Context\n\nCore lifecycle workflows are covered in bn-yot.4, dependency workflows in bn-3i7, and extended mutation/list workflows in bn-2yo. This bead validates operational Phase 2 commands.\n\n# Scope\n\n- End-to-end subprocess tests for: `bn search`, `bn dup` (lexical baseline), `bn verify`, `bn history`\n- Validate both human output and `--json` contract stability\n- Include corrupted-shard and stale-projection scenarios for `verify`/`history`\n- Capture diagnostic artifacts (logs + command traces) for failed runs\n\n# Out of Scope\n\n- Reporting/interop command e2e (`stats`, `export`/`import`) is handled by bn-3ls\n\n# Acceptance Criteria\n\n- [ ] Happy-path e2e flows pass for each command family\n- [ ] Error-path e2e flows return non-zero code + actionable message\n- [ ] Every command in scope has `--json` parseability assertions\n- [ ] Failed tests preserve diagnostic artifacts (structured logs + trace output)\n\n# Coverage Path\n\n- Unit verification: owned by each command implementation bead\n- E2E/workflow verification: this bead\n- Diagnostic logging/artifacts: bn-1js, bn-m80\n","acceptance_criteria":"E2E test: bn search returns relevant results for keyword queries\nE2E test: bn verify checks shard integrity and reports status\nE2E test: bn log shows event history with correct entries\nAll tests via CLI subprocess with JSON output verification\nTests run on a pre-populated test corpus","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:57:08.942837254Z","created_by":"1","updated_at":"2026-02-16T04:45:39.110072633Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["e2e","phase-2","quality-gate","testing"],"dependencies":[{"issue_id":"bn-36d","depends_on_id":"bn-1js","type":"blocks","created_at":"2026-02-16T02:57:16.800955463Z","created_by":"1","metadata":"{}","thread_id":""},{"issue_id":"bn-36d","depends_on_id":"bn-298","type":"blocks","created_at":"2026-02-16T02:57:16.676294200Z","created_by":"1","metadata":"{}","thread_id":""},{"issue_id":"bn-36d","depends_on_id":"bn-2a7","type":"blocks","created_at":"2026-02-16T02:57:16.198444836Z","created_by":"1","metadata":"{}","thread_id":""},{"issue_id":"bn-36d","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:57:16.052846781Z","created_by":"1","metadata":"{}","thread_id":""},{"issue_id":"bn-36d","depends_on_id":"bn-m80","type":"blocks","created_at":"2026-02-16T02:57:16.941179983Z","created_by":"1","metadata":"{}","thread_id":""},{"issue_id":"bn-36d","depends_on_id":"bn-v45","type":"blocks","created_at":"2026-02-16T02:57:16.548020374Z","created_by":"1","metadata":"{}","thread_id":""}]}
{"id":"bn-379","title":"ADR: Item ID generation scheme","description":"# Context\n\nItem IDs appear in every command, every event, and every merge. The ID scheme must be collision-safe offline, stable across repos, and ergonomic for humans/agents before parser and model implementation begin.\n\n# Decision Questions\n\n- Candidate formats: UUIDv7, ULID, short content hash, prefixed deterministic IDs\n- Sortability vs readability trade-offs\n- Collision and spoofing risk under offline multi-agent generation\n- Namespace strategy (`bn-` prefix, repo scope, migration compatibility)\n- Validation and canonical formatting rules\n\n# Deliverables\n\n- ADR document in `docs/adr/` choosing the normative ID scheme\n- Canonical grammar/regex and normalization rules\n- Collision handling policy and security notes\n- CLI UX examples (copy/paste form, short display form if any)\n\n# Acceptance Criteria\n\n- [ ] Decision includes at least one realistic alternative with explicit rejection rationale\n- [ ] ID grammar is precise enough for parser validators and error messages\n- [ ] Collision strategy is documented (structural impossibility or deterministic recovery path)\n- [ ] Decision is linked from bn-3rr.1 and referenced by bn-x2e / bn-3m6\n- [ ] Coverage path is explicit: unit (bn-x2e + bn-3m6 ID validation tests), e2e (bn-yot.4 CLI invalid-ID workflows), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"ADR documents: terseid integration, bn- prefix convention, adaptive length strategy\nADR covers: collision avoidance tiers, child ID format, partial resolution rules\nADR records alternatives considered and rationale for terseid\nDecision is self-contained (reader needs no external context)\nADR follows project ADR template format","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:43:00.853048795Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:01.288063506Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["adr","architecture","phase-0"],"comments":[{"id":3,"issue_id":"bn-379","author":"1","text":"Critical review revision: user value = guarantee stable offline-safe IDs so agents can script confidently and users can reference items without ambiguity. Risks = collisions, non-canonical representations, and hard-to-debug merge ambiguity across repos. Alternatives considered: UUIDv7 and ULID; both viable, but a short canonical format with explicit validation rules was preferred for CLI ergonomics while preserving uniqueness guarantees. Chosen approach explicitly captures fallback/collision policy and parser grammar so implementation can proceed without hidden assumptions.","created_at":"2026-02-16T02:58:14Z"},{"id":8,"issue_id":"bn-379","author":"bones-dev","text":"Decision: use terseid (github.com/bobisme/terseid, ~/src/terseid) for all item ID generation. terseid provides adaptive-length base36 IDs with collision avoidance, child ID support (bn-xxx.1.3), and CLI resolution (partial matching). Prefix: 'bn'. Seed function: title+description+nonce for deterministic-ish IDs, or random bytes for fully random. Use IdResolver for CLI argument parsing. This ADR is now a documentation task: record the decision and integration notes.","created_at":"2026-02-16T02:59:04Z"},{"id":27,"issue_id":"bn-379","author":"bones-dev","text":"DECISION PRE-MADE: The plan specifies terseid (github.com/bobisme/terseid) for item IDs. Format: bn-<base36hash> with adaptive length, 4-tier collision avoidance. This ADR should document the decision and rejection rationale for alternatives (UUIDv7, ULID), not re-decide. See ws/default/notes/plan.md 'Item IDs: terseid' section.","created_at":"2026-02-16T04:23:32Z"}]}
{"id":"bn-37f","title":"Implement TUI detail view, comments, and dependency graph display","description":"# Context\nDetail views for individual items including comments and dependency visualization.\n\n# Implementation\n- Detail panel: full item info (title, description, state, labels, assignees)\n- Comment timeline view (scrollable)\n- Dependency graph: ASCII tree showing blocks/blocked-by relationships\n- Goal progress view: tree of children with completion status\n- Split-pane layout (list + detail)","acceptance_criteria":"Detail panel shows full item info (title, description, state, etc.)\nComment timeline scrollable with agent attribution\nDependency tree: ASCII visualization of blocks/blocked-by\nGoal progress: tree of children with completion percentages\nSplit-pane layout: list on left, detail on right\nUnit tests: detail rendering, comment display, dependency tree","status":"open","priority":3,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:48:21.460515530Z","created_by":"bones-dev","updated_at":"2026-02-16T04:50:23.201732710Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-5","tui"],"dependencies":[{"issue_id":"bn-37f","depends_on_id":"bn-38j","type":"blocks","created_at":"2026-02-16T04:48:41.905895141Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":75,"issue_id":"bn-37f","author":"bones-dev","text":"Implementation must ship unit tests alongside the code. Tests should be in the same PR/commit as the implementation.","created_at":"2026-02-16T04:50:23Z"}]}
{"id":"bn-385","title":"Multi-agent convergence integration tests","description":"# Context\n\nCRDT guarantees are only meaningful when verified under realistic multi-agent interleavings and merge orders. This bead validates end-to-end convergence behavior.\n\n# Scope\n\n- 3+ agent concurrent mutation scenarios over shared items\n- Merge-order permutation checks for equivalent final state\n- Conflict classes: LWW ties, OR-Set add/remove races, epoch/phase races, dependency updates\n- Integration with deterministic simulation seeds for reproducibility\n\n# Acceptance Criteria\n\n- [ ] Final materialized state is identical across all replicas after delivery drain\n- [ ] Merge-order permutations preserve convergence invariants\n- [ ] Failures emit reproducible seeds and diagnostic traces\n- [ ] Test suite covers representative conflict classes with explicit fixtures\n- [ ] Coverage path is explicit: unit (CRDT law tests in bn-hws), e2e/workflow (this bead), diagnostics/log artifacts (bn-3oz + bn-1js + bn-m80)\n","acceptance_criteria":"Simulation: 3+ agents generate concurrent events on shared items\nVerify all replicas converge to identical state after merge\nTest with various merge orderings (all permutations for small sets)\nTest with network partition simulation (offline agents rejoin)\nProperty test: convergence holds for random event sequences","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:43:42.204158400Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:39.371144914Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["crdt","cross-cutting","integration","phase-2","testing"],"dependencies":[{"issue_id":"bn-385","depends_on_id":"bn-2ne","type":"blocks","created_at":"2026-02-16T02:44:06.756678816Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-385","depends_on_id":"bn-2y3","type":"blocks","created_at":"2026-02-16T02:44:06.865567527Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-385","depends_on_id":"bn-2zf","type":"blocks","created_at":"2026-02-16T02:44:06.975201969Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-38j","title":"Implement TUI list view with filtering and item navigation","description":"# Context\nCore TUI view: item list with filtering and navigation, ported from beads-tui.\n\n# Implementation\n- ratatui list widget showing items with state, kind, urgency, labels\n- Filter bar: filter by state, kind, label, urgency (keyboard-driven)\n- Sort options: priority, created, updated\n- Item selection and navigation (j/k, arrow keys)\n- Reads from Bones SQLite projection\n- Port relevant UI patterns from ~/src/beads-tui/ws/default/src/","acceptance_criteria":"ratatui list widget shows items with state, kind, urgency, labels\nFilter bar: filter by state, kind, label, urgency via keyboard\nSort options: priority, created, updated date\nj/k navigation, Enter to select, / to search\nReads from Bones SQLite projection (not event replay)\nUnit tests: list rendering, filter application, sort orders","status":"open","priority":3,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:48:21.332420695Z","created_by":"bones-dev","updated_at":"2026-02-16T04:50:23.083909041Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-5","tui"],"dependencies":[{"issue_id":"bn-38j","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T04:48:41.784185568Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":74,"issue_id":"bn-38j","author":"bones-dev","text":"Implementation must ship unit tests alongside the code. Tests should be in the same PR/commit as the implementation.","created_at":"2026-02-16T04:50:23Z"}]}
{"id":"bn-38t","title":"SQLite schema design and migrations","description":"# Context\n\nThe SQLite schema is the contract for all read/query workflows. A weak schema causes slow triage, brittle migrations, and replay mismatches. This bead defines the schema + migration strategy before projection logic expands.\n\n# Goals\n\n- Define normalized core tables for items, labels, dependencies, assignees, comments, and replay metadata\n- Define migration framework with explicit schema versioning\n- Define indexes for frequent list/filter/triage/search paths\n- Enable WAL mode and pragmatic defaults for safe concurrent reads\n\n# Implementation Approach\n\n- Keep write path append-only in event log; SQLite remains disposable projection\n- Store projection metadata (last event hash/offset) to support rebuild and drift detection\n- Use FTS5 virtual table for title/description/labels with weighted BM25 query support\n- Add migration smoke tests for empty DB and incremental upgrade paths\n\n## Files to Create/Modify\n\n- crates/bones-core/src/db/schema.rs\n- crates/bones-core/src/db/migrations/\n- crates/bones-core/src/db/mod.rs\n\n## Acceptance Criteria\n\n- [ ] Schema covers all currently planned event effects with no orphaned data paths\n- [ ] Migrations are idempotent and versioned (fresh init + upgrade path tested)\n- [ ] Required indexes exist and are verified with query-plan checks\n- [ ] WAL and busy-timeout defaults are documented and test-covered\n- [ ] Coverage path is explicit: unit (schema/migration tests in this bead), e2e/workflow (bn-yot.3 replay pipeline + bn-yot.4 list/show flows), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"SQLite schema versioning system for future migrations\nMigration runner: detect current version, apply pending migrations in order\nInitial migration creates all tables from bn-z23.1\nMigration files are embedded in the binary (not external SQL files)\nUnit tests: fresh DB gets latest schema, migration from each version","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:42:11.345932480Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:02.806373155Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-1","schema","sqlite"],"dependencies":[{"issue_id":"bn-38t","depends_on_id":"bn-2vb","type":"blocks","created_at":"2026-02-16T02:42:41.046377009Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-38t","depends_on_id":"bn-379","type":"blocks","created_at":"2026-02-16T03:20:07.402377536Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":4,"issue_id":"bn-38t","author":"1","text":"Critical review revision: user value = predictable fast queries without compromising replay correctness. Risks = schema drift from event model, slow queries from under-indexing, and migration breakage in long-lived repos. Alternative considered: denormalized single-table projection with JSON blobs for labels/deps; rejected because it hurts queryability and makes migration/index tuning brittle. Chosen approach keeps normalized relational tables + explicit migrations to maximize correctness and maintainable performance.","created_at":"2026-02-16T02:58:29Z"}]}
{"id":"bn-3bh","title":"Implement ratatui TUI (bn ui) ported from beads-tui","description":"# Context\n\nbn ui launches a ratatui-based terminal UI, ported from beads-tui (~/src/beads-tui/). The existing beads-tui uses ratatui 0.29, crossterm 0.28, tui-textarea, rusqlite, tokio, clap, chrono.\n\n# Goals\n\n- Port beads-tui UI patterns to Bones data model\n- List view with filtering (state, kind, label, urgency)\n- Detail view with item info, comments, dependency graph\n- Triage view showing bn next recommendations with scores\n- Goal progress view with tree of children\n- Search with live duplicate detection\n- Keyboard-driven workflow matching CLI verbs\n\n# Implementation Approach\n\nStudy existing beads-tui codebase at ~/src/beads-tui/ws/default/src/. Adapt data layer to read from Bones SQLite projection instead of beads DB. Reuse UI components (list, detail panels, keyboard handling) where possible. Add new views for goals, triage, search.\n\n## Files to Create/Modify\n\n- crates/bones-cli/src/tui/ — TUI module (or separate crate)\n- Port from ~/src/beads-tui/ws/default/src/\n\n## Acceptance Criteria\n\n- [ ] List view displays items with state/kind/urgency indicators\n- [ ] Filtering works for state, kind, label, urgency\n- [ ] Detail view shows full item info including comments and deps\n- [ ] Triage view shows bn next recommendations with scores\n- [ ] Goal progress view shows tree with completion percentages\n- [ ] Search works with live results\n- [ ] Keyboard shortcuts feel natural (vim-like navigation)\n- [ ] Ctrl+Z suspend works (from beads-tui)\n\n# How This Serves Overarching Goals\n\nThe TUI provides a rich interactive interface for humans while agents use --json. Both interfaces are first-class.","acceptance_criteria":"List view with filters; detail view; triage view with scores; goal progress tree; search with duplicate detection; keyboard-driven; ported from beads-tui patterns","status":"open","priority":3,"issue_type":"epic","created_at":"2026-02-16T02:26:02.249224977Z","created_by":"bones-dev","updated_at":"2026-02-16T04:48:42.422449888Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-5","tui","ux"],"dependencies":[{"issue_id":"bn-3bh","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:27:09.202411888Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3bh","depends_on_id":"bn-sep","type":"blocks","created_at":"2026-02-16T02:27:09.314627133Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":65,"issue_id":"bn-3bh","author":"bones-dev","text":"Decomposed into children: bn-38j (list view), bn-37f (detail/comments/deps), bn-rdc (triage/search).","created_at":"2026-02-16T04:48:42Z"}]}
{"id":"bn-3e2","title":"Graceful degradation for optional subsystems","description":"# Context\n\nOptional capabilities should improve results, not create hard failures. This bead ensures the CLI remains useful when semantic, triage, or cache subsystems are unavailable.\n\n# Scope\n\n- Capability detection at runtime with clear feature-state reporting\n- Lexical fallback when semantic model/vector store is unavailable\n- Priority fallback when triage engine is unavailable\n- Safe behavior when optional caches are missing/corrupt\n\n# Acceptance Criteria\n\n- [ ] Core lifecycle commands remain fully usable when optional subsystems are disabled\n- [ ] Fallback behavior is deterministic and clearly communicated to users\n- [ ] Missing optional dependencies never trigger user-reachable panics\n- [ ] Degradation scenarios are test-covered in CI\n- [ ] Coverage path is explicit: unit (capability detection/fallback tests), e2e/workflow (bn-36d + bn-2ly.2), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"System works without FTS5 (fallback to basic LIKE queries)\nSystem works without semantic search model (skip vector layer)\nMissing or corrupt bones.db triggers auto-rebuild\nClear warnings when optional subsystems are unavailable\nFeature detection: report which subsystems are active\nUnit tests: simulate each missing subsystem, verify graceful behavior","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:41:56.055829098Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:01.363009102Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-2","reliability","ux"],"dependencies":[{"issue_id":"bn-3e2","depends_on_id":"bn-2c5","type":"blocks","created_at":"2026-02-16T03:23:47.276445375Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3e2","depends_on_id":"bn-2vb","type":"blocks","created_at":"2026-02-16T02:42:03.939885455Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3e2","depends_on_id":"bn-3hf","type":"blocks","created_at":"2026-02-16T03:23:47.387716094Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-3fg","title":"Implement structural similarity features (labels, deps, graph proximity)","description":"# Context\nThird search layer: catch structurally related items even when text differs.\n\n# Implementation\n- Jaccard similarity on labels (shared labels / total labels)\n- Jaccard similarity on dependencies (shared blocking neighbors)\n- Jaccard similarity on assignees (shared agents)\n- Parent proximity: items sharing a parent goal score higher\n- Graph neighborhood: items within N hops in dependency graph score higher\n- Normalize all features to [0,1] range\n- Return per-feature scores for explainability","acceptance_criteria":"Jaccard similarity computed for labels, deps, assignees, parent\nGraph neighborhood proximity score (items within N hops)\nAll features normalized to [0,1]\nPer-feature scores returned for explainability\nUnit tests: known similarity pairs, edge cases (no labels, no deps)","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:55:04.697675368Z","created_by":"bones-dev","updated_at":"2026-02-16T04:56:02.803842542Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["dedup","phase-3","search"],"dependencies":[{"issue_id":"bn-3fg","depends_on_id":"bn-30j","type":"blocks","created_at":"2026-02-16T04:56:02.681989518Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3fg","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T04:56:02.803801425Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":84,"issue_id":"bn-3fg","author":"bones-dev","text":"Implementation must ship unit tests alongside the code.","created_at":"2026-02-16T04:56:02Z"}]}
{"id":"bn-3fs","title":"[track] Error handling, recovery, and graceful degradation","description":"# Context\n\nAgents and users operate this tool unattended; resilience quality directly impacts trust. This track coordinates error UX, recovery behavior, and fault validation.\n\n# Track Outcomes\n\n- User-facing errors are actionable and machine-parseable\n- Recovery procedures handle corruption/missing-state scenarios safely\n- Fault-injection validation proves recovery guarantees under crashes\n\n# Exit Criteria\n\n- [ ] Child beads bn-3fs.1, bn-3fs.2, bn-zr8 are completed\n- [ ] No user-reachable path panics without remediation guidance\n- [ ] Coverage path is explicit: unit (error/recovery tests), e2e/workflow (bn-zr8 + bn-36d fault paths), diagnostics/log artifacts (bn-1js + bn-m80)\n\n# Notes\n\nThis is a planning track; implementation happens in child beads.","acceptance_criteria":"Error handling strategy documented and consistently applied\nAll failure modes produce actionable error messages (not raw panics)\nRecovery procedures exist for corrupt shards, partial writes, missing DB\nGraceful degradation for optional subsystems (FTS5, semantic search)\nUnit tests verify error messages for each failure category","status":"open","priority":1,"issue_type":"track","created_at":"2026-02-16T02:37:47.292654979Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:43.844287544Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-1","resilience","track"],"dependencies":[{"issue_id":"bn-3fs","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:37:47.686033348Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-3fs.1","title":"Design and implement clear, actionable error messages for all failure modes","description":"# Context\n\nEvery error a user or agent encounters must explain what went wrong AND what to do about it. Cryptic errors waste agent tokens and human patience.\n\n# Scope\n\n- Catalog all known error conditions across CLI commands\n- Each error gets: short message, cause explanation, suggested fix\n- For agents (--json): structured error with error_code, message, suggestion fields\n- For humans: colored, concise, with command to fix\n\n## Error categories\n\n- Invalid input: bad item ID format, unknown kind/state/urgency, invalid event type\n- State violations: transition to invalid state, do on already-doing, done on archived\n- Missing data: item not found, shard not found, DB missing\n- Corruption: malformed event line, manifest mismatch, invalid hash\n- Configuration: missing config, invalid config values\n- System: disk full, permission denied, file locked\n\n# Acceptance Criteria\n\n- [ ] Error catalog covers 30+ distinct error conditions\n- [ ] Every error has a clear suggestion\n- [ ] --json errors include error_code for programmatic handling\n- [ ] No bare unwrap() or panic!() on user-reachable code paths","acceptance_criteria":"Error type hierarchy defined (EventError, ProjectionError, CliError, etc.)\nEach error variant produces a human-readable message with context\nError messages include actionable remediation steps where applicable\nNo raw unwrap/expect in library code (Result/Option handled explicitly)\nUnit tests: trigger each error variant, verify message quality","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-16T02:37:47.464643420Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:43.980570738Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-1","resilience","ux"],"dependencies":[{"issue_id":"bn-3fs.1","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:37:47.774544660Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3fs.1","depends_on_id":"bn-3fs","type":"parent-child","created_at":"2026-02-16T02:37:47.464643420Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-3fs.2","title":"Implement recovery procedures for corrupt shards, partial writes, missing DB","description":"# Context\n\nUsers and agents need predictable recovery behavior when storage is incomplete, missing, or corrupt. This bead defines and implements the runtime recovery procedures and user-facing remediation flow.\n\n# Scope\n\n- Partial-write recovery on startup (truncate/repair incomplete tail records)\n- Corrupt shard handling with clear user guidance and safe fallback behavior\n- Missing SQLite projection auto-rebuild from canonical event log\n- Missing project directory error path (`not a bones project`)\n- Locked DB retry/timeout behavior with actionable diagnostics\n- Corrupt binary cache rebuild policy\n\n# Acceptance Criteria\n\n- [ ] Recovery behaviors are deterministic and documented per failure mode\n- [ ] Corrupt/missing-state scenarios are handled without panic or silent data loss\n- [ ] User-facing remediation messages are specific and actionable\n- [ ] Coverage path is explicit: unit (recovery policy tests), e2e/workflow (bn-zr8 fault-injection validation), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"Corrupt shard detection and skip-with-warning behavior\nPartial write recovery: detect incomplete last line, truncate cleanly\nMissing DB: auto-trigger rebuild from event log with user notification\nWrite failure: retry with backoff, clear error if disk full or permissions\nUnit tests: inject each corruption type, verify recovery behavior","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:37:47.577750419Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:44.105455141Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-1","recovery","resilience"],"dependencies":[{"issue_id":"bn-3fs.2","depends_on_id":"bn-298","type":"blocks","created_at":"2026-02-16T02:37:47.884450290Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3fs.2","depends_on_id":"bn-3fs","type":"parent-child","created_at":"2026-02-16T02:37:47.577750419Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-3ga","title":"Implement bn dedup command for bulk duplicate detection","description":"bn dedup scans all open items pairwise (optimized: only pairs above FTS5 BM25 threshold) to find likely duplicates. Reports groups of potential duplicates with scores. Agent-friendly: --json output for automated dedup pipelines.","acceptance_criteria":"bn dedup scans all open items for duplicates\nGroups likely duplicates together\nReports composite scores per pair\nSupports --threshold flag to adjust sensitivity\nSupports --json output\nPerformance: completes in <30s for Tier S corpus\nUnit tests for grouping and threshold behavior","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T04:57:09.867186834Z","created_by":"bones-dev","updated_at":"2026-02-16T04:57:40.189671317Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","dedup","phase-3"],"dependencies":[{"issue_id":"bn-3ga","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T04:57:33.434272069Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3ga","depends_on_id":"bn-ihh","type":"blocks","created_at":"2026-02-16T04:57:32.744640114Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":89,"issue_id":"bn-3ga","author":"bones-dev","text":"Implementation must ship unit tests alongside the code.","created_at":"2026-02-16T04:57:40Z"}]}
{"id":"bn-3h6","title":"Implement binary columnar event cache format","description":"# Context\n\nThe gitignored .bones/cache/events.bin uses an Automerge-inspired columnar format for fast event replay. It is a performance optimization — rebuilt from .events files on demand.\n\n# Goals\n\n- Columnar encoding: delta-encoded timestamps, RLE actor indices, dictionary-encoded item IDs\n- Read/write .bones/cache/events.bin\n- Transparent cache invalidation (rebuild when events change)\n- Significant speedup for replay vs TSJSON parsing\n\n# Implementation Approach\n\nColumnar layout: magic bytes, version, actor table, event count, then columns for timestamps (delta varint), actor indices (RLE u16), event types (RLE enum), item IDs (dictionary), field names (dictionary), values (type-specific), parent hashes (raw bytes). Include Merkle root hash and item_id -> event range index.\n\n## Files to Create/Modify\n\n- crates/bones-core/src/cache/binary.rs — Binary format read/write\n- crates/bones-core/src/cache/mod.rs — Cache management and invalidation\n\n## Acceptance Criteria\n\n- [ ] Binary cache produced from TSJSON events\n- [ ] Replay from binary matches replay from TSJSON exactly\n- [ ] Cache invalidated when event log changes\n- [ ] Significant throughput improvement (measure per event class)\n- [ ] Compression measured and reported by event class\n- [ ] Cache is fully disposable\n\n# How This Serves Overarching Goals\n\nPerformance optimization for the replay hot path. Makes bn next and bn rebuild faster for large projects without changing the source-of-truth format.","acceptance_criteria":"Delta-encoded timestamps; interned agent IDs; RLE event types; dictionary item IDs; compression reported per event class p50/p95/p99; rebuild from .events verified","status":"open","priority":3,"issue_type":"epic","created_at":"2026-02-16T02:25:20.898040137Z","created_by":"bones-dev","updated_at":"2026-02-16T04:58:32.297175790Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["performance","phase-4","storage"],"dependencies":[{"issue_id":"bn-3h6","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:27:07.858508926Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":91,"issue_id":"bn-3h6","author":"bones-dev","text":"Decomposed into 3 children: bn-3h6.1 (format design), bn-3h6.2 (writer), bn-3h6.3 (reader). Children are chained: .1 -> .2 -> .3. Child .1 depends on bn-x2e (TSJSON format).","created_at":"2026-02-16T04:58:32Z"}]}
{"id":"bn-3h6.1","title":"Design binary columnar format and encoding schemes","description":"Design the column encodings per the plan: delta-encoded varint timestamps, interned agent ID table with RLE references, 4-bit RLE event types, dictionary-encoded item IDs, type-specific value encoding (FSST strings, varint ints, packed booleans). Document the format spec. Create the codec traits/interfaces.\n\n## Acceptance Criteria\n- Column encoding schemes defined for each field type\n- Format documented with byte-level layout\n- Codec trait with encode/decode methods per column type\n- Compression measured per event class (structural vs payload-heavy)\n- Unit tests: encode/decode roundtrip for each column type","acceptance_criteria":"Column encoding schemes defined for each field type (timestamps, agents, types, IDs, values)\nFormat documented with byte-level layout\nCodec trait with encode/decode methods per column type\nCompression measured per event class (structural vs payload-heavy)\nUnit tests: encode/decode roundtrip for each column type","status":"open","priority":2,"issue_type":"task","owner":"bob","created_at":"2026-02-16T04:58:07.235863874Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:25.861674180Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cache","phase-4"],"dependencies":[{"issue_id":"bn-3h6.1","depends_on_id":"bn-3h6","type":"parent-child","created_at":"2026-02-16T04:58:07.235863874Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3h6.1","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T04:58:27.688592650Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":92,"issue_id":"bn-3h6.1","author":"bones-dev","text":"Test plan: Unit tests for encode/decode roundtrip of each column type (timestamps, agent IDs, event types, item IDs, values). Fuzz with random event data. Verify byte-level layout matches spec. Test edge cases: empty columns, single-element columns, max-size columns.","created_at":"2026-02-16T04:58:36Z"}]}
{"id":"bn-3h6.2","title":"Implement binary cache writer (TSJSON events to columnar binary)","description":"Writer that reads TSJSON event files and produces the binary columnar cache file (.bones/cache/events.bin). Batch conversion for full rebuilds. Incremental append for new events.\n\n## Acceptance Criteria\n- Full conversion: all .events files to events.bin\n- Incremental: append new events since last cache build\n- Output file is gitignored (.bones/cache/)\n- Compression ratios reported by percentile (p50/p95/p99) per event class\n- Unit tests: full conversion, incremental append, verify compression ratios","acceptance_criteria":"Full conversion: all .events files to events.bin\nIncremental: append new events since last cache build\nOutput file is gitignored (.bones/cache/)\nCompression ratios reported by percentile (p50/p95/p99) per event class\nUnit tests: full conversion, incremental append, verify compression ratios","status":"open","priority":2,"issue_type":"task","owner":"bob","created_at":"2026-02-16T04:58:14.955238843Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:25.985839555Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cache","phase-4"],"dependencies":[{"issue_id":"bn-3h6.2","depends_on_id":"bn-3h6","type":"parent-child","created_at":"2026-02-16T04:58:14.955238843Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3h6.2","depends_on_id":"bn-3h6.1","type":"blocks","created_at":"2026-02-16T04:58:28.386544610Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":93,"issue_id":"bn-3h6.2","author":"bones-dev","text":"Test plan: Full conversion test with known TSJSON corpus. Incremental append test: add events, verify only new events appended. Verify .bones/cache/ is gitignored. Measure compression ratios by event class (structural vs payload-heavy). Regression test: writer output is deterministic for same input.","created_at":"2026-02-16T04:58:38Z"}]}
{"id":"bn-3h6.3","title":"Implement binary cache reader and cache management","description":"Reader that loads events.bin for fast replay instead of parsing TSJSON. Cache invalidation: detect stale cache (content hash mismatch). Cache rebuild trigger. Integration with replay pipeline (prefer cache, fall back to TSJSON).\n\n## Acceptance Criteria\n- Reader loads events from binary cache matching TSJSON parse output exactly\n- Cache invalidation detects when events.bin is stale\n- Automatic fallback to TSJSON when cache missing or stale\n- bn rebuild also rebuilds cache\n- Performance: binary cache replay at least 3x faster than TSJSON parsing on Tier M\n- Unit tests: read correctness, invalidation, fallback","acceptance_criteria":"Reader loads events from binary cache matching TSJSON parse output exactly\nCache invalidation detects when events.bin is stale (content hash mismatch)\nAutomatic fallback to TSJSON when cache missing or stale\nbn rebuild also rebuilds cache\nPerformance: binary cache replay at least 3x faster than TSJSON on Tier M\nUnit tests: read correctness, invalidation, fallback","status":"open","priority":2,"issue_type":"task","owner":"bob","created_at":"2026-02-16T04:58:22.670596502Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:26.119359292Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cache","phase-4"],"dependencies":[{"issue_id":"bn-3h6.3","depends_on_id":"bn-3h6","type":"parent-child","created_at":"2026-02-16T04:58:22.670596502Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3h6.3","depends_on_id":"bn-3h6.2","type":"blocks","created_at":"2026-02-16T04:58:29.085091736Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":94,"issue_id":"bn-3h6.3","author":"bones-dev","text":"Test plan: Read correctness test: binary cache output matches TSJSON parse output exactly for all event types. Invalidation test: modify events file, verify cache detected as stale. Fallback test: delete cache, verify TSJSON parsing is used. Performance test: binary cache replay vs TSJSON parsing benchmark on Tier M corpus. Integration test: bn rebuild triggers cache rebuild.","created_at":"2026-02-16T04:58:40Z"}]}
{"id":"bn-3hf","title":"Implement triage CLI commands (next, triage, plan, health, cycles)","description":"# Context\n\nThese commands expose triage intelligence in a user-facing form. `bn next` is the primary value path, while triage/plan/health commands provide transparency and control.\n\n# Goals\n\n- `bn next`: single recommended unblocked item with rationale\n- `bn next --agent N`: multi-agent assignment surface (backend regime selected by scheduler)\n- `bn triage`: project triage report (top picks, blockers, quick wins, cycles)\n- `bn plan` and `bn plan <goal-id>`: parallelizable execution plans\n- `bn health`/`bn cycles`: topology and risk diagnostics\n- `bn did` / `bn skip`: feedback command surfaces wired to bn-sep backend\n- All commands support stable `--json` output\n\n# Acceptance Criteria\n\n- [ ] `bn next` returns highest-priority unblocked candidate with explanation\n- [ ] `bn triage`/`bn health` outputs remain deterministic for unchanged graph input\n- [ ] `bn did`/`bn skip` persist feedback events via bn-sep backend APIs\n- [ ] Command outputs are usable in both human and automation workflows\n- [ ] Coverage path is explicit: unit (command formatting/parsing tests), e2e/workflow (bn-if2), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"bn next recommends highest-priority ready item; bn triage shows full report; bn plan shows parallel execution plan; bn health shows dashboard; bn cycles lists cycles; --json for all","status":"open","priority":2,"issue_type":"epic","created_at":"2026-02-16T02:24:29.653755435Z","created_by":"bones-dev","updated_at":"2026-02-16T04:47:54.046307053Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-2","triage"],"dependencies":[{"issue_id":"bn-3hf","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:27:07.308685795Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3hf","depends_on_id":"bn-sep","type":"blocks","created_at":"2026-02-16T02:27:07.196934238Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":63,"issue_id":"bn-3hf","author":"bones-dev","text":"Decomposed into children: bn-2qf (bn next/bn triage), bn-34z (bn plan/health/cycles), bn-2oz (bn did/bn skip).","created_at":"2026-02-16T04:47:54Z"}]}
{"id":"bn-3i7","title":"E2E dependency and graph workflows (dep add/rm/list/tree)","description":"# Context\n\nDependency commands are high-risk for user trust because incorrect blocker state causes wrong prioritization and planning. This bead provides workflow-level validation for dependency operations.\n\n# Scope\n\n- End-to-end tests for `bn dep add`, `bn dep rm`, `bn dep list`, `bn dep tree`\n- Alias compatibility tests for `bn link`/`bn unlink --blocks`\n- Cross-goal dependency scenarios and cycle-reporting behavior\n- JSON/text output checks for dependency visualization commands\n\n# Acceptance Criteria\n\n- [ ] Happy-path dependency workflows pass across multi-item graphs\n- [ ] Cycle scenarios are detected and surfaced with actionable output\n- [ ] Alias and canonical commands produce equivalent graph outcomes\n- [ ] `--json` outputs are parseable and stable for automation\n- [ ] Failed runs retain diagnostics artifacts (logs + replay traces)\n\n# Coverage Path\n\n- Unit verification: bn-2ce + bn-1nr graph unit tests\n- E2E/workflow verification: this bead\n- Diagnostic logging/artifacts: bn-1js, bn-m80\n","acceptance_criteria":"E2E test: bn dep add/rm creates and removes dependencies\nE2E test: bn dep list shows all dependencies for an item\nE2E test: bn dep tree shows recursive dependency tree\nE2E test: cycle prevention rejects circular dependency\nAll tests via CLI subprocess with JSON output verification","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T03:08:21.055130880Z","created_by":"1","updated_at":"2026-02-16T04:45:38.985992997Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["e2e","graph","phase-2","quality-gate","testing"],"dependencies":[{"issue_id":"bn-3i7","depends_on_id":"bn-1js","type":"blocks","created_at":"2026-02-16T03:08:26.397822934Z","created_by":"1","metadata":"{}","thread_id":""},{"issue_id":"bn-3i7","depends_on_id":"bn-1nr","type":"blocks","created_at":"2026-02-16T03:08:26.172572975Z","created_by":"1","metadata":"{}","thread_id":""},{"issue_id":"bn-3i7","depends_on_id":"bn-2ce","type":"blocks","created_at":"2026-02-16T03:08:26.059910049Z","created_by":"1","metadata":"{}","thread_id":""},{"issue_id":"bn-3i7","depends_on_id":"bn-m80","type":"blocks","created_at":"2026-02-16T03:08:26.515889178Z","created_by":"1","metadata":"{}","thread_id":""}]}
{"id":"bn-3ju","title":"Import/export interoperability commands","description":"# Context\n\nInterop commands let users migrate existing trackers and exchange data with external tooling. This bead defines safe, replay-correct import/export behavior.\n\n# Scope\n\n- `bn export` to JSON/CSV/TSJSON formats\n- `bn import` from JSON and initial external sources (e.g., GitHub issues)\n- Deterministic event generation from imported records\n- Extensible importer interface for future connectors\n\n# Acceptance Criteria\n\n- [ ] Export outputs are complete, deterministic, and schema-documented\n- [ ] Import generates valid canonical events with preserved provenance metadata\n- [ ] Malformed/partial inputs fail safely with actionable diagnostics\n- [ ] Re-import idempotency behavior is defined and test-covered\n- [ ] Coverage path is explicit: unit (parser/transform tests), e2e/workflow (bn-3ls), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"bn export --jsonl produces standard JSONL from event log\nbn import --jsonl reads JSONL and appends as events\nExport/import round-trip preserves all event data\nImport validates event format before appending\nInterop with external tools (jq, grep) documented\nUnit tests: export/import round-trip, malformed input rejection","status":"open","priority":3,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:43:16.628631318Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:28.289591444Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","interop","phase-3"],"dependencies":[{"issue_id":"bn-3ju","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:43:33.447008720Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3ju","depends_on_id":"bn-3m6","type":"blocks","created_at":"2026-02-16T02:43:33.336722298Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3ju","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:43:33.225423405Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-3kq","title":"Run comprehensive semilattice property test campaign across all CRDT types","description":"Using the harness from bn-hws, run exhaustive property tests (quickcheck/proptest) across all field CRDT types. Test: LWW Register merge, OR-Set merge, G-Set merge, epoch+phase state merge, WorkItem aggregate merge. Each must satisfy commutativity, associativity, idempotence. Run with thousands of random inputs per type.\n\n## Acceptance Criteria\n- Property tests for each CRDT type: LWW, OR-Set, G-Set, epoch+phase, WorkItem\n- Each test checks commutativity, associativity, idempotence\n- 10000+ random inputs per test (configurable)\n- Tests run deterministically with seed\n- All tests pass in CI within 60 seconds\n- Failure output shows minimal counterexample","acceptance_criteria":"Property tests for each CRDT type: LWW, OR-Set, G-Set, epoch+phase, WorkItem\nEach test checks commutativity, associativity, idempotence\n10000+ random inputs per test (configurable)\nTests run deterministically with seed\nAll tests pass in CI within 60 seconds\nFailure output shows minimal counterexample","status":"open","priority":2,"issue_type":"task","owner":"bob","created_at":"2026-02-16T04:59:42.970526078Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:26.647266437Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-4","testing"],"dependencies":[{"issue_id":"bn-3kq","depends_on_id":"bn-2y3","type":"blocks","created_at":"2026-02-16T04:59:47.126249920Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3kq","depends_on_id":"bn-hws","type":"blocks","created_at":"2026-02-16T04:59:46.386249141Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":99,"issue_id":"bn-3kq","author":"bones-dev","text":"Test plan: For each CRDT type (LWW, OR-Set, G-Set, epoch+phase, WorkItem aggregate), run proptest with 10000+ random inputs checking: (1) merge(a, b) == merge(b, a) [commutativity], (2) merge(merge(a, b), c) == merge(a, merge(b, c)) [associativity], (3) merge(a, a) == a [idempotence]. Use proptest shrinking to find minimal counterexamples. Verify deterministic replay with fixed seed. Measure CI runtime stays under 60 seconds.","created_at":"2026-02-16T04:59:50Z"}]}
{"id":"bn-3lp","title":"Goal auto-close/reopen behavior and containment policies","description":"# Context\n\nGoals are containers, not dependency roots. Users need predictable auto-close and reopen behavior so goal status reflects child reality without manual bookkeeping.\n\n# Scope\n\n- Auto-close rule evaluation when all active children are done/archived\n- Reopen rule evaluation when a closed goal gains an open/doing child\n- Configurable policy defaults (project + per-goal overrides)\n- Circular containment prevention and deep-nesting safety checks\n- Goal progress summary data (`done/total`, blocked counts) for CLI display\n\n# Acceptance Criteria\n\n- [ ] Auto-close and reopen rules are deterministic under concurrent updates\n- [ ] Per-goal override and project default interactions are clearly defined\n- [ ] Circular containment is detected and rejected with actionable errors\n- [ ] Progress summary remains correct after reparenting and child state changes\n- [ ] Coverage path is explicit: unit (policy/state tests in this bead), e2e/workflow (bn-2yo goal-policy scenarios), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"Goal auto-close: last child done triggers goal close event\nGoal auto-reopen: new child added to closed goal triggers reopen\nConfigurable: goals.auto_complete true/false in config\nNested goals: completion cascades up through tree\nContainment policies documented (what happens on reparent of done children)\nUnit tests: auto-close, auto-reopen, nested cascade, config toggle","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:43:54.424112497Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:23.902153983Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["crdt","model","phase-2"],"dependencies":[{"issue_id":"bn-3lp","depends_on_id":"bn-1nr","type":"blocks","created_at":"2026-02-16T02:44:07.737683956Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3lp","depends_on_id":"bn-2y3","type":"blocks","created_at":"2026-02-16T02:44:07.851358228Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3lp","depends_on_id":"bn-3m6","type":"blocks","created_at":"2026-02-16T02:44:07.959123140Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-3ls","title":"E2E reporting and interop workflows (stats/export/import)","description":"# Context\n\nReporting and interoperability commands are valuable but not critical for first usable release. This bead validates those workflows once stats/import/export features land.\n\n# Scope\n\n- End-to-end tests for `bn stats`, `bn export`, and `bn import`\n- Round-trip export->import consistency checks on representative datasets\n- JSON/text output contract checks for reporting commands\n- Error-path validation for malformed import sources\n\n# Acceptance Criteria\n\n- [ ] Stats/reporting output is consistent with underlying projection state\n- [ ] Export/import round trips preserve expected item semantics\n- [ ] Invalid import payloads fail safely with actionable remediation text\n- [ ] `--json` outputs parse and match expected schemas\n- [ ] Failed runs preserve diagnostics artifacts (structured logs + traces)\n\n# Coverage Path\n\n- Unit verification: bn-29r, bn-3ju\n- E2E/workflow verification: this bead\n- Diagnostic logging/artifacts: bn-1js, bn-m80\n","acceptance_criteria":"E2E test: bn stats produces project statistics report\nE2E test: bn export --jsonl produces valid JSONL output\nE2E test: import from JSONL produces correct events and projection\nAll tests via CLI subprocess with JSON output verification","status":"open","priority":3,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T03:20:28.538275450Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:28.037450106Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["e2e","interop","phase-3","quality-gate","testing"],"dependencies":[{"issue_id":"bn-3ls","depends_on_id":"bn-1js","type":"blocks","created_at":"2026-02-16T03:20:33.189381025Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3ls","depends_on_id":"bn-29r","type":"blocks","created_at":"2026-02-16T03:20:32.960684766Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3ls","depends_on_id":"bn-3ju","type":"blocks","created_at":"2026-02-16T03:20:33.078221131Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3ls","depends_on_id":"bn-m80","type":"blocks","created_at":"2026-02-16T03:20:33.305569121Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-3m6","title":"Implement work item model (kinds, states, urgency, sizes)","description":"# Context\n\nThe work item model defines core domain types and invariants that every command/replay path depends on. This bead establishes the canonical type system and transition rules.\n\n# Goals\n\n- Define Kind, State, Urgency, Size enums with serialization\n- Implement state transition validation rules\n- Define WorkItem aggregate schema across all persisted fields\n- Provide deterministic parse/display behavior for CLI and JSON output\n\n# Notes on Scope\n\n- Goal auto-close/reopen runtime behavior is handled in bn-3lp\n- This bead provides the type-level foundations that bn-3lp uses\n\n# Acceptance Criteria\n\n- [ ] All enums serialize/deserialize correctly (JSON + display parsing)\n- [ ] Invalid state transitions are rejected with clear error types\n- [ ] WorkItem schema covers planned fields with stable defaults\n- [ ] Parsing/formatting is deterministic across repeated runs\n- [ ] Coverage path is explicit: unit (model and transition tests in this bead), e2e/workflow (bn-yot.4 + bn-2yo), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"Kind/State/Urgency/Size enums serialize correctly; invalid transitions rejected; WorkItem schema covers all fields; deterministic parse/display","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-16T02:22:29.606968956Z","created_by":"bones-dev","updated_at":"2026-02-16T04:25:35.528423393Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","model","phase-1"],"dependencies":[{"issue_id":"bn-3m6","depends_on_id":"bn-2h9","type":"blocks","created_at":"2026-02-16T04:25:35.528364072Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3m6","depends_on_id":"bn-2vb","type":"blocks","created_at":"2026-02-16T02:26:49.888348777Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":10,"issue_id":"bn-3m6","author":"bones-dev","text":"Item IDs generated via terseid crate (github.com/bobisme/terseid). Use IdGenerator::new(IdConfig::new(\"bn\")) with seed_fn based on title+nonce. Pass current item count and exists closure backed by SQLite. Child IDs via terseid::child_id for goal children. IdResolver for CLI input parsing (partial match, prefix normalization).","created_at":"2026-02-16T02:59:07Z"},{"id":17,"issue_id":"bn-3m6","author":"1","text":"Critical review pass: user value = a small, consistent domain model that keeps CLI behavior predictable for humans and agents. Failure modes = invalid state transitions, ambiguous goal auto-close semantics, and enum/value drift between parser and projection. Alternative considered: richer Jira-style taxonomy; rejected for complexity overhead and lower automation reliability. Chosen approach: constrained kinds/states/urgency/size with explicit transition validator. Coverage path: unit verification in-bead model tests, e2e/workflow bn-yot.4 + bn-yot.5, diagnostics/log artifacts bn-1js + bn-m80.","created_at":"2026-02-16T02:59:35Z"}]}
{"id":"bn-3oz","title":"CRDT merge decision trace diagnostics","description":"# Context\n\nWhen convergence surprises happen, users need transparent explanations of merge choices. This bead adds opt-in merge decision tracing.\n\n# Scope\n\n- Trace output for LWW tie-break sequence (ITC, wall_ts, actor_id, hash)\n- Trace output for OR-Set add/remove conflict outcomes\n- Runtime toggles (`BONES_DEBUG_MERGE`, CLI flag)\n- Structured trace format suitable for machine analysis\n\n# Acceptance Criteria\n\n- [ ] Trace output explains final winner/loser decisions unambiguously\n- [ ] Tracing can be enabled/disabled without changing merge outcomes\n- [ ] Trace logs include correlation IDs linking related decisions\n- [ ] Overhead in disabled mode is negligible and test-verified\n- [ ] Coverage path is explicit: unit (trace payload tests), e2e/workflow (bn-385 + bn-zr8 diagnostic runs), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"Diagnostic output for CRDT merge decisions: which rule won and why\nTrace format: field name, competing values, winner, tie-breaking step used\nAvailable via BONES_LOG=debug or bn show --merge-trace <id>\nUseful for debugging convergence issues in multi-agent scenarios\nUnit tests: trace output for each tie-breaking step (causal, timestamp, agent, hash)","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:41:13.581382364Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:24.149328428Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["crdt","observability","phase-2"],"dependencies":[{"issue_id":"bn-3oz","depends_on_id":"bn-1js","type":"blocks","created_at":"2026-02-16T02:41:32.120894228Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3oz","depends_on_id":"bn-2y3","type":"blocks","created_at":"2026-02-16T02:41:32.006817523Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3oz","depends_on_id":"bn-42v","type":"parent-child","created_at":"2026-02-16T03:09:31.343651597Z","created_by":"1","metadata":"{}","thread_id":""}]}
{"id":"bn-3p1","title":"Implement multi-repo event aggregation","description":"# Context & Background\n\nThe plan specifies multi-repo event aggregation as a Phase 5 capability. While individual repos each maintain their own .bones/ event logs, some workflows need a unified view across multiple repositories — for example, a team managing a microservices architecture where each service repo has its own Bones tracker, or an organization wanting a portfolio-level dashboard.\n\nbn-doc defines the merge/sync protocol for divergent histories. bn-3w3 implements Prolly Tree sync for non-git scenarios. This bead implements the aggregation layer that reads events from multiple repos and presents them as a unified, queryable projection.\n\n# Goals\n\n- Read events from multiple .bones/ directories across repos\n- Merge events into a unified projection using existing CRDT machinery\n- Support cross-repo dependency tracking (item in repo A blocks item in repo B)\n- Provide aggregated triage across repos (unified `bn next` across projects)\n- Maintain repo provenance for every item (which repo originated it)\n\n# Reasoning/Justification\n\nIndividual repo trackers are the common case and work out of the box. But as projects grow, cross-repo visibility becomes important. Without aggregation, agents working across repos must run `bn next` in each repo separately and manually compare priorities. Aggregation lets the triage engine consider the full dependency graph across repos.\n\nThis is Phase 5 because it requires stable core (Phase 1), triage (Phase 2), and sync (Phase 5 Prolly Tree) before cross-repo aggregation adds value.\n\n# Implementation Approach\n\n## Key Components\n\n1. **Multi-repo configuration**: `~/.config/bones/repos.toml` listing repo paths or remote URLs to aggregate. Per-repo aliases for display.\n\n2. **Namespaced item IDs**: Cross-repo items use `repo:bn-XXXX` format. Within a single repo, the prefix is optional. The aggregation layer adds the namespace.\n\n3. **Unified event replay**: Read events from all configured repos, merge via CRDT machinery (same Eg-Walker DAG replay). Each repo is treated as a separate agent/branch in the DAG.\n\n4. **Aggregated SQLite projection**: Separate from per-repo projections. Includes repo_id column on all tables. Supports cross-repo FTS5 search and cross-repo dependency queries.\n\n5. **Cross-repo dependencies**: `bn link repo-a:bn-x1y2 --blocks repo-b:bn-c3d4`. Stored in the originating repo's event log. The aggregation layer materializes the cross-repo graph.\n\n6. **CLI commands**: `bn aggregate` to build/refresh the aggregated projection. `bn next --aggregate` for cross-repo triage. `bn list --aggregate` for unified listing.\n\n## Files to Create/Modify\n\n- `crates/bones-core/src/aggregate/mod.rs` — Multi-repo aggregation engine\n- `crates/bones-core/src/aggregate/config.rs` — Repo registry configuration\n- `crates/bones-core/src/aggregate/namespace.rs` — Namespaced item IDs\n- `crates/bones-cli/src/cmd/aggregate.rs` — CLI commands\n\n## Edge Cases\n\n- Repo unavailable (offline, removed): skip with warning, use last-known state\n- ID collision across repos: namespacing prevents this\n- Cross-repo cycles: detected and reported same as within-repo cycles\n- Large number of repos (>50): lazy loading, parallel event reads\n\n# Acceptance Criteria\n\n- [ ] Events from multiple repos read and merged into unified projection\n- [ ] Cross-repo dependencies tracked and surfaced by triage\n- [ ] Aggregated triage considers full cross-repo dependency graph\n- [ ] Repo provenance preserved (every item shows origin repo)\n- [ ] Namespaced IDs unambiguous across repos\n- [ ] Graceful degradation when a repo is unavailable\n- [ ] `bn list --aggregate` and `bn next --aggregate` produce correct results\n\n# How This Serves Project Goals\n\nThis extends \"agents first\" to multi-project agent swarms. An orchestrator agent managing work across multiple repos can use aggregated triage to make globally optimal work assignments rather than repo-local suboptimal ones.","acceptance_criteria":"Aggregate events from multiple .bones/ directories (separate repos/projects)\nUnified view: bn list --repos shows items across all configured repos\nEvents remain in their source repos (read-only aggregation, no copying)\nConfig: repos list in ~/.config/bones/config.toml\nHandle unavailable repos gracefully (skip with warning)\nUnit tests: multi-repo aggregation, missing repo handling","status":"open","priority":4,"issue_type":"epic","owner":"bones-dev","created_at":"2026-02-16T03:44:01.888686225Z","created_by":"bones-dev","updated_at":"2026-02-16T05:01:22.457833501Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["distribution","multi-repo","phase-5"],"dependencies":[{"issue_id":"bn-3p1","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T03:44:06.472727503Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3p1","depends_on_id":"bn-doc","type":"blocks","created_at":"2026-02-16T03:44:06.359625356Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":106,"issue_id":"bn-3p1","author":"bones-dev","text":"Decomposed into children: bn-3p1.1 (multi-repo configuration and discovery) and bn-3p1.2 (unified multi-repo aggregation view). bn-3p1 is the parent epic - close when children complete.","created_at":"2026-02-16T05:01:22Z"}]}
{"id":"bn-3p1.1","title":"Implement multi-repo configuration and discovery","description":"Configuration for tracking multiple Bones repositories. Config in ~/.config/bones/config.toml with repos list (paths or git URLs). Discovery: scan configured repos, validate each has .bones/ directory, report unavailable repos with warnings. Repo identity: each repo has a unique project name derived from its path or config.\n\n## Acceptance Criteria\n- Config schema: repos list in user config file\n- Discovery scans configured paths and validates .bones/ presence\n- Unavailable repos produce warning, not error\n- Each repo identified by project name\n- Unit tests: config parsing, discovery with valid/invalid/missing repos","acceptance_criteria":"Config schema: repos list in user config file (~/.config/bones/config.toml)\nDiscovery scans configured paths and validates .bones/ presence\nUnavailable repos produce warning, not error\nEach repo identified by project name\nUnit tests: config parsing, discovery with valid/invalid/missing repos","status":"open","priority":4,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T05:01:00.870522500Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:46.939850161Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["multi-repo","phase-5"],"dependencies":[{"issue_id":"bn-3p1.1","depends_on_id":"bn-3p1","type":"parent-child","created_at":"2026-02-16T05:01:00.870522500Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3p1.1","depends_on_id":"bn-3sy","type":"blocks","created_at":"2026-02-16T05:01:04.470048556Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3p1.1","depends_on_id":"bn-8hi","type":"blocks","created_at":"2026-02-16T05:01:04.584034074Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":107,"issue_id":"bn-3p1.1","author":"bones-dev","text":"Test coverage: unit tests for config parsing (valid/malformed repos list), discovery scanning with valid repos, invalid paths, missing .bones/ directories, project name derivation from path and config.","created_at":"2026-02-16T05:01:26Z"}]}
{"id":"bn-3p1.2","title":"Implement unified multi-repo aggregation view","description":"Aggregate items from multiple repos into a unified view. bn list --repos shows items across all configured repos with repo prefix on IDs. bn next --repos considers items from all repos for triage. Read-only aggregation: events stay in source repos, no copying. Merged projection in memory only.\n\n## Acceptance Criteria\n- bn list --repos shows items from all configured repos\n- Items prefixed with repo name for disambiguation\n- bn next --repos ranks across all repos\n- Read-only: no events copied or modified in source repos\n- Missing repos skipped with warning\n- Unit tests: multi-repo listing, cross-repo ranking, missing repo handling","acceptance_criteria":"bn list --repos shows items from all configured repos\nItems prefixed with repo name for disambiguation\nbn next --repos ranks across all repos\nRead-only: no events copied or modified in source repos\nMissing repos skipped with warning\nUnit tests: multi-repo listing, cross-repo ranking, missing repo handling","status":"open","priority":4,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T05:01:12.340195828Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:47.067519215Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["multi-repo","phase-5"],"dependencies":[{"issue_id":"bn-3p1.2","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T05:01:15.935970292Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3p1.2","depends_on_id":"bn-3p1","type":"parent-child","created_at":"2026-02-16T05:01:12.340195828Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3p1.2","depends_on_id":"bn-3p1.1","type":"blocks","created_at":"2026-02-16T05:01:15.796403150Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":108,"issue_id":"bn-3p1.2","author":"bones-dev","text":"Test coverage: unit tests for multi-repo listing with repo prefixes, cross-repo ranking in bn next --repos, read-only verification (no source repo mutation), missing repo graceful skip with warning.","created_at":"2026-02-16T05:01:30Z"}]}
{"id":"bn-3rr","title":"[track] Documentation: ADRs, contributor guide, CLI help quality","description":"# Context\n\nDocumentation is a product surface for both humans and agents. This track coordinates ADR quality, CLI help quality, and contributor onboarding so implementation can scale safely.\n\n# Track Outcomes\n\n- Architecture decisions are documented and cross-linked\n- CLI help is consistent, example-rich, and automation-friendly\n- Contributors can set up, build, test, and extend the project confidently\n\n# Exit Criteria\n\n- [ ] Child beads bn-3rr.1, bn-3rr.2, bn-3rr.3 are completed\n- [ ] Key docs are discoverable from top-level project docs\n- [ ] Coverage path is explicit: unit (N/A docs artifacts), e2e/workflow (onboarding validation via bn-1cr), diagnostics/log artifacts (decision rationale preserved in docs/ADRs)\n\n# Notes\n\nThis is a planning track; implementation happens in child beads.","acceptance_criteria":"All 3 children (3rr.1-3rr.3) complete\nADRs for key design decisions written and in repo\nCLI help text polished with examples\nAGENTS.md contributor guide written\nDocumentation reviewed for completeness and accuracy","status":"open","priority":2,"issue_type":"track","created_at":"2026-02-16T02:38:11.237019107Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:03.454959454Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cross-cutting","documentation","phase-2","track"]}
{"id":"bn-3rr.1","title":"Write architecture decision records (ADRs) for key design choices","description":"# Context\n\nArchitecture docs must be implementation-usable, not aspirational. This bead produces the ADR set that turns major design choices into stable engineering contracts.\n\n# Scope\n\n- Author ADRs for major decisions **not already covered by dedicated ADR beads**\n- Consolidate and index dedicated ADR outputs (including bn-1t8 and bn-379)\n- Ensure every ADR includes: context, decision, alternatives considered, consequences, and rollback/migration notes\n\n# ADR Set\n\n1. TSJSON vs JSONL event format\n2. Eg-Walker DAG replay vs classical per-element CRDT metadata\n3. ITC vs vector clocks\n4. Simplified item kinds/states/urgency model\n5. Epoch+phase state semantics\n6. Computed triage score vs assigned priority\n7. sqlite-vec integration strategy\n8. ADR index linking dedicated shard/ID ADRs\n\n# Acceptance Criteria\n\n- [ ] ADRs are complete, cross-linked, and implementation-ready\n- [ ] At least one realistic alternative is documented per ADR\n- [ ] Dedicated ADR beads (bn-1t8, bn-379) are integrated into ADR index\n- [ ] Coverage path is explicit: unit (N/A doc artifact), e2e/workflow (CLI/docs usage validation in bn-3rr.2/.3), diagnostics/log artifacts (decision rationale preserved in ADR docs)\n","acceptance_criteria":"ADRs written for: TSJSON format, ITC choice, Eg-Walker DAG, LWW tie-breaking, sharding strategy\nEach ADR follows consistent template (context, decision, consequences)\nADRs are self-contained (reader needs no external docs)\nADRs stored in docs/adr/ directory in repo\nADRs cross-reference each other where relevant","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:38:11.402012290Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:03.579838238Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["architecture","cross-cutting","documentation","phase-2"],"dependencies":[{"issue_id":"bn-3rr.1","depends_on_id":"bn-1t8","type":"blocks","created_at":"2026-02-16T03:16:43.567036379Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3rr.1","depends_on_id":"bn-2jr","type":"blocks","created_at":"2026-02-16T02:38:11.836342043Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3rr.1","depends_on_id":"bn-379","type":"blocks","created_at":"2026-02-16T03:16:43.675244742Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3rr.1","depends_on_id":"bn-3rr","type":"parent-child","created_at":"2026-02-16T02:38:11.402012290Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-3rr.2","title":"Polish CLI help text: examples, consistent style, agent-friendly descriptions","description":"# Scope\n\n- Every subcommand has a usage example in --help\n- Consistent voice and style across all commands\n- --help includes both human and agent (--json) examples\n- Global help (bn --help) shows command grouping with descriptions\n- Error messages reference --help where appropriate\n\n# Acceptance Criteria\n\n- [ ] Every command has at least one usage example in --help\n- [ ] bn --help shows organized command list with grouping\n- [ ] Help text reviewed for consistency","acceptance_criteria":"Every CLI command has --help with usage examples\nHelp text includes common workflows (not just flag descriptions)\nAgent-friendly descriptions (explain what JSON output contains)\nConsistent style across all commands\nTested: every command --help produces output without error","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:38:11.512167277Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:03.711148750Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","cross-cutting","documentation","phase-2","ux"],"dependencies":[{"issue_id":"bn-3rr.2","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:38:11.944125878Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3rr.2","depends_on_id":"bn-3rr","type":"parent-child","created_at":"2026-02-16T02:38:11.512167277Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-3rr.3","title":"Write AGENTS.md and contributor onboarding guide","description":"# Scope\n\n- AGENTS.md: project overview, crate layout, build instructions, test commands, conventions\n- Contributor guide: how to add new event types, how to add new CLI commands, how to add new metrics\n- Development setup: required tools, environment variables, test fixtures\n- Architecture overview diagram with crate boundaries\n\n# Acceptance Criteria\n\n- [ ] New contributor can build, test, and understand the project from docs alone\n- [ ] AGENTS.md follows the botbox convention","acceptance_criteria":"AGENTS.md covers: project purpose, architecture overview, development setup\nContributor guide: how to build, test, add a new command, add a new event type\nCode organization explained (module structure, where things live)\nCommon tasks documented with examples\nNew contributor can build and run tests within 15 minutes of reading","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T02:38:11.623044919Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:03.864552484Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cross-cutting","documentation","phase-2"],"dependencies":[{"issue_id":"bn-3rr.3","depends_on_id":"bn-2vb","type":"blocks","created_at":"2026-02-16T02:38:12.050771038Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3rr.3","depends_on_id":"bn-3rr","type":"parent-child","created_at":"2026-02-16T02:38:11.623044919Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-3sy","title":"Configuration system and defaults","description":"# Context\n\nPredictable configuration resolution is essential for automation and reproducible behavior across environments.\n\n# Scope\n\n- Repo config (`.bones/config.toml`) + user config (`~/.config/bones/config.toml`)\n- Environment overrides (`BONES_AGENT`, `BONES_FORMAT`, etc.)\n- Resolution precedence and conflict reporting\n- `bn config show/set/unset` command surfaces\n\n# Acceptance Criteria\n\n- [ ] Resolution precedence is deterministic and documented (`--agent` > env > repo/user config > defaults)\n- [ ] Invalid config values are rejected with actionable messages\n- [ ] Sensitive defaults avoid unsafe surprises for unattended agents\n- [ ] Config commands are idempotent and safe under concurrent reads\n- [ ] Coverage path is explicit: unit (resolver/parser tests), e2e/workflow (bn-1cr + bn-2yo), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"Config loaded from .bones/config.yaml (project) and ~/.config/bones/config.toml (user)\nProject config: goals.auto_complete, search settings, triage settings\nUser config: default agent, output preferences\nConfig merging: project overrides user defaults\nUnit tests: load config, merge configs, missing config file handled gracefully","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:41:41.456348994Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:01.726348223Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","config","phase-1"],"dependencies":[{"issue_id":"bn-3sy","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:42:03.165943914Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3sy","depends_on_id":"bn-2vb","type":"blocks","created_at":"2026-02-16T02:42:03.057039872Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":18,"issue_id":"bn-3sy","author":"bones-dev","text":"Actor resolution order: (1) --agent flag, (2) AGENT env var, (3) BONES_ACTOR env var, (4) actor in ~/.config/bones/config.toml. Mutating commands error if no actor is resolved. This matches the botbox convention where AGENT is set by the launcher.","created_at":"2026-02-16T03:12:33Z"},{"id":21,"issue_id":"bn-3sy","author":"bones-dev","text":"TERMINOLOGY UPDATE: 'actor' is now 'agent' everywhere in bones. Env var is BONES_AGENT (not BONES_ACTOR). Config key is 'agent' not 'actor'. Resolution order: --agent flag > AGENT env > BONES_AGENT env > config file 'agent' key.","created_at":"2026-02-16T03:14:17Z"}]}
{"id":"bn-3t9","title":"Extended item mutation commands (update/close/reopen)","description":"# Context\n\nAfter core lifecycle commands land, users need finer-grained mutation operations for maintenance and migration workflows without overloading the core command bead.\n\n# Scope\n\n- `bn update <id> --field=value` for mutable fields (title, description, kind, urgency, size, parent, labels where appropriate)\n- `bn close <id>` and `bn reopen <id>` convenience commands mapped to state semantics\n- Backward-compatible alias behavior with core lifecycle verbs (`done`, `do`)\n- Partial ID resolution and deterministic error behavior for ambiguous IDs\n\n# Out of Scope\n\n- Baseline `create`/`list`/`show` command ownership remains in bn-2da\n- Dependency graph commands remain in bn-2ce\n\n# Acceptance Criteria\n\n- [ ] Field patch updates emit correct events and survive replay deterministically\n- [ ] close/reopen semantics match epoch+phase rules and invalid transitions are rejected\n- [ ] Partial ID resolution is deterministic and ambiguity is reported clearly\n- [ ] Alias behavior is documented and tested for migration compatibility\n- [ ] Coverage path is explicit: unit (command/state-transition tests in this bead), e2e/workflow (bn-2yo), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"bn update <id> supports --title, --description, --size, --urgency, --kind flags\nbn close <id> transitions to done (alias for bn done with close semantics)\nbn reopen <id> increments epoch and sets phase=open\nAll mutations emit appropriate events with agent attribution\nUnit tests: update each field, close/reopen lifecycle","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:42:22.639136451Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:42.144380180Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-2"],"dependencies":[{"issue_id":"bn-3t9","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T03:13:14.865066370Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3t9","depends_on_id":"bn-2y3","type":"blocks","created_at":"2026-02-16T02:42:47.378008948Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3t9","depends_on_id":"bn-3m6","type":"blocks","created_at":"2026-02-16T02:42:47.263119288Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3t9","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:42:47.491501226Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3t9","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T02:42:47.625483475Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":13,"issue_id":"bn-3t9","author":"bones-dev","text":"Use terseid::IdGenerator for bn create (seed from title+nonce, collision check against SQLite). Use terseid::IdResolver for all commands accepting item IDs — enables partial matching (user types 'a7x', resolves to 'bn-a7x3q9').","created_at":"2026-02-16T02:59:11Z"},{"id":19,"issue_id":"bn-3t9","author":"bones-dev","text":"All mutating commands (create, update, close, reopen, comment, link, unlink, tag, untag, assign, move) require an actor. Resolved via: --agent flag > AGENT env > BONES_ACTOR env > config file. Error with clear message if none set.","created_at":"2026-02-16T03:12:35Z"}]}
{"id":"bn-3uy","title":"Dependency cycle prevention and graph validation","description":"# Context\n\nDependency cycles can invalidate scheduling semantics and confuse users. This bead enforces cycle safety at mutation time and validates graph integrity on load.\n\n# Scope\n\n- Reject edge additions that introduce dependency cycles\n- Handle self-deps, duplicate edges, and invalid archived-item dependencies\n- Incremental cycle checks with clear cycle-path diagnostics\n- Startup validation for existing graph integrity\n\n# Acceptance Criteria\n\n- [ ] Cycle-causing edges are rejected with explicit cycle-path output\n- [ ] Non-cycle valid edges are accepted without false positives\n- [ ] Graph integrity checks run safely on large dependency sets\n- [ ] Validation errors provide actionable remediation suggestions\n- [ ] Coverage path is explicit: unit (incremental cycle-check tests), e2e/workflow (bn-3i7), diagnostics/log artifacts (bn-m80 + bn-1js)\n","acceptance_criteria":"Cycle prevention on bn dep add: reject if would create cycle\nGraph validation: detect and report orphaned references, self-links\nbn cycles lists all strongly connected components with >1 node\nValidation runs on projection load and reports issues to stderr\nUnit tests: prevent cycle, detect orphans, detect self-links","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:41:01.240767814Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:24.025427116Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["graph","phase-2","security"],"dependencies":[{"issue_id":"bn-3uy","depends_on_id":"bn-2lv","type":"parent-child","created_at":"2026-02-16T03:09:21.618524308Z","created_by":"1","metadata":"{}","thread_id":""},{"issue_id":"bn-3uy","depends_on_id":"bn-30j","type":"blocks","created_at":"2026-02-16T02:41:28.031304241Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-3vq","title":"Implement Thompson Sampling feedback learning for triage weights","description":"# Context\nSecond component of bn-sep: adaptive weight learning from bn did/bn skip feedback events.\n\n# Implementation\n- Thompson Sampling contextual bandit for weight adaptation (alpha/beta/gamma/delta/epsilon)\n- Posterior distributions (Beta distributions) per weight, updated from feedback\n- Feedback events stored in .bones/feedback.jsonl (gitignored, local)\n- Per-agent weight profiles (each agent learns independently)\n- Weight convergence: stable after ~50 feedback events\n\n# How This Serves Project Goals\nMakes triage smarter over time - agents that use bn next get increasingly good recommendations.","acceptance_criteria":"Thompson Sampling with Beta distribution posteriors per weight\nFeedback events (did/skip) update corresponding weight posteriors\nPer-agent profiles: each agent has independent weight distributions\nFeedback stored in .bones/feedback.jsonl (gitignored)\nWeights converge: verify stability after 50+ feedback events on test scenario\nUnit tests: posterior updates, per-agent isolation, convergence check","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:47:09.364125368Z","created_by":"bones-dev","updated_at":"2026-02-16T04:50:22.239256857Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-2","triage"],"dependencies":[{"issue_id":"bn-3vq","depends_on_id":"bn-4us","type":"blocks","created_at":"2026-02-16T04:47:24.564268167Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":67,"issue_id":"bn-3vq","author":"bones-dev","text":"Implementation must ship unit tests alongside the code. Tests should be in the same PR/commit as the implementation.","created_at":"2026-02-16T04:50:22Z"}]}
{"id":"bn-3w3","title":"Implement Prolly Tree sync for non-git scenarios","description":"# Context\n\nFor multi-repo or non-git sync, organize events into a Prolly Tree keyed by (item_id, event_timestamp). Two replicas diff in O(log N) by comparing root hashes.\n\n# Goals\n\n- Prolly Tree construction from event log\n- O(log N) diff between two replicas via root hash comparison\n- Sync protocol: exchange minimal events to converge\n- Support sync over MCP, HTTP, or file exchange\n\n# Implementation Approach\n\nProbabilistic B-tree where split points are determined by content hashes. Build from events keyed by (item_id, ts). Diff by walking trees from roots, descending into differing subtrees. Exchange only events in differing leaves.\n\n## Files to Create/Modify\n\n- crates/bones-core/src/sync/prolly.rs — Prolly Tree implementation\n- crates/bones-core/src/sync/diff.rs — Tree diff algorithm\n- crates/bones-core/src/sync/protocol.rs — Sync protocol\n\n## Acceptance Criteria\n\n- [ ] Prolly Tree built from event log\n- [ ] Two identical logs produce identical tree structure\n- [ ] Diff correctly identifies missing events\n- [ ] Sync transfers only missing events\n- [ ] O(log N) hash comparisons for diff\n\n# How This Serves Overarching Goals\n\nEnables Bones to work beyond git — MCP sync, multi-repo aggregation, USB sneakernet. The coordination substrate becomes protocol-agnostic.","acceptance_criteria":"Prolly Tree keyed by (item_id, event_timestamp); O(log N) diff by root hash; sync over arbitrary transport; two replicas converge after sync","status":"open","priority":4,"issue_type":"epic","created_at":"2026-02-16T02:26:27.032103522Z","created_by":"bones-dev","updated_at":"2026-02-16T05:00:38.680850818Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["distribution","phase-5","sync"],"dependencies":[{"issue_id":"bn-3w3","depends_on_id":"bn-2o3","type":"blocks","created_at":"2026-02-16T02:27:09.431767668Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3w3","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:27:09.540996968Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":103,"issue_id":"bn-3w3","author":"bones-dev","text":"Decomposed into children: bn-3w3.1 (Prolly Tree data structure with content-defined chunking) and bn-3w3.2 (sync protocol for non-git scenarios). bn-3w3 is the parent epic - close when children complete.","created_at":"2026-02-16T05:00:38Z"}]}
{"id":"bn-3w3.1","title":"Implement Prolly Tree data structure keyed by (item_id, event_timestamp)","description":"Organize events into a content-defined chunked Prolly Tree. Key: (item_id, event_timestamp). Chunks defined by rolling hash boundary. Root hash summarizes entire event set. Enables O(log N) diff between two replicas by comparing root hashes and walking divergent subtrees.\n\n## Acceptance Criteria\n- Events organized into Prolly Tree with content-defined chunking\n- Root hash deterministic for same event set regardless of insertion order\n- Diff between two trees identifies divergent chunks in O(log N)\n- Tree serializable for storage/transmission\n- Unit tests: tree construction, root hash determinism, diff accuracy","acceptance_criteria":"Events organized into Prolly Tree with content-defined chunking\nRoot hash deterministic for same event set regardless of insertion order\nDiff between two trees identifies divergent chunks in O(log N)\nTree serializable for storage/transmission\nUnit tests: tree construction, root hash determinism, diff accuracy","status":"open","priority":4,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T05:00:16.235938630Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:46.674672272Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-5","sync"],"dependencies":[{"issue_id":"bn-3w3.1","depends_on_id":"bn-2o3","type":"blocks","created_at":"2026-02-16T05:00:19.390320078Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3w3.1","depends_on_id":"bn-3w3","type":"parent-child","created_at":"2026-02-16T05:00:16.235938630Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":104,"issue_id":"bn-3w3.1","author":"bones-dev","text":"Test coverage: unit tests for Prolly Tree construction from event sets, root hash determinism (same events in different order produce same root), diff accuracy between two trees with known divergence, serialization round-trip.","created_at":"2026-02-16T05:00:42Z"}]}
{"id":"bn-3w3.2","title":"Implement Prolly Tree sync protocol for non-git scenarios","description":"Sync protocol using Prolly Tree diff to efficiently synchronize events between replicas over MCP, HTTP, or USB drives. Protocol: exchange root hashes -> identify divergent subtrees -> exchange missing events -> merge. No git required.\n\n## Acceptance Criteria\n- Two replicas can sync via root hash exchange and chunk diff\n- Missing events transferred and merged correctly\n- Works over arbitrary transport (API takes read/write closures)\n- Sync is idempotent (re-syncing produces no changes)\n- Unit tests: sync two diverged replicas, verify convergence, idempotence","acceptance_criteria":"Two replicas can sync via root hash exchange and chunk diff\nMissing events transferred and merged correctly\nWorks over arbitrary transport (API takes read/write closures)\nSync is idempotent (re-syncing produces no changes)\nUnit tests: sync two diverged replicas, verify convergence, idempotence","status":"open","priority":4,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T05:00:28.403075180Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:46.806257910Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-5","sync"],"dependencies":[{"issue_id":"bn-3w3.2","depends_on_id":"bn-3w3","type":"parent-child","created_at":"2026-02-16T05:00:28.403075180Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-3w3.2","depends_on_id":"bn-3w3.1","type":"blocks","created_at":"2026-02-16T05:00:31.428856872Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":105,"issue_id":"bn-3w3.2","author":"bones-dev","text":"Test coverage: unit tests for sync protocol between two diverged replicas, convergence verification after sync, idempotence (re-sync produces no changes), transport abstraction with mock read/write closures.","created_at":"2026-02-16T05:00:46Z"}]}
{"id":"bn-42v","title":"Observability and diagnostics track","description":"# Context\n\nObservability is required for safe autonomous operation: when something fails or slows down, users/agents need fast, actionable diagnostics without manual forensics.\n\n# Track Outcomes\n\n- Structured logs exist for replay, merge, projection, and command execution\n- Diagnostic commands expose event-log health and projection drift\n- Performance timings and SLO threshold checks are visible to users\n- Merge-resolution traces are available when conflicts/concurrency decisions occur\n\n# Exit Criteria\n\n- [ ] Child beads bn-1js, bn-m80, bn-21d, bn-3oz are completed\n- [ ] Diagnostic surfaces support both human-readable and machine-readable outputs\n- [ ] Coverage path is explicit and met: unit (child bead tests), e2e/workflow (bn-36d + bn-3i7 fault paths), diagnostics/log artifacts (this track produces them)\n\n# Notes\n\nThis is a planning track; implementation happens in child beads.","acceptance_criteria":"Structured logging operational (bn-1js complete)\nPerformance timing surfaces available (bn-21d complete)\nCRDT merge diagnostics available (bn-3oz complete)\nEvent log diagnostics command working (bn-m80 complete)\nAll diagnostic outputs machine-parseable (JSON mode)","status":"open","priority":2,"issue_type":"track","owner":"bones-dev","created_at":"2026-02-16T02:40:47.184912622Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:02.646003654Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cross-cutting","observability","phase-2","track"]}
{"id":"bn-4us","title":"Implement metric normalization and composite score function","description":"# Context\nFirst component of bn-sep: normalize raw metric inputs and compute the composite priority score P(v) = a*CP + b*PR + g*BC + d*U + e*D.\n\n# Implementation\n- Normalize each metric input to [0,1] range (min-max or z-score per metric)\n- Apply urgency override: urgent items get max score, punt items excluded\n- Apply decay factor: items in doing too long get boosted\n- Compute weighted sum with configurable default weights\n- Expose as a function consumed by triage CLI commands\n\n# How This Serves Project Goals\nThe composite score is the core value prop of bn next - computing priority from the graph rather than human guessing.","acceptance_criteria":"Each metric (CP, PR, BC, U, D) normalized to [0,1] before combination\nUrgency override: urgent items get maximum composite score\nPunt exclusion: punt items excluded from scoring entirely\nDecay factor: items in doing state beyond threshold get score boost\nDefault weights configurable, produce sensible ordering on test graphs\nUnit tests: normalization ranges, urgency override, punt exclusion, decay boost","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:47:04.202181396Z","created_by":"bones-dev","updated_at":"2026-02-16T04:50:22.118088488Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-2","triage"],"dependencies":[{"issue_id":"bn-4us","depends_on_id":"bn-12d","type":"blocks","created_at":"2026-02-16T04:47:24.465456483Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":66,"issue_id":"bn-4us","author":"bones-dev","text":"Implementation must ship unit tests alongside the code. Tests should be in the same PR/commit as the implementation.","created_at":"2026-02-16T04:50:22Z"}]}
{"id":"bn-50e","title":"Large repo handling (10k+ items)","description":"Test and optimize for repos with 10k+ work items and 100k+ events. Profile: event replay time, SQLite projection size, memory usage, CLI response time. Identify bottlenecks. Ensure bn list stays under 200ms even with 10k items. Consider: lazy projection (only rebuild on query), pagination everywhere, streaming event replay (don't load all events into memory).","acceptance_criteria":"Profile and optimize for 10k+ items and 100k+ events (Tier M corpus)\nbn list stays under 200ms even with 10k items\nEvent replay scales linearly (no quadratic bottlenecks)\nMemory usage bounded (streaming replay, not load-all-into-memory)\nIdentify and document remaining bottlenecks for future optimization\nBenchmark results documented with before/after comparisons","status":"open","priority":3,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:43:04.629324581Z","created_by":"bones-dev","updated_at":"2026-02-16T04:46:28.414878263Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge-case","performance","phase-3"],"dependencies":[{"issue_id":"bn-50e","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:43:32.795684051Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-50e","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T02:43:32.686709380Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-6dv","title":"Implement bn sync workflows and gitattributes/gitignore management","description":"# Context\nSync workflow guidance and git configuration management.\n\n# Implementation\n- bn sync: guidance or automation for pull/replay/push consistency\n- .gitattributes entries for event shard merge driver\n- .gitignore entries for bones.db, feedback.jsonl, cache/\n- Both managed by bn init and updated if needed\n- Documentation of safe merge and diverged-branch recovery","acceptance_criteria":"bn sync provides pull/replay/push workflow guidance or automation\n.gitattributes entries for merge driver managed by bn init\n.gitignore entries for generated files managed by bn init\nDocumentation covers: safe merge, diverged branch recovery\nUnit tests: gitattributes/gitignore generation","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:48:11.817851344Z","created_by":"bones-dev","updated_at":"2026-02-16T04:50:22.964396236Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["git","phase-2"],"dependencies":[{"issue_id":"bn-6dv","depends_on_id":"bn-8hi","type":"blocks","created_at":"2026-02-16T04:48:34.543490592Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":73,"issue_id":"bn-6dv","author":"bones-dev","text":"Implementation must ship unit tests alongside the code. Tests should be in the same PR/commit as the implementation.","created_at":"2026-02-16T04:50:22Z"}]}
{"id":"bn-7fz","title":"Implement graph normalization pipeline (SCC condensation + transitive reduction)","description":"# Context\nBefore computing centrality metrics, the dependency graph must be normalized per the plan's Graph Normalization Pipeline section. This runs between bn-30j (raw graph extraction) and bn-12d (metrics).\n\n# Implementation\n- Collapse SCCs (strongly connected components) into a condensation DAG\n- Compute transitive reduction for scheduling edges (remove redundant edges)\n- Preserve original graph for display and explanations\n- Output: normalized DAG suitable for PageRank, betweenness, critical path\n\n# Why This Exists\nProduces more stable metrics, faster computation, and fewer spurious bottleneck signals. Without normalization, cycles confuse PageRank and redundant edges inflate betweenness.","acceptance_criteria":"SCC detection collapses cycles into single condensation nodes\nTransitive reduction removes redundant edges from scheduling DAG\nOriginal graph preserved separately for display/explanation\nNormalized graph is a valid DAG (no cycles)\nUnit tests: known SCC topologies, transitive reduction correctness, condensation node mapping","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:54:07.120366839Z","created_by":"bones-dev","updated_at":"2026-02-16T04:54:17.624006796Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-2","triage"],"dependencies":[{"issue_id":"bn-7fz","depends_on_id":"bn-30j","type":"blocks","created_at":"2026-02-16T04:54:17.385914764Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":79,"issue_id":"bn-7fz","author":"bones-dev","text":"Implementation must ship unit tests alongside the code.","created_at":"2026-02-16T04:54:17Z"}]}
{"id":"bn-8hi","title":"bn init command","description":"# Context\n\n`bn init` is the first user touchpoint. It must create a valid project skeleton with safe defaults and clear next steps without surprising existing repos.\n\n# Scope\n\n- Create `.bones/` baseline structure and default config template\n- Initialize event shard directories according to current shard ADR decisions\n- Set up cache ignores and minimal repo metadata checks\n- Idempotent behavior when project is already initialized (`--force` for explicit reinit)\n- Provide actionable onboarding hints (actor identity, next commands)\n\n# Acceptance Criteria\n\n- [ ] Fresh init produces a working project skeleton with deterministic layout\n- [ ] Re-running init is safe and does not clobber user data without `--force`\n- [ ] Init validates repo context and explains non-git/standalone behavior clearly\n- [ ] Generated defaults are compatible with later config/git integration beads\n- [ ] Coverage path is explicit: unit (filesystem/layout checks), e2e/workflow (bn-1cr init/install flows), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"bn init creates .bones/ directory structure (events/, config.yaml)\nCreates initial empty active shard with header comment\nSets up .gitignore for bones.db, feedback.jsonl, cache/\nDetects existing .bones/ and refuses to overwrite\nWorks in any git repo (not bones-specific git setup)\nUnit tests: init in empty dir, init in existing repo, refuse double-init","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:42:18.993551155Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:02.675330336Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-1"],"dependencies":[{"issue_id":"bn-8hi","depends_on_id":"bn-1t8","type":"blocks","created_at":"2026-02-16T03:20:03.494761439Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-8hi","depends_on_id":"bn-2vb","type":"blocks","created_at":"2026-02-16T02:42:47.152432587Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":20,"issue_id":"bn-8hi","author":"bones-dev","text":"bn init should prompt/suggest setting AGENT or BONES_ACTOR if neither is set, so the user knows attribution is required for mutations.","created_at":"2026-02-16T03:12:36Z"}]}
{"id":"bn-9iz","title":"Implement duplicate prevention warning during bn create","description":"When running bn create, query the duplicate risk scoring API. If matches above threshold, display warning with similar items and scores. Options: create anyway, link to existing, abort. Configurable: search.warn_on_create (true) and search.block_on_create (false). Supports --json output for agent consumption.","acceptance_criteria":"bn create shows warning when similar items found above threshold\nlikely_duplicate/possibly_related/maybe_related classifications displayed\nUser can choose create/link/abort\n--force flag skips warning\n--json output includes match data\nConfig toggles work (warn_on_create, block_on_create)\nUnit tests for each threshold level and user choice","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-16T04:57:03.656740085Z","created_by":"bones-dev","updated_at":"2026-02-16T04:57:38.834922040Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["dedup","phase-3"],"dependencies":[{"issue_id":"bn-9iz","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T04:57:30.876574300Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-9iz","depends_on_id":"bn-ihh","type":"blocks","created_at":"2026-02-16T04:57:30.198147139Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":87,"issue_id":"bn-9iz","author":"bones-dev","text":"Implementation must ship unit tests alongside the code.","created_at":"2026-02-16T04:57:38Z"}]}
{"id":"bn-afb","title":"Implement Whittle Index multi-agent scheduler with fallback","description":"# Context\n\nWhen multiple agents ask bn next simultaneously, they should get different answers to avoid duplicate work. The Whittle Index provides optimal assignment when indexability conditions are met; otherwise a constrained optimization fallback is used.\n\n# Goals\n\n- Whittle Index computation with indexability checks\n- Fallback: constrained min-cost max-flow assignment\n- bn next --agent N: assign N agents to N different items\n- bn plan --explain: report chosen regime and rationale\n- Fairness constraints (bounded starvation)\n- Anti-duplicate-assignment penalty\n\n# Implementation Approach\n\n## Key Components\n\n1. Whittle eligibility test: check if current workload satisfies indexability conditions\n2. Whittle Index: scalar priority per item accounting for value, opportunity cost, effort, dynamic state\n3. Fallback: formulate as assignment optimization, solve with min-cost flow or greedy with constraints\n4. Fairness: track agent assignment history, penalize repeated assignment to same item type\n\n## Files to Create/Modify\n\n- crates/bones-triage/src/schedule/whittle.rs — Whittle Index\n- crates/bones-triage/src/schedule/fallback.rs — Min-cost flow fallback\n- crates/bones-triage/src/schedule/mod.rs — Regime selection\n\n## Acceptance Criteria\n\n- [ ] Whittle Index produces different assignments for concurrent agents\n- [ ] Indexability check correctly identifies eligible workloads\n- [ ] Fallback produces reasonable assignments when Whittle not eligible\n- [ ] bn plan --explain reports regime and reason\n- [ ] Fairness: no agent starved over time\n- [ ] Throughput improvement over serial assignment in simulator\n\n# How This Serves Overarching Goals\n\nThis makes bn next a protocol for autonomous work distribution, not just a recommendation engine. Multiple agents working in parallel without coordination overhead.","acceptance_criteria":"Whittle Index when indexability checks pass; constrained optimization fallback otherwise; fairness constraints; bn plan --explain reports regime used","status":"open","priority":3,"issue_type":"epic","created_at":"2026-02-16T02:26:02.018577307Z","created_by":"bones-dev","updated_at":"2026-02-16T04:59:53.015228442Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["multi-agent","phase-5","scheduling"],"dependencies":[{"issue_id":"bn-afb","depends_on_id":"bn-3hf","type":"blocks","created_at":"2026-02-16T02:27:08.975551434Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-afb","depends_on_id":"bn-sep","type":"blocks","created_at":"2026-02-16T02:27:08.867354869Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":100,"issue_id":"bn-afb","author":"bones-dev","text":"Decomposed into children: bn-afb.1 (Whittle Index computation with indexability gate) and bn-afb.2 (constrained optimization fallback scheduler). bn-afb is the parent epic - close when children complete.","created_at":"2026-02-16T04:59:53Z"}]}
{"id":"bn-afb.1","title":"Implement Whittle Index computation with indexability gate","description":"Compute Whittle Index for each item based on: immediate value of completing (unblocking downstream), opportunity cost, expected completion time (from size estimate), dynamic state (blocked by in-progress item?). Include indexability check: only use Whittle when the workload class satisfies indexability conditions. If indexability fails, signal to use fallback.\n\n## Acceptance Criteria\n- Whittle Index computed per item considering value, cost, completion time, state\n- Indexability check validates workload class before using Whittle\n- Clear signal when indexability fails (trigger fallback)\n- Index values produce sensible ordering on test scenarios\n- Unit tests: known Whittle values on small problems, indexability pass/fail","acceptance_criteria":"Whittle Index computed per item considering value, cost, completion time, state\nIndexability check validates workload class before using Whittle\nClear signal when indexability fails (trigger fallback)\nIndex values produce sensible ordering on test scenarios\nUnit tests: known Whittle values on small problems, indexability pass/fail","status":"open","priority":3,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:59:26.703314264Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:46.423537416Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["multi-agent","phase-5","scheduling"],"dependencies":[{"issue_id":"bn-afb.1","depends_on_id":"bn-afb","type":"parent-child","created_at":"2026-02-16T04:59:26.703314264Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-afb.1","depends_on_id":"bn-sep","type":"blocks","created_at":"2026-02-16T04:59:31.077180823Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":101,"issue_id":"bn-afb.1","author":"bones-dev","text":"Test coverage: unit tests for Whittle Index computation on known small problems (verify optimal values), indexability pass/fail on different workload classes, sensible ordering verification on test dependency graphs.","created_at":"2026-02-16T04:59:57Z"}]}
{"id":"bn-afb.2","title":"Implement constrained optimization fallback scheduler","description":"Min-cost flow style assignment when Whittle indexability fails. Assignment accounts for: fairness constraints (bounded agent starvation), anti-duplicate-assignment penalty, agent count (bn next --agent N). bn plan --explain reports which regime (Whittle or fallback) was used and why.\n\n## Acceptance Criteria\n- Fallback produces valid N-agent assignment when Whittle is infeasible\n- Fairness: no agent starved beyond configurable threshold\n- Anti-duplicate: same item not assigned to multiple agents\n- bn plan --explain reports regime choice with rationale\n- Unit tests: fallback assignment, fairness constraint, regime explanation","acceptance_criteria":"Fallback produces valid N-agent assignment when Whittle infeasible\nFairness: no agent starved beyond configurable threshold\nAnti-duplicate: same item not assigned to multiple agents\nbn plan --explain reports regime choice with rationale\nUnit tests: fallback assignment, fairness constraint, regime explanation","status":"open","priority":3,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:59:40.535953297Z","created_by":"bones-dev","updated_at":"2026-02-16T05:03:46.551634783Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["multi-agent","phase-5","scheduling"],"dependencies":[{"issue_id":"bn-afb.2","depends_on_id":"bn-afb","type":"parent-child","created_at":"2026-02-16T04:59:40.535953297Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-afb.2","depends_on_id":"bn-afb.1","type":"blocks","created_at":"2026-02-16T04:59:44.930092041Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":102,"issue_id":"bn-afb.2","author":"bones-dev","text":"Test coverage: unit tests for fallback assignment with N agents, fairness constraint enforcement (no agent starved beyond threshold), anti-duplicate assignment verification, regime explanation accuracy in bn plan --explain output.","created_at":"2026-02-16T05:00:02Z"}]}
{"id":"bn-doc","title":"Multi-repo merge and sync protocol","description":"# Context\n\nBones relies on git-native collaboration across forks and shared repos. This bead defines the merge/sync protocol so replicas converge predictably with actionable diagnostics.\n\n# Scope\n\n- Merge semantics for divergent event histories across repos\n- Deduplication policy by event hash and causal replay ordering rules\n- Sync workflow guidance (`pull/replay/push`) for human + agent use\n- Change-report output describing what converged during merge\n\n# Acceptance Criteria\n\n- [ ] Divergent histories converge to identical state regardless of merge order\n- [ ] Duplicate events are idempotently ignored with deterministic diagnostics\n- [ ] Sync workflows document safe recovery for partial/conflicting merges\n- [ ] Protocol docs include fork/PR and shared-repo examples\n- [ ] Coverage path is explicit: unit (merge ordering/dedup tests), e2e/workflow (bn-385), diagnostics/log artifacts (bn-m80 + bn-1js)\n","acceptance_criteria":"Merge semantics for divergent event histories documented and implemented\nDeduplication policy by event hash with deterministic ordering rules\nbn sync command or guidance document for pull/replay/push workflow\nChange-report output describing what converged during merge\nUnit tests: divergent histories converge to identical state regardless of merge order\nE2E test: fork repo, diverge, merge, verify convergence","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:43:46.057568011Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:23.773355150Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["crdt","git","phase-2","sync"],"dependencies":[{"issue_id":"bn-doc","depends_on_id":"bn-26o","type":"blocks","created_at":"2026-02-16T02:44:07.308668053Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-doc","depends_on_id":"bn-2o3","type":"blocks","created_at":"2026-02-16T02:44:07.199881464Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-doc","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:44:07.090965642Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-foy","title":"Event format validation and hardening","description":"Strict TSJSON parse validation: reject malformed timestamps, unknown event types, oversized payloads, invalid JSON in data field. Verify Merkle hash chains on load. Detect and report tampered or truncated event files. Graceful handling of corrupt shards without losing valid data.","acceptance_criteria":"Validate event format on read: check field count, timestamp range, valid event type\nReject malformed events with clear error including line number and shard file\nValidate event type against known enum variants\nValidate JSON payload schema per event type\nReport validation results (pass/fail/skip counts)\nUnit tests: valid events pass, each malformation type caught with useful error","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:40:55.260832020Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:03.472936127Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["crdt","phase-1","security"],"dependencies":[{"issue_id":"bn-foy","depends_on_id":"bn-298","type":"blocks","created_at":"2026-02-16T02:41:27.701191965Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-foy","depends_on_id":"bn-2lv","type":"parent-child","created_at":"2026-02-16T03:09:21.174009113Z","created_by":"1","metadata":"{}","thread_id":""},{"issue_id":"bn-foy","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:41:27.584934031Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-hws","title":"Build semilattice property test harness","description":"# Context\n\nBones CRDTs must satisfy three semilattice laws: associativity, commutativity, and idempotence. A property test harness that verifies these laws against arbitrary random inputs is the first line of defense against merge bugs.\n\n# Goals\n\n- Create a Rust test harness using proptest\n- Generate arbitrary Bones states and events\n- Verify semilattice laws for all CRDT field types\n- Achieve coverage of at least 1M random inputs per law per field type\n\n# Background\n\nProperty tests needed:\n- merge_is_commutative: merge(a, b) == merge(b, a)\n- merge_is_associative: merge(merge(a, b), c) == merge(a, merge(b, c))\n- merge_is_idempotent: merge(a, a) == a\n\nMust cover: LWW Registers, OR-Sets, G-Sets, and the epoch+phase state type. The Arbitrary generators need to produce realistic Bones states including edge cases like concurrent writes with identical timestamps, empty sets, maximum-depth ITC stamps.\n\n# Implementation Approach\n\n## Key Components\n\n1. Arbitrary generators for each CRDT type (LWW value with ITC stamp + wall_ts + actor_id + event_hash, OR-Set with add/remove history, G-Set, epoch+phase pairs)\n2. Merge function implementations (stubs initially — get filled in during Phase 1)\n3. Test runner configuration (iteration count, shrinking, seed recording)\n\n## Files to Create/Modify\n\n- crates/bones-core/src/crdt/mod.rs — CRDT type definitions (minimal, enough for tests)\n- crates/bones-core/src/crdt/merge.rs — Merge function signatures\n- tests/proptest_semilattice.rs — Property test harness\n- tests/generators.rs — Arbitrary implementations\n\n## Acceptance Criteria\n\n- [ ] Arbitrary generators for all CRDT field types\n- [ ] Three property tests (commutative, associative, idempotent) per field type\n- [ ] Proptest configured with 1M+ cases for CI, 10K for local dev\n- [ ] Shrinking produces minimal counterexamples\n- [ ] Regression file mechanism for recording failures\n- [ ] Tests compile and run against stub merge functions\n\n# How This Serves Overarching Goals\n\nThis harness is the automated proof that Bones' convergence guarantees hold. Every future change to merge logic must pass these tests.","acceptance_criteria":"Arbitrary generators for all CRDT types; 3 property tests per type; proptest 1M+ cases CI / 10K local; shrinking works; regression file committed","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-16T02:20:11.269477468Z","created_by":"bones-dev","updated_at":"2026-02-16T04:08:01.406082639Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["crdt","foundation","phase-0","testing"],"dependencies":[{"issue_id":"bn-hws","depends_on_id":"bn-2jr","type":"blocks","created_at":"2026-02-16T02:26:33.345398315Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-hws","depends_on_id":"bn-2vb","type":"blocks","created_at":"2026-02-16T02:26:33.707520558Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-if2","title":"E2E triage command workflows (next/triage/plan/health/cycles)","description":"# Context\n\nAlgorithmic correctness tests (bn-20h) are necessary but not sufficient; triage command UX/JSON contracts also need subprocess-level verification.\n\n# Scope\n\n- End-to-end workflows for `bn next`, `bn triage`, `bn plan`, `bn health`, `bn cycles`\n- `bn did` / `bn skip` feedback recording flows\n- Determinism checks for stable inputs (same graph -> same command output ordering)\n- JSON schema contract checks for automation consumers\n\n# Acceptance Criteria\n\n- [ ] Core triage command workflows pass on representative project graphs\n- [ ] Feedback commands alter subsequent recommendations as expected in fixtures\n- [ ] JSON outputs parse and preserve documented fields\n- [ ] Failure scenarios produce actionable diagnostics\n- [ ] Failed runs retain structured logs and traces\n\n# Coverage Path\n\n- Unit verification: bn-12d, bn-sep, bn-3hf, bn-20h.*\n- E2E/workflow verification: this bead\n- Diagnostic logging/artifacts: bn-1js, bn-m80\n","acceptance_criteria":"E2E test: bn next returns highest-priority unblocked item\nE2E test: bn triage produces project triage report\nE2E test: bn plan generates parallelizable execution plan\nE2E test: bn health reports project health metrics\nE2E test: bn cycles detects and reports dependency cycles\nAll tests use realistic multi-item scenarios via CLI subprocess","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T03:18:38.342615907Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:38.735962908Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["e2e","phase-2","quality-gate","testing","triage"],"dependencies":[{"issue_id":"bn-if2","depends_on_id":"bn-1js","type":"blocks","created_at":"2026-02-16T03:18:46.864547423Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-if2","depends_on_id":"bn-20h","type":"parent-child","created_at":"2026-02-16T03:18:47.093790825Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-if2","depends_on_id":"bn-3hf","type":"blocks","created_at":"2026-02-16T03:18:46.733367337Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-if2","depends_on_id":"bn-m80","type":"blocks","created_at":"2026-02-16T03:18:46.977437415Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-ihh","title":"Implement duplicate risk scoring API with configurable thresholds","description":"# Context\nBackend API that consumes structural similarity + lexical + semantic scores and produces a duplicate risk classification.\n\n# Implementation\n- RRF (Reciprocal Rank Fusion, K=60) combining all three layers' ranked lists\n- Threshold-based classification: likely_duplicate (>=0.90), possibly_related (0.70-0.89), maybe_related (0.50-0.69)\n- Thresholds configurable in .bones/config.yaml\n- Explainability payload: per-layer contribution to final score\n- API returns: ranked candidates with scores, classifications, and explanations","acceptance_criteria":"RRF (K=60) combines lexical, semantic, and structural ranked lists\nThreshold classification: likely_duplicate >=0.90, possibly_related 0.70-0.89, maybe_related 0.50-0.69\nThresholds configurable in .bones/config.yaml\nExplainability payload: per-layer contribution breakdown\nAPI returns ranked candidates with scores and classifications\nUnit tests: RRF computation, threshold classification, config override","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:55:04.820120090Z","created_by":"bones-dev","updated_at":"2026-02-16T04:56:03.168841223Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["dedup","phase-3","search"],"dependencies":[{"issue_id":"bn-ihh","depends_on_id":"bn-2a7","type":"blocks","created_at":"2026-02-16T04:56:03.168800627Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-ihh","depends_on_id":"bn-2j7","type":"blocks","created_at":"2026-02-16T04:56:03.046039801Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-ihh","depends_on_id":"bn-3fg","type":"blocks","created_at":"2026-02-16T04:56:02.924295671Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":85,"issue_id":"bn-ihh","author":"bones-dev","text":"Implementation must ship unit tests alongside the code.","created_at":"2026-02-16T04:56:02Z"}]}
{"id":"bn-m80","title":"Event log diagnostics command","description":"# Context\n\nUsers need a single command to inspect repository health when debugging convergence or corruption issues. This bead provides that diagnostic entrypoint.\n\n# Scope\n\n- `bn diagnose` health summary: shard inventory, event stats, actor distribution, time ranges\n- Integrity checks: hash-chain anomalies, orphan events, projection drift indicators\n- Output modes: concise human report + stable `--json` schema\n- Remediation hints for common failure signatures\n\n# Acceptance Criteria\n\n- [ ] Health report surfaces core integrity signals accurately\n- [ ] JSON schema is stable and documented for automation\n- [ ] Diagnostics include actionable remediation guidance\n- [ ] Command remains usable on partially degraded repositories\n- [ ] Coverage path is explicit: unit (health computation tests), e2e/workflow (bn-36d + bn-zr8), diagnostics/log artifacts (produced by this bead + bn-1js)\n","acceptance_criteria":"bn log shows event history (all events or filtered by item)\nEvent log diagnostics: count by type, count by agent, count by shard\nShard health: event counts, byte sizes, timestamp ranges per shard\nOutput supports --json for machine consumption\nUnit tests: diagnostic counts match actual event data","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:41:07.031082276Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:24.389379728Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","observability","phase-2"],"dependencies":[{"issue_id":"bn-m80","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:41:31.652505158Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-m80","depends_on_id":"bn-42v","type":"parent-child","created_at":"2026-02-16T03:09:30.883533478Z","created_by":"1","metadata":"{}","thread_id":""},{"issue_id":"bn-m80","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:41:31.408226990Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-m80","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T02:41:31.527852315Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-m95","title":"Implement lattice-based log compaction (item.snapshot)","description":"# Context\n\nOver time the event log grows. Lattice compaction replaces event sequences for completed items with a single item.snapshot event — the semilattice join. Coordination-free: each replica compacts independently and converges.\n\n# Goals\n\n- Implement item.snapshot event generation (join of all events for an item)\n- bn compact command to compact old done/archived items\n- Configurable compaction policy (items in done/archived > 30 days)\n- Preserve audit metadata (_compacted_from count, _earliest_ts, _latest_ts)\n- Verify compacted state matches uncompacted state\n\n# Implementation Approach\n\nFor each eligible item, replay all its events to produce final CRDT state, emit a single item.snapshot event with that state. Remove original events from future shards (or mark as superseded). Verify: materialized state from snapshot matches state from full replay.\n\n## Files to Create/Modify\n\n- crates/bones-core/src/compact.rs — Compaction logic\n- crates/bones-cli/src/cmd/compact.rs — CLI command\n\n## Acceptance Criteria\n\n- [ ] Snapshot events correctly represent join of all item events\n- [ ] Compacted state matches uncompacted state exactly\n- [ ] Compaction is coordination-free (replicas compact independently, converge)\n- [ ] Configurable policy (age threshold, target states)\n- [ ] Audit metadata preserved\n- [ ] Property test: compact(events) produces same state as replay(events)\n\n# How This Serves Overarching Goals\n\nLog compaction keeps the event log manageable for mature projects. ~70% reduction for projects with many completed items.","acceptance_criteria":"item.snapshot = semilattice join of all events; bn compact targets done/archived >30 days; compacted state matches uncompacted; ~70% reduction for mature projects","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-16T02:25:21.119378401Z","created_by":"bones-dev","updated_at":"2026-02-16T04:08:34.784910392Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["compaction","phase-4","storage"],"dependencies":[{"issue_id":"bn-m95","depends_on_id":"bn-2y3","type":"blocks","created_at":"2026-02-16T02:27:08.185798370Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-m95","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:27:08.293004720Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-o13","title":"Implement MCP server (bn mcp)","description":"# Context & Background\n\nThe plan specifies a built-in MCP (Model Context Protocol) server exposing the full Bones API. This makes Bones instantly usable from any MCP-aware agent (Claude, Cursor, etc.) without CLI shelling. MCP provides a standardized JSON-RPC protocol for tool discovery and invocation, making Bones a first-class tool in the AI agent ecosystem.\n\nCurrently agents interact with Bones via CLI commands with `--json` output. MCP provides a richer integration: tool schemas with typed parameters, streaming results, and bidirectional communication. This eliminates the overhead of spawning subprocesses and parsing stdout for every operation.\n\n# Goals\n\n- Implement `bn mcp` command that starts an MCP server (stdio transport)\n- Expose all Bones operations as MCP tools with typed schemas\n- Support tool discovery (list available tools with parameter schemas)\n- Support streaming for long-running operations (rebuild, triage)\n- Graceful shutdown on stdin close or SIGTERM\n\n# Reasoning/Justification\n\nMCP is the emerging standard for agent-tool integration. Supporting it natively means:\n- Zero-friction adoption by MCP-aware agents (no wrapper scripts or custom integrations)\n- Type-safe tool invocation (parameter validation at the protocol level)\n- Better performance than CLI shelling (no process spawn per operation)\n- Bidirectional communication enables progress reporting and interactive workflows\n\nThe plan lists this as Phase 5 because the core CLI must be stable first — MCP tools are thin wrappers over the same operations.\n\n# Implementation Approach\n\n## Key Components\n\n1. **MCP server runtime**: Tokio-based server using stdio transport (stdin/stdout JSON-RPC). Use the `mcp-server` or `rmcp` crate if mature, otherwise implement the MCP protocol directly (it's a simple JSON-RPC envelope).\n\n2. **Tool registry**: Map each Bones operation to an MCP tool with typed schema:\n   - `bones_create` — Create work item (params: title, kind, size, urgency, parent, labels, blocks)\n   - `bones_list` — List items (params: state, kind, label, urgency, assignee, parent)\n   - `bones_show` — Show item details (params: id)\n   - `bones_do` — Move to doing (params: id)\n   - `bones_done` — Move to done (params: id, reason)\n   - `bones_next` — Get triage recommendation (params: agent_count)\n   - `bones_triage` — Full triage report\n   - `bones_search` — Search items (params: query, mode)\n   - `bones_link` — Add dependency (params: from, to, link_type)\n   - `bones_tag` — Add/remove labels (params: id, add, remove)\n   - `bones_graph` — Dependency tree (params: id)\n   - `bones_health` — Project health dashboard\n   - `bones_plan` — Parallel execution plan (params: goal_id)\n   - `bones_verify` — Shard integrity check\n   - `bones_rebuild` — Rebuild projection\n   - `bones_compact` — Log compaction\n   - `bones_stats` — Event log statistics\n\n3. **Shared operation layer**: MCP tools call the same core library functions as CLI commands. No duplicate logic.\n\n4. **Error handling**: MCP error responses with structured error codes matching CLI error codes from bn-3fs.1.\n\n5. **Configuration**: `bn mcp` reads `.bones/config.yaml` for project settings. Optionally specify `--transport` (stdio default, could add HTTP later).\n\n## Files to Create/Modify\n\n- `crates/bones-cli/src/cmd/mcp.rs` — MCP server command and runtime\n- `crates/bones-cli/src/mcp/mod.rs` — MCP protocol handler\n- `crates/bones-cli/src/mcp/tools.rs` — Tool registry and schemas\n- `crates/bones-cli/src/mcp/transport.rs` — Stdio transport\n\n## Edge Cases\n\n- Agent sends invalid parameters: return structured MCP error with parameter-level detail\n- Server started in non-initialized repo: return init-required error\n- Concurrent tool calls: each call gets its own EventStore handle; file locking prevents corruption\n- Long-running operations (rebuild, triage): use MCP progress notifications if supported\n\n# Acceptance Criteria\n\n- [ ] `bn mcp` starts stdio MCP server and responds to `initialize` handshake\n- [ ] All core operations available as MCP tools with typed schemas\n- [ ] Tool discovery returns complete list with parameter schemas\n- [ ] Tool invocations produce correct results matching CLI `--json` output\n- [ ] Error responses include structured error codes\n- [ ] Server shuts down cleanly on stdin close or SIGTERM\n- [ ] Integration test: MCP client connects, discovers tools, invokes create/list/show cycle\n- [ ] Performance: tool invocation overhead < 5ms above equivalent CLI operation\n\n# How This Serves Project Goals\n\n\"Agents first, humans welcome\" (philosophy #5) — MCP is the native protocol for modern AI agents. Supporting it makes Bones a first-class citizen in the agent tool ecosystem without sacrificing the CLI-first design. Every command has `--json`, and every `--json` operation becomes an MCP tool.","status":"closed","priority":3,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T03:41:07.837429182Z","created_by":"bones-dev","updated_at":"2026-02-16T03:41:49.009813050Z","closed_at":"2026-02-16T03:41:49.009773045Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["agents","distribution","mcp","phase-5"]}
{"id":"bn-rdc","title":"Implement TUI triage view and search with duplicate detection","description":"# Context\nTriage and search views that expose the triage engine and search in the TUI.\n\n# Implementation\n- Triage view: bn next recommendations with scores and explanations\n- Search view: live search with results updating as you type\n- Duplicate detection: similar items shown when creating new item\n- Keyboard shortcuts matching CLI verbs (d=do, D=done, c=create, etc.)\n- All views support --json data layer for consistency with CLI","acceptance_criteria":"Triage view: shows bn next recommendations with scores\nSearch view: live results updating as user types\nDuplicate detection: similar items shown during create flow\nKeyboard shortcuts match CLI verbs (d=do, D=done, c=create)\nUnit tests: triage display, search results, keyboard bindings","status":"open","priority":3,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:48:21.578831281Z","created_by":"bones-dev","updated_at":"2026-02-16T04:50:23.325968920Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-5","tui"],"dependencies":[{"issue_id":"bn-rdc","depends_on_id":"bn-37f","type":"blocks","created_at":"2026-02-16T04:48:42.042253839Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-rdc","depends_on_id":"bn-sep","type":"blocks","created_at":"2026-02-16T04:48:42.165202416Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":76,"issue_id":"bn-rdc","author":"bones-dev","text":"Implementation must ship unit tests alongside the code. Tests should be in the same PR/commit as the implementation.","created_at":"2026-02-16T04:50:23Z"}]}
{"id":"bn-sep","title":"Composite priority scoring and feedback-learning backend","description":"# Context\n\nThis bead implements the adaptive scoring backend that powers triage. CLI command surfaces (`bn did`/`bn skip`) are implemented separately in bn-3hf.\n\n# Goals\n\n- Composite priority function: `P(v) = a*CP + b*PR + g*BC + d*U + e*D`\n- Thompson Sampling contextual bandit for weight adaptation\n- Feedback storage model in local, gitignored log\n- Per-agent weight profiles and update rules\n\n# Implementation Approach\n\n- Normalize metric inputs to consistent ranges before combining\n- Apply urgency override policy (`urgent` top, `punt` excluded)\n- Maintain posterior distributions per profile and update from feedback events\n- Expose backend APIs consumed by triage CLI commands\n\n# Acceptance Criteria\n\n- [ ] Composite score ranks sample graphs sensibly with urgency overrides honored\n- [ ] Feedback updates adjust per-agent weights over time\n- [ ] Backend API supports recording did/skip outcomes from CLI layer\n- [ ] Feedback storage is local-only and robust to partial writes\n- [ ] Coverage path is explicit: unit (scoring/bandit tests), e2e/workflow (bn-3hf + bn-20h.3), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"Composite P(v) = a*CP + b*PR + g*BC + d*U + e*D computes correctly; Thompson Sampling updates weights; feedback stored in .bones/feedback.jsonl; urgency overrides work; punt excluded","status":"open","priority":2,"issue_type":"epic","created_at":"2026-02-16T02:24:29.523426169Z","created_by":"bones-dev","updated_at":"2026-02-16T04:47:24.802327394Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["feedback","phase-2","scoring","triage"],"dependencies":[{"issue_id":"bn-sep","depends_on_id":"bn-12d","type":"blocks","created_at":"2026-02-16T02:27:07.082487311Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":62,"issue_id":"bn-sep","author":"bones-dev","text":"Decomposed into children: bn-4us (normalization + composite score) and bn-3vq (Thompson Sampling feedback). bn-sep is the parent epic - close when children complete.","created_at":"2026-02-16T04:47:24Z"}]}
{"id":"bn-sgf","title":"Hybrid search/dup ranking upgrade (semantic + structural fusion)","description":"# Context\n\nLexical search ships first in bn-2a7. This bead upgrades ranking quality by fusing lexical, semantic, and structural signals for better duplicate prevention.\n\n# Scope\n\n- Integrate semantic similarity (bn-2c5) and structural similarity (bn-1as backend) into `bn search` and `bn dup`\n- Apply Reciprocal Rank Fusion (RRF) with explainable per-layer score breakdown\n- Add duplicate-warning policy for create/update flows using fused thresholds\n- Preserve lexical-only fallback when model/vector subsystem is unavailable\n\n# Acceptance Criteria\n\n- [ ] Hybrid ranking improves duplicate recall on evaluation dataset vs lexical baseline\n- [ ] `bn search`/`bn dup` expose per-layer rationale in `--json` output\n- [ ] Fallback to lexical-only mode is deterministic and user-visible\n- [ ] Duplicate warning thresholds are configurable and documented\n- [ ] Coverage path is explicit: unit (fusion/scoring tests in bn-1as), e2e/workflow (bn-2ly search-quality scenarios), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"RRF (Reciprocal Rank Fusion, K=60) combines all three search layers\nSemantic + structural signals improve ranking over lexical-only baseline\nDuplicate detection threshold: configurable likely/possibly/maybe thresholds\nbn create duplicate warning fires when threshold exceeded\nEvaluation: fusion ranking beats individual layers on gold dataset\nUnit tests: RRF computation, threshold-based classification","status":"open","priority":3,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T03:17:32.055894678Z","created_by":"bones-dev","updated_at":"2026-02-16T04:56:57.061359750Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["dedup","fusion","phase-3","search"],"dependencies":[{"issue_id":"bn-sgf","depends_on_id":"bn-1as","type":"blocks","created_at":"2026-02-16T03:17:37.188089645Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-sgf","depends_on_id":"bn-2a7","type":"blocks","created_at":"2026-02-16T03:17:37.072758428Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-sgf","depends_on_id":"bn-2c5","type":"blocks","created_at":"2026-02-16T03:17:37.303185601Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-sgf","depends_on_id":"bn-ihh","type":"blocks","created_at":"2026-02-16T04:56:57.061319885Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-v45","title":"History and audit trail commands","description":"# Context\n\nAuditability builds trust: users and agents need to understand who changed what, when, and why. This bead implements event-history inspection commands.\n\n# Scope\n\n- `bn history <id>` item-level chronological event timeline\n- `bn log` recent cross-item event stream\n- `bn blame <id> <field>` last-writer attribution lookup\n- Filtering controls (`--since`, `--actor`, and output format options)\n\n# Acceptance Criteria\n\n- [ ] Timeline ordering is deterministic and replay-consistent\n- [ ] Field attribution matches source event data accurately\n- [ ] Filters reduce output correctly without hiding relevant events\n- [ ] JSON outputs are stable for automation/audit ingestion\n- [ ] Coverage path is explicit: unit (history/blame query tests), e2e/workflow (bn-36d), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"bn log <id> shows event history for a specific item\nbn history shows recent events across all items\nOutput includes timestamp, agent, event type, and summary\nSupports --since and --limit filters\nJSON output mode for programmatic access\nUnit tests: item log, global history, filters","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:43:23.658919939Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:43.033793508Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-2"],"dependencies":[{"issue_id":"bn-v45","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:43:33.999435521Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-v45","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:43:33.888229712Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-vpa","title":"Implement embedding pipeline: compute and store 384-dim vectors","description":"# Context\nSecond step: compute embeddings for items and store them for retrieval.\n\n# Implementation\n- Tokenize text (title + description) for MiniLM input\n- Run ONNX inference to produce 384-dim float32 embedding (~5ms/item)\n- Store embeddings in sqlite-vec extension (create virtual table, insert/update vectors)\n- Lazy computation: embed on create/update, batch for rebuild\n- sqlite-vec schema: item_id → 384-dim vector\n\n# Dependencies\nNeeds ONNX model loaded (sibling bead) and SQLite projection (bn-z23).","acceptance_criteria":"Tokenize title+description text for MiniLM input\nONNX inference produces 384-dim float32 embedding vector\nsqlite-vec virtual table created for vector storage\nEmbeddings inserted/updated on item create/update events\nBatch embedding for bn rebuild (all items at once)\nPerformance: <10ms per item embedding on CPU\nUnit tests: embedding computation, sqlite-vec storage, batch mode","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:54:34.407042785Z","created_by":"bones-dev","updated_at":"2026-02-16T04:54:52.438198153Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-3","search","semantic"],"dependencies":[{"issue_id":"bn-vpa","depends_on_id":"bn-1yo","type":"blocks","created_at":"2026-02-16T04:54:51.839690523Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":82,"issue_id":"bn-vpa","author":"bones-dev","text":"Implementation must ship unit tests alongside the code.","created_at":"2026-02-16T04:54:52Z"}]}
{"id":"bn-x2e","title":"Implement TSJSON event format parser and writer","description":"# Context\n\nTSJSON is Bones' canonical event format: tab-separated fixed fields (timestamp, actor, type, item_id) with a JSON data payload. Every other component reads or writes this format.\n\n# Goals\n\n- Zero-copy TSJSON parser in Rust\n- TSJSON writer (event serialization)\n- Comment line support (# prefix), shard header convention\n- Partial parse capability (extract fixed fields without JSON parsing)\n- Event type enum (item.create, item.update, item.move, item.assign, item.comment, item.link, item.unlink, item.delete, item.compact, item.snapshot, item.redact)\n\n# Implementation Approach\n\nParser splits on first 4 tabs, takes remainder as JSON. Zero-copy (return &str slices). Validates field constraints. Writer ensures DATA JSON has no literal newlines. Item ID type is a validated newtype with content-hash generation (BLAKE3, truncated to short hex).\n\nShard I/O: read/append to .events files, support time-sharded directory layout (YYYY-MM.events), atomic append (write + fsync).\n\n## Files to Create/Modify\n\n- crates/bones-core/src/event/format.rs — TSJSON parser/writer\n- crates/bones-core/src/event/types.rs — Event type enum\n- crates/bones-core/src/event/mod.rs — Event struct\n- crates/bones-core/src/item_id.rs — Item ID type\n- crates/bones-core/src/shard.rs — Shard file management\n\n## Acceptance Criteria\n\n- [ ] Parse valid TSJSON lines into Event structs\n- [ ] Reject malformed lines with clear error messages\n- [ ] Skip comment lines correctly\n- [ ] Write Event structs to valid TSJSON lines\n- [ ] Round-trip: parse(write(event)) == event for all event types\n- [ ] Partial parse extracts fixed fields without JSON parsing\n- [ ] Item ID generation is deterministic and collision-resistant\n- [ ] Shard file append is atomic\n- [ ] Benchmarks: parse throughput at Tier S/M/L\n\n# How This Serves Overarching Goals\n\nThis is the I/O layer for the entire system. Every event flows through this parser on read and writer on write.","acceptance_criteria":"All 5 children (x2e.1-x2e.5) complete and passing tests\nTSJSON events can be written, read, and round-tripped\nTime-sharded file management operational\nEvent types cover full spec catalog\nIntegration test: write events -> read back -> verify identical","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-16T02:21:39.307401869Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:21.292333372Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","events","parser","phase-1"],"dependencies":[{"issue_id":"bn-x2e","depends_on_id":"bn-1t8","type":"blocks","created_at":"2026-02-16T02:58:04.029961071Z","created_by":"1","metadata":"{}","thread_id":""},{"issue_id":"bn-x2e","depends_on_id":"bn-2h9","type":"blocks","created_at":"2026-02-16T04:25:34.816161091Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-x2e","depends_on_id":"bn-2vb","type":"blocks","created_at":"2026-02-16T02:26:41.064896358Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-x2e","depends_on_id":"bn-379","type":"blocks","created_at":"2026-02-16T02:58:04.149436035Z","created_by":"1","metadata":"{}","thread_id":""}],"comments":[{"id":5,"issue_id":"bn-x2e","author":"1","text":"Critical review pass: user value = guarantee a deterministic, parseable event wire format so every command and replay path behaves consistently. Failure modes = malformed-line ambiguity, non-atomic append corruption, and ID-format drift breaking references. Alternative considered: pure JSONL objects per event; rejected for slower fixed-field extraction and weaker human grepability at scale. Chosen approach (TSJSON fixed header + JSON payload + atomic append) gives predictable parsing and better throughput. Coverage path: unit verification bn-yot.1 (+ parser unit tests in bead), e2e/workflow bn-yot.3 and bn-yot.4, diagnostics/log artifacts bn-1js + bn-m80.","created_at":"2026-02-16T02:58:48Z"},{"id":23,"issue_id":"bn-x2e","author":"bones-dev","text":"TERMINOLOGY UPDATE: the TSJSON field order is: timestamp \\t agent \\t type \\t item_id \\t data. The field is 'agent' not 'actor'.","created_at":"2026-02-16T03:14:21Z"}]}
{"id":"bn-x2e.1","title":"Define Event struct, type enum, and data payload schemas","description":"# Context\nCore event data model that all parser/writer/replay code depends on. Defines the Event struct, the EventType enum covering all 11 event types, and typed serde-tagged payload schemas.\n\n# Implementation\n- `crates/bones-core/src/event/mod.rs` — Event struct (timestamp: u64, agent: String, event_type: EventType, item_id: ItemId, data: EventData)\n- `crates/bones-core/src/event/types.rs` — EventType enum with string ser/de\n- Payload enums: CreateData{title,kind,size,urgency,labels,parent}, UpdateData{field,value}, MoveData{state,reason}, AssignData{agent,action}, CommentData{body}, LinkData{target,link_type}, UnlinkData{target}, DeleteData{}, CompactData{summary}, SnapshotData{state}, RedactData{target_hash,reason}\n\n# Acceptance Criteria\n- [ ] Event struct with all fixed fields\n- [ ] EventType enum covers all 11 types with Display/FromStr\n- [ ] Typed payload enums for each event type\n- [ ] serde round-trip for all types\n- [ ] Unknown event types produce clear error","acceptance_criteria":"Event struct defined with all TSJSON fields (timestamp, agent, type, item_id, data)\nEventType enum covers all 11 event types from spec (item.create through item.redact)\nData payload schemas defined per event type with serde Serialize/Deserialize\nCausation field supported on item.create events\nUnit tests: round-trip serialize/deserialize for every event type\nUnit tests: reject malformed/unknown event types","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:04:08.964636715Z","created_by":"bones-dev","updated_at":"2026-02-16T04:41:23.090291792Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","events","phase-1"],"dependencies":[{"issue_id":"bn-x2e.1","depends_on_id":"bn-x2e","type":"parent-child","created_at":"2026-02-16T04:04:08.964636715Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":29,"issue_id":"bn-x2e.1","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:04Z"}]}
{"id":"bn-x2e.2","title":"Implement zero-copy TSJSON line parser","description":"# Context\nThe parser is the read path for all events. Must be zero-copy where possible (return &str slices into the line buffer), handle comment lines, and support partial parse (extract fixed fields without deserializing JSON payload).\n\n# Implementation\n- `crates/bones-core/src/event/format.rs` — parse_line() function\n- Split on first 4 tab characters, remainder is JSON payload\n- Validate: timestamp is valid u64, agent has no whitespace, event_type is known enum variant, item_id matches bn-XXX pattern\n- Comment lines (# prefix) returned as a distinct variant or skipped\n- Partial parse: return (timestamp, agent, type, item_id) without touching JSON\n- Full parse: also deserialize JSON payload into typed EventData\n\n# Acceptance Criteria\n- [ ] Parses valid TSJSON lines into Event structs\n- [ ] Rejects malformed lines with clear error (field count, bad timestamp, unknown type)\n- [ ] Skips/returns comment lines correctly\n- [ ] Partial parse extracts fixed fields without JSON deserialization\n- [ ] Zero-copy: parser borrows from input line where possible\n- [ ] No panics on any input (fuzz-safe)","acceptance_criteria":"Parser splits TSJSON line into fixed fields (timestamp, agent, type, item_id) without allocating\nJSON payload parsed lazily (only when accessed)\nHandles comment lines (# prefix) and empty lines gracefully\nReturns clear error with line number on malformed input\nBenchmark: parse 100k events under 50ms on Tier S corpus\nUnit tests: valid lines, malformed lines, edge cases (empty payload, unicode agent names)","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:04:26.994010470Z","created_by":"bones-dev","updated_at":"2026-02-16T04:41:41.633398808Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","events","parser","phase-1"],"dependencies":[{"issue_id":"bn-x2e.2","depends_on_id":"bn-x2e","type":"parent-child","created_at":"2026-02-16T04:04:26.994010470Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-x2e.2","depends_on_id":"bn-x2e.1","type":"blocks","created_at":"2026-02-16T04:04:53.301271039Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":30,"issue_id":"bn-x2e.2","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:04Z"}]}
{"id":"bn-x2e.3","title":"Implement TSJSON event writer/serializer","description":"# Context\nThe writer is the write path for all mutations. Serializes Event structs to TSJSON lines. Must ensure JSON payload has no literal newlines (one-event-per-line invariant).\n\n# Implementation\n- `crates/bones-core/src/event/format.rs` — write_line() / to_tsjson() function\n- Format: {timestamp}\\t{agent}\\t{type}\\t{item_id}\\t{json_data}\\n\n- JSON payload: serde_json::to_string (compact, no pretty-print)\n- Validate one-line invariant: assert no \\n in serialized JSON\n- Shard header: write `# bones event log v1` and field comment on new files\n\n# Acceptance Criteria\n- [ ] Serializes Event structs to valid TSJSON lines\n- [ ] JSON payload has no literal newlines\n- [ ] Round-trip: parse(write(event)) == event for all event types\n- [ ] Shard header written correctly on new files\n- [ ] Output is deterministic (same event always produces same line)","acceptance_criteria":"Writer produces valid TSJSON lines (tab-separated fixed fields + JSON payload)\nAppends atomically to active shard file (write + fsync)\nEnsures one-event-one-line invariant (no embedded newlines in payload)\nRound-trip: write then parse produces identical Event struct\nUnit tests: write all 11 event types, verify output format\nUnit tests: concurrent append safety (file locking or atomic write)","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:04:27.114319053Z","created_by":"bones-dev","updated_at":"2026-02-16T04:41:41.848194967Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","events","phase-1"],"dependencies":[{"issue_id":"bn-x2e.3","depends_on_id":"bn-x2e","type":"parent-child","created_at":"2026-02-16T04:04:27.114319053Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-x2e.3","depends_on_id":"bn-x2e.1","type":"blocks","created_at":"2026-02-16T04:04:53.425765329Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":31,"issue_id":"bn-x2e.3","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:04Z"}]}
{"id":"bn-x2e.4","title":"Implement item ID type with terseid generation","description":"# Context\nAll work items have a bn-XXXX identifier generated by the terseid library. The ID type is a validated newtype used throughout the codebase.\n\n# Implementation\n- `crates/bones-core/src/item_id.rs` — ItemId newtype\n- Integration with terseid crate: IdGenerator for creation, IdResolver for CLI input\n- Seed: hash of (title + nonce) -> content-based ID\n- Collision check closure queries SQLite (or HashSet during replay)\n- Validation: regex bn-[a-z0-9]+ with optional .N.N child paths\n- Display/FromStr for CLI parsing\n- terseid dependency: `terseid = { git = \"https://github.com/bobisme/terseid.git\" }`\n\n# Acceptance Criteria\n- [ ] ItemId newtype with validation (rejects invalid formats)\n- [ ] Generation via terseid produces collision-resistant IDs\n- [ ] Adaptive length grows with collection size\n- [ ] CLI resolution: partial input resolves to full ID\n- [ ] Child ID support (bn-a7x.1, bn-a7x.1.3)\n- [ ] Display/FromStr round-trip","acceptance_criteria":"ItemId type wrapping terseid-generated IDs with bn- prefix\nGeneration uses SHA256(title|nonce) seed, adaptive length based on collection size\nCollision check via closure (query SQLite projection)\nCLI resolution: partial ID input resolves to full ID via IdResolver\nChild ID support: bn-a7x.1, bn-a7x.2 etc.\nUnit tests: generation, collision avoidance, partial resolution, child IDs","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:04:46.356668470Z","created_by":"bones-dev","updated_at":"2026-02-16T04:41:42.051584269Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","events","phase-1"],"dependencies":[{"issue_id":"bn-x2e.4","depends_on_id":"bn-x2e","type":"parent-child","created_at":"2026-02-16T04:04:46.356668470Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":32,"issue_id":"bn-x2e.4","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:04Z"}]}
{"id":"bn-x2e.5","title":"Implement time-sharded event file management","description":"# Context\nEvents are stored in monthly shard files (.bones/events/YYYY-MM.events). This component manages the file layout, shard rotation, append operations, and the current.events symlink.\n\n# Implementation\n- `crates/bones-core/src/shard.rs` — ShardManager\n- Directory layout: .bones/events/YYYY-MM.events\n- current.events symlink points to active shard\n- Shard rotation: on append, check if current month differs; if so, freeze old shard, create new\n- Append: write event line + fsync for durability (atomic single-event append)\n- Replay: read all .events files in lexicographic order (YYYY-MM sorts correctly)\n- Init: create .bones/ and .bones/events/ if not present\n\n# Acceptance Criteria\n- [ ] Correct monthly shard file creation and naming\n- [ ] Symlink maintained pointing to active shard\n- [ ] Shard rotation on month boundary\n- [ ] Atomic append (write + fsync per event)\n- [ ] Replay reads all shards in chronological order\n- [ ] .bones/ directory created on first use\n- [ ] Handles empty event log (no shards yet)\n- [ ] Frozen shards are never modified","acceptance_criteria":"Events written to YYYY-MM.events shards based on timestamp\nActive shard symlinked as current.events\nShard rotation on month boundary (new shard created, symlink updated)\nPast shards treated as frozen (never modified after rotation)\nFile discovery: enumerate all .events files in chronological order\nUnit tests: shard creation, rotation, enumeration, frozen shard immutability","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:04:46.472659574Z","created_by":"bones-dev","updated_at":"2026-02-16T04:41:42.238966121Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","events","phase-1","storage"],"dependencies":[{"issue_id":"bn-x2e.5","depends_on_id":"bn-x2e","type":"parent-child","created_at":"2026-02-16T04:04:46.472659574Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-x2e.5","depends_on_id":"bn-x2e.3","type":"blocks","created_at":"2026-02-16T04:04:53.544207319Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":33,"issue_id":"bn-x2e.5","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:04Z"}]}
{"id":"bn-xrg","title":"Redaction completeness verification","description":"# Context\n\nRedaction is only trustworthy if removed content cannot be recovered from any storage/index path. This bead verifies end-to-end redaction completeness.\n\n# Scope\n\n- Verify post-redaction state across event payload views, projection rows, FTS indexes, vector/caches\n- `bn redact-verify <item-id>` command for targeted checks\n- Negative tests ensuring redacted payloads are not queryable/reconstructible\n- Diagnostic reporting of any residual content paths\n\n# Acceptance Criteria\n\n- [ ] Redacted content is absent from all supported query surfaces\n- [ ] Verification command produces deterministic pass/fail diagnostics\n- [ ] False negatives are guarded by fixture-driven regression tests\n- [ ] Verification remains safe on large datasets\n- [ ] Coverage path is explicit: unit (redaction-propagation tests), e2e/workflow (bn-zr8 + bn-3ls redaction scenarios), diagnostics/log artifacts (bn-m80 + bn-1js)\n","acceptance_criteria":"Verify all item.redact events have corresponding redacted projections\nDetect events referenced by redact that are missing from the log\nReport: count of redacted events, any unprocessed redactions\nbn verify --redaction flag or included in default verify\nUnit tests: verify catches missed redactions, clean log passes","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:40:58.178741262Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:24.510295202Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["crdt","phase-2","security"],"dependencies":[{"issue_id":"bn-xrg","depends_on_id":"bn-2lv","type":"parent-child","created_at":"2026-02-16T03:09:21.395530941Z","created_by":"1","metadata":"{}","thread_id":""},{"issue_id":"bn-xrg","depends_on_id":"bn-2y3","type":"blocks","created_at":"2026-02-16T02:41:27.810213984Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-xrg","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T02:41:27.919824478Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-yot","title":"[track] Phase 1 test suite: core engine correctness","description":"# Context\n\nPhase 1 correctness depends on a coordinated test suite spanning parser, clock, replay pipeline, and core CLI workflows. This track keeps those validations cohesive.\n\n# Scope\n\n- Unit tests for TSJSON, ITC, DAG/CRDT basics, projection/model invariants\n- Integration tests for full replay pipeline (events -> DAG -> CRDT -> SQLite)\n- Core lifecycle CLI e2e workflows\n- Edge-case matrices and determinism fixtures\n\n# Exit Criteria\n\n- [ ] Child beads bn-yot.1 through bn-yot.5 are completed\n- [ ] Deterministic replay and core CLI workflow confidence gates pass in CI\n- [ ] Coverage path is explicit: unit/integration/e2e split across child beads, diagnostics/log artifacts via bn-1js + bn-m80\n\n# Notes\n\nThis is a planning track; implementation and execution happen in child beads.","acceptance_criteria":"All 5 test children (yot.1-yot.5) complete and passing\nTest suite covers: TSJSON parsing, ITC operations, event replay pipeline, CLI lifecycle, edge cases\nTests run in CI and complete within 60 seconds total\nNo flaky tests (deterministic seeds for any randomized tests)","status":"open","priority":1,"issue_type":"track","created_at":"2026-02-16T02:36:20.941447605Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:44.231135277Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase-1","testing","track"],"dependencies":[{"issue_id":"bn-yot","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T03:09:01.331716307Z","created_by":"1","metadata":"{}","thread_id":""}]}
{"id":"bn-yot.1","title":"Unit tests for TSJSON parser: round-trip, malformed input, edge cases","description":"# Context\n\nThe TSJSON parser is the entry point for all data. Bugs here corrupt everything downstream.\n\n# Scope\n\n- Round-trip tests: parse(write(event)) == event for every event type\n- Malformed input: missing tabs, wrong field count, invalid JSON payload, non-UTF8, empty lines, lines with only whitespace\n- Boundary values: maximum-length titles (64KB description), empty strings, unicode edge cases (emoji, RTL, zero-width chars), timestamps at epoch 0 and far future\n- Comment lines: # at start, # mid-file, empty comment, comment-only file\n- Partial parse: verify fixed fields extracted without JSON parsing\n- Performance: parse throughput regression test at Tier S\n\n# Acceptance Criteria\n\n- [ ] 100% event type coverage in round-trip tests\n- [ ] Every malformed input case produces a clear error (not a panic)\n- [ ] Unicode edge cases handled correctly\n- [ ] Golden-file tests for 20+ representative events","acceptance_criteria":"TSJSON parser round-trip tests for all 11 event types\nMalformed input tests: missing fields, bad JSON, truncated lines, invalid timestamp\nEdge cases: empty payload, maximum length fields, unicode in all positions\nFuzz-style tests with random valid/invalid inputs\nAll tests deterministic and fast (<5s total)","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-16T02:36:21.109121370Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:44.358021924Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["parser","phase-1","testing"],"dependencies":[{"issue_id":"bn-yot.1","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:36:28.393369012Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-yot.1","depends_on_id":"bn-yot","type":"parent-child","created_at":"2026-02-16T02:36:21.109121370Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-yot.2","title":"Unit tests for ITC: fork/join roundtrip, causal ordering, serialization","description":"# Scope\n\n- fork/join roundtrip: fork then join recovers original interval\n- Monotonicity: event() always increases the stamp\n- Transitivity: if a <= b and b <= c then a <= c\n- Concurrency detection: concurrent stamps are correctly identified\n- Multi-agent scenarios: 2, 4, 8, 16 agents forking/joining/eventing\n- Serialization roundtrip at various tree depths\n- Edge cases: single agent (full interval), maximum fork depth, join of already-joined stamps\n- Size regression: serialized stamp <= 50 bytes for <= 8 active agents\n\n# Acceptance Criteria\n\n- [ ] Property tests pass for all ITC operations\n- [ ] Multi-agent lifecycle scenarios (fork, work, retire, replace) produce correct ordering\n- [ ] Serialization size stays within budget","acceptance_criteria":"ITC fork/join roundtrip: fork then join produces equivalent stamp\nCausal ordering: chain of events produces correct leq relationships\nSerialization roundtrip: serialize then deserialize produces identical stamp\nConcurrent detection: two forked stamps that diverge are detected as concurrent\nProperty tests: fork/join/event preserve ITC invariants","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-16T02:36:21.240788516Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:44.484600725Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["clocks","phase-1","testing"],"dependencies":[{"issue_id":"bn-yot.2","depends_on_id":"bn-2zf","type":"blocks","created_at":"2026-02-16T02:36:28.500045742Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-yot.2","depends_on_id":"bn-yot","type":"parent-child","created_at":"2026-02-16T02:36:21.240788516Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-yot.3","title":"Integration tests: event replay pipeline (events -> DAG -> CRDT -> SQLite)","description":"# Context\n\nThe replay pipeline is the critical path: TSJSON events are parsed, built into a DAG, replayed through CRDTs, and projected to SQLite. End-to-end correctness of this pipeline must be verified.\n\n# Scope\n\n- Linear event sequences: create -> update -> move -> done, verify SQLite state\n- Branching: two agents create events concurrently, merge, verify converged state\n- All event types: verify each event type correctly affects SQLite projection\n- Incremental replay: verify single-event append matches full replay\n- Rebuild: verify bn rebuild produces identical DB from same events\n- Determinism: same events in different orders produce identical SQLite state\n\n# Acceptance Criteria\n\n- [ ] 10+ scenario tests covering all event types\n- [ ] At least 3 concurrent-agent merge scenarios\n- [ ] Rebuild determinism verified (hash of DB matches)\n- [ ] Incremental vs full replay equivalence verified","acceptance_criteria":"Pipeline test: generate events -> replay via DAG -> apply CRDTs -> project to SQLite -> verify\nMulti-agent test: two agents generate concurrent events, merge, verify convergence\nOrdering test: same events in different orders produce identical projection\nIdempotence test: replaying duplicate events produces same result\nRedaction test: redacted events have [redacted] payload in projection","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-16T02:36:21.350355612Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:44.612914187Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["integration","phase-1","testing"],"dependencies":[{"issue_id":"bn-yot.3","depends_on_id":"bn-2y3","type":"blocks","created_at":"2026-02-16T02:36:28.709813633Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-yot.3","depends_on_id":"bn-yot","type":"parent-child","created_at":"2026-02-16T02:36:21.350355612Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-yot.3","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T02:36:28.603334834Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-yot.4","title":"E2E CLI lifecycle workflows: create->do->done, goals, tags","description":"# Context\n\nEnd-to-end subprocess tests for the **core lifecycle surface** delivered by bn-2da. These tests validate what users and agents do most often in day-to-day flow.\n\n# Scope\n\n- Basic lifecycle: `bn create` -> `bn do` -> `bn done`, verify `bn list`/`bn show`\n- Goal hierarchy basics: create goal, add/reparent children, verify containment visibility\n- Tag workflow: `bn tag`, `bn untag`, and list filtering by tag\n- JSON contract checks for every lifecycle command in scope\n- Error-path checks: invalid kind/state, invalid IDs, duplicate transitions, missing items\n\n# Explicitly Out of Scope\n\n- Goal auto-close/reopen policy behavior -> bn-3lp + bn-2yo\n- Dependency command e2e (`bn dep`, link aliases) -> bn-3i7\n- Operational command e2e (`search`/`export`/`verify`/`stats`/`history`) -> bn-36d\n\n# Acceptance Criteria\n\n- [ ] Happy-path lifecycle workflows pass in isolated temp repos\n- [ ] All scoped `--json` outputs parse and satisfy schema expectations\n- [ ] Error paths return non-zero exit codes with actionable messages\n- [ ] Failed tests capture reproducible diagnostics (logs + command traces)\n- [ ] Coverage path is explicit: unit (bn-2da handlers), e2e (this bead), diagnostics artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"Create workflow: bn create -> bn show -> verify item exists with correct fields\nLifecycle workflow: create -> do -> done -> verify state transitions and events\nGoal workflow: create goal -> create children -> done all children -> verify auto-close\nTag workflow: create -> tag -> untag -> verify label state\nAll workflows tested via CLI binary (subprocess execution)","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-16T02:36:21.459014145Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:44.749711806Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","e2e","phase-1","testing"],"dependencies":[{"issue_id":"bn-yot.4","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T02:36:28.815668322Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-yot.4","depends_on_id":"bn-yot","type":"parent-child","created_at":"2026-02-16T02:36:21.459014145Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-yot.5","title":"Edge case tests: concurrent mutations, empty state, boundary values","description":"# Context\n\nCRDTs handle concurrent mutations, but the specific edge cases must be verified explicitly. These are the scenarios that break naive implementations.\n\n# Scope\n\n## Concurrent mutation matrix\n- Two agents update same LWW field with identical timestamps and different values\n- Two agents add same label concurrently (OR-Set idempotence)\n- One agent adds label, another removes same label concurrently (OR-Set convergence)\n- Two agents move same item to different states concurrently (epoch+phase resolution)\n- Agent A does item, Agent B dones same item concurrently\n- Two agents create items with same content (different hashes = different items)\n- Agent closes goal while another adds new child concurrently (reopen trigger)\n\n## Empty state\n- Empty event log: bn list, bn next, bn triage, bn health all work\n- Single item, no deps: bn next recommends it\n- Goal with zero children: progress shows 0/0\n\n## Boundary values\n- Item with 64KB description (in a single JSON string with \\n escapes)\n- 10,000+ labels on single item\n- 1000-deep goal nesting\n- Circular blocking dependencies (detected and reported)\n- Item ID collision (content hash) — verify structural impossibility or graceful handling\n\n# Acceptance Criteria\n\n- [ ] Every concurrent mutation scenario converges to deterministic state\n- [ ] Empty state produces no crashes and reasonable output\n- [ ] Boundary values handled without panics or OOM","acceptance_criteria":"Concurrent mutations: two agents mutate same item simultaneously -> verify CRDT convergence\nEmpty state: operations on fresh DB work correctly (no items, no events)\nBoundary values: maximum title length, zero-length description, many labels on one item\nLarge comment: very long comment body preserved correctly\nStress: 1000 items created rapidly, verify all present in projection","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-16T02:36:21.562499545Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:44.889102606Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge-cases","phase-1","testing"],"dependencies":[{"issue_id":"bn-yot.5","depends_on_id":"bn-1nr","type":"blocks","created_at":"2026-02-16T02:36:29.029029025Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-yot.5","depends_on_id":"bn-2y3","type":"blocks","created_at":"2026-02-16T02:36:28.919354718Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-yot.5","depends_on_id":"bn-yot","type":"parent-child","created_at":"2026-02-16T02:36:21.562499545Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-z23","title":"Implement SQLite projection layer with FTS5","description":"# Context\n\nSQLite is the disposable read-optimized projection of CRDT state. It provides structured queries, FTS5 keyword search, and the relational model for filtering/joins. Rebuilt from the event log on demand.\n\n# Goals\n\n- Define SQLite schema for work items, labels, dependencies, comments\n- Implement event replay -> SQLite projection pipeline\n- Implement FTS5 index with BM25 weighted search\n- Implement bn rebuild command\n- Ensure projection is fully disposable and reproducible\n\n# Background\n\nSQLite handles: structured queries (WHERE state='open' AND kind='bug'), aggregations, relational joins (items->labels, items->deps), and FTS5 BM25 keyword search. It does NOT handle semantic search (Phase 3).\n\nFTS5 config: porter stemmer, unicode61 tokenizer, prefix indexes 2,3, weighted columns (title 3x, description 2x, labels 1x).\n\n# Implementation Approach\n\n## Key Components\n\n1. Schema: items table (id, title, description, kind, state, epoch, phase, size, urgency, parent_id, created_at, updated_at), item_labels (item_id, label), item_deps (item_id, dep_id, dep_type), item_assignees (item_id, actor), item_comments (item_id, event_hash, body, author, ts)\n2. FTS5: items_fts virtual table on title + description + labels\n3. Projection pipeline: replay events in order, apply CRDT state to SQL rows, rebuild FTS index\n4. Incremental update: apply single new event to existing projection (optimization)\n5. bn rebuild: drop and recreate all tables from event log\n\n## Files to Create/Modify\n\n- crates/bones-core/src/db/schema.rs — Schema definitions and migrations\n- crates/bones-core/src/db/project.rs — Event -> SQLite projection logic\n- crates/bones-core/src/db/query.rs — Query helpers\n- crates/bones-core/src/db/fts.rs — FTS5 search\n- crates/bones-core/src/db/mod.rs — Module and connection management\n\n## Acceptance Criteria\n\n- [ ] Schema created correctly on init\n- [ ] Full event replay produces correct SQLite state\n- [ ] Incremental event application matches full replay\n- [ ] FTS5 search returns BM25-ranked results with correct weights\n- [ ] bn rebuild produces identical DB from same event log\n- [ ] Handles all event types (create, update, move, assign, comment, link, unlink, delete, compact, snapshot, redact)\n- [ ] Redacted events show [redacted] in projection\n- [ ] Benchmarks: rebuild time at Tier S/M/L\n\n# How This Serves Overarching Goals\n\nSQLite projection makes \"events are truth, everything else is a projection\" real. Disposable, reproducible, fast for structured queries.","acceptance_criteria":"All 5 children (z23.1-z23.5) complete and passing tests\nEvent replay produces correct SQLite projection\nFTS5 search returns relevant results with BM25 ranking\nbn rebuild produces identical projection from scratch\nIntegration test: event sequence -> projection -> query -> verify","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-16T02:22:29.502345728Z","created_by":"bones-dev","updated_at":"2026-02-16T04:43:21.849246253Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","phase-1","projection","sqlite"],"dependencies":[{"issue_id":"bn-z23","depends_on_id":"bn-2h9","type":"blocks","created_at":"2026-02-16T04:25:35.061646128Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-z23","depends_on_id":"bn-2y3","type":"blocks","created_at":"2026-02-16T02:26:50.106460718Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-z23","depends_on_id":"bn-38t","type":"blocks","created_at":"2026-02-16T02:42:41.156691516Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-z23","depends_on_id":"bn-3m6","type":"blocks","created_at":"2026-02-16T02:26:50.217602311Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-z23","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:26:49.999547016Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":12,"issue_id":"bn-z23","author":"1","text":"Critical review pass: user value = responsive user queries and reliable rebuildable read model over immutable events. Failure modes = replay/projection mismatch, silent index drift, and FTS ranking regressions harming discovery. Alternative considered: querying raw event log directly; rejected due poor query performance and complex filter logic. Chosen approach: disposable SQLite projection with deterministic replay and weighted FTS5. Coverage path: unit verification in-bead projection/query tests + bn-38t migration tests, e2e/workflow bn-yot.3 + bn-yot.4, diagnostics/log artifacts bn-m80 + bn-1js.","created_at":"2026-02-16T02:59:10Z"}]}
{"id":"bn-z23.1","title":"Define SQLite schema: items, labels, deps, comments, assignees tables","description":"# Context\nThe SQLite schema is the relational representation of CRDT state. Disposable and rebuilt from events, but must be correct and queryable.\n\n# Implementation\n- `crates/bones-core/src/db/schema.rs`\n- Tables: items (id, title, description, kind, state, epoch, phase, size, urgency, parent_id, created_at, updated_at), item_labels (item_id, label), item_deps (item_id, dep_id, dep_type), item_assignees (item_id, agent), item_comments (item_id, event_hash, body, author, ts)\n- Indexes on: items(state), items(kind), items(parent_id), item_labels(label), item_deps(dep_id)\n- Schema versioning for future migrations\n\n# Acceptance Criteria\n- [ ] All tables created with correct columns and types\n- [ ] Indexes created for common query patterns\n- [ ] Schema version tracked for migration support\n- [ ] CREATE TABLE statements are idempotent (IF NOT EXISTS)","acceptance_criteria":"Tables: items, labels, deps, comments, assignees with all columns per plan\nIndexes on frequently queried columns (state, kind, urgency, parent_id)\nSchema version tracking for future migrations\nFTS5 virtual table configuration included\nUnit tests: schema creation, index verification, version tracking","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:06:20.883274456Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:21.732281626Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","phase-1","sqlite"],"dependencies":[{"issue_id":"bn-z23.1","depends_on_id":"bn-z23","type":"parent-child","created_at":"2026-02-16T04:06:20.883274456Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":39,"issue_id":"bn-z23.1","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:05Z"}]}
{"id":"bn-z23.2","title":"Implement event replay -> SQLite projection pipeline","description":"# Context\nThe projection pipeline replays events in order and writes the resulting CRDT state to SQLite rows. This is the core path that makes events queryable.\n\n# Implementation\n- `crates/bones-core/src/db/project.rs` — Projector\n- For each event: apply to in-memory CRDT state (WorkItemState), then upsert SQLite rows\n- Handle all 11 event types: create (INSERT), update (UPDATE field), move (UPDATE state), assign (INSERT/DELETE assignee), comment (INSERT comment), link (INSERT dep), unlink (DELETE dep), delete (UPDATE deleted flag), compact (replace description), snapshot (full state replace), redact (replace payload with [redacted])\n- Incremental mode: apply single new event to existing projection\n- Full rebuild mode: drop all tables, replay all events\n\n# Acceptance Criteria\n- [ ] All 11 event types correctly projected to SQL rows\n- [ ] Incremental apply matches full replay result\n- [ ] Redacted events show [redacted] in projection\n- [ ] Deleted items marked (soft delete), not removed\n- [ ] Projection is deterministic (same events → same SQL state)","acceptance_criteria":"Replay all events from .events files into SQLite projection\nEach event type maps to appropriate SQL INSERT/UPDATE/DELETE\nMaintains high-water mark (last processed event hash) for incremental replay\nHandles all 11 event types including redact (replaces payload with [redacted])\nTransaction batching for performance (commit every N events)\nUnit tests: replay event sequence, verify projection matches expected state","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:06:21.001157579Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:21.877146207Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","phase-1","sqlite"],"dependencies":[{"issue_id":"bn-z23.2","depends_on_id":"bn-z23","type":"parent-child","created_at":"2026-02-16T04:06:21.001157579Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-z23.2","depends_on_id":"bn-z23.1","type":"blocks","created_at":"2026-02-16T04:06:27.020895428Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":40,"issue_id":"bn-z23.2","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:05Z"}]}
{"id":"bn-z23.3","title":"Implement FTS5 full-text search with BM25 ranking","description":"# Context\nFTS5 provides lexical keyword search (Layer 1 of the three-layer search engine). Sub-1ms, catches exact matches, IDs, error codes.\n\n# Implementation\n- `crates/bones-core/src/db/fts.rs`\n- FTS5 virtual table: items_fts(title, description, labels)\n- Tokenizer: unicode61 with porter stemmer\n- Column weights: title 3x, description 2x, labels 1x (via BM25 rank function)\n- Prefix indexes: 2,3 characters\n- Sync: update FTS on item create/update/delete\n- Query: `bn search \"query\"` searches FTS5 with BM25 ranking\n\n# Acceptance Criteria\n- [ ] FTS5 virtual table created and populated\n- [ ] BM25 ranking with correct column weights\n- [ ] Porter stemming works (search \"running\" finds \"run\")\n- [ ] Prefix search works (search \"auth\" finds \"authentication\")\n- [ ] FTS updated on item create/update\n- [ ] Sub-1ms query time at Tier S (1k items)","acceptance_criteria":"FTS5 virtual table indexing title (3x weight), description (2x weight), labels (1x weight)\nPorter stemming and unicode tokenizer enabled\nBM25 ranking for search result ordering\nPrefix search support for partial queries\nProjection updates keep FTS5 index in sync\nUnit tests: keyword search, stemmed matches, weighted ranking verification","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:06:21.120133623Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:22.020356387Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","phase-1","search","sqlite"],"dependencies":[{"issue_id":"bn-z23.3","depends_on_id":"bn-z23","type":"parent-child","created_at":"2026-02-16T04:06:21.120133623Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-z23.3","depends_on_id":"bn-z23.1","type":"blocks","created_at":"2026-02-16T04:06:27.132602960Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":41,"issue_id":"bn-z23.3","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:05Z"}]}
{"id":"bn-z23.4","title":"Implement SQLite query helpers and connection management","description":"# Context\nReusable query layer for CLI commands and triage engine. Handles connection pooling, WAL mode, and common query patterns.\n\n# Implementation\n- `crates/bones-core/src/db/query.rs` — Query helpers\n- `crates/bones-core/src/db/mod.rs` — Connection management, WAL mode\n- Common queries: list_items(filters), get_item(id), search(query), get_deps(id), get_children(parent_id), get_labels(id), get_comments(id)\n- Filter support: by state, kind, label, urgency, assignee, parent\n- Sorting: by created_at, updated_at, priority (for later triage integration)\n- Connection: WAL mode for concurrent readers, bundled SQLite via rusqlite\n\n# Acceptance Criteria\n- [ ] All common query patterns implemented\n- [ ] Filter by state, kind, label, urgency, assignee\n- [ ] WAL mode enabled for concurrent access\n- [ ] Connection handles graceful recovery from missing/corrupt DB\n- [ ] Queries return typed Rust structs (not raw rows)","acceptance_criteria":"Connection management with WAL mode enabled\nQuery builder helpers for common operations (list items, get by id, filter by state/label/kind)\nParameterized queries throughout (no SQL injection)\nError handling: missing DB file, corrupt DB, locked DB\nUnit tests: CRUD operations, filter queries, error cases","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:06:21.234761172Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:22.179687551Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["core","phase-1","sqlite"],"dependencies":[{"issue_id":"bn-z23.4","depends_on_id":"bn-z23","type":"parent-child","created_at":"2026-02-16T04:06:21.234761172Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-z23.4","depends_on_id":"bn-z23.1","type":"blocks","created_at":"2026-02-16T04:06:27.251347629Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":42,"issue_id":"bn-z23.4","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:05Z"}]}
{"id":"bn-z23.5","title":"Implement bn rebuild: full projection reconstruction from events","description":"# Context\n`bn rebuild` drops and recreates the entire SQLite DB from the event log. Proves the projection is disposable and reproducible.\n\n# Implementation\n- Drop existing DB file\n- Create fresh schema\n- Replay all events through projection pipeline\n- Rebuild FTS5 index\n- Report: event count, item count, elapsed time\n\n# Acceptance Criteria\n- [ ] Rebuild produces identical DB from same event log (deterministic)\n- [ ] FTS5 index fully rebuilt\n- [ ] Reports event/item count and elapsed time\n- [ ] Handles empty event log (creates empty DB)\n- [ ] Performance: Tier S rebuild < 1s, Tier M rebuild < 10s","acceptance_criteria":"bn rebuild drops and recreates SQLite DB from event log\nReplays all events from all shards in chronological order\nRebuilds FTS5 index\nReports progress (event count, time elapsed)\nProduces identical projection regardless of when run\nUnit tests: rebuild produces same state as incremental replay","status":"open","priority":1,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T04:06:21.347868339Z","created_by":"bones-dev","updated_at":"2026-02-16T04:42:22.348324551Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","core","phase-1","sqlite"],"dependencies":[{"issue_id":"bn-z23.5","depends_on_id":"bn-z23","type":"parent-child","created_at":"2026-02-16T04:06:21.347868339Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-z23.5","depends_on_id":"bn-z23.2","type":"blocks","created_at":"2026-02-16T04:06:27.371883577Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-z23.5","depends_on_id":"bn-z23.3","type":"blocks","created_at":"2026-02-16T04:06:27.487106362Z","created_by":"bones-dev","metadata":"{}","thread_id":""}],"comments":[{"id":43,"issue_id":"bn-z23.5","author":"bones-dev","text":"AGENT REQUIREMENT: Ship unit tests alongside implementation. Every public function must have at least one test. Acceptance criteria include passing tests. Do not close this bead without tests.","created_at":"2026-02-16T04:25:05Z"}]}
{"id":"bn-zlz","title":"Comment timeline commands (add/list) with audit metadata","description":"# Context\n\nComments are key collaboration artifacts for humans and agents. This bead adds durable comment timelines with consistent attribution and machine-readable output.\n\n# Scope\n\n- `bn comment add <id> <message>` with actor/timestamp attribution\n- `bn comment list <id>` ordered timeline output (text + JSON)\n- Integration into `bn show` detail output\n- Validation rules for message size and control characters\n\n# Acceptance Criteria\n\n- [ ] Comments append as immutable events and replay deterministically\n- [ ] Timeline ordering is deterministic for concurrent writers\n- [ ] `bn show` includes comment summaries without data loss\n- [ ] JSON output is stable for automation consumers\n- [ ] Coverage path is explicit: unit (comment event + ordering tests), e2e/workflow (bn-2yo), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"bn comments add <id> <body> adds comment with agent and timestamp\nbn comments list <id> shows comment timeline with agent attribution\nComments include audit metadata (agent, timestamp, event hash)\nComments are append-only (G-Set, no delete/edit)\nUnit tests: add comment, list timeline, audit metadata present","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:42:34.969841496Z","created_by":"bones-dev","updated_at":"2026-02-16T04:44:42.843568433Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase-2"],"dependencies":[{"issue_id":"bn-zlz","depends_on_id":"bn-2da","type":"blocks","created_at":"2026-02-16T03:13:52.215398218Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-zlz","depends_on_id":"bn-2y3","type":"blocks","created_at":"2026-02-16T02:42:48.403689901Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-zlz","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:42:48.516609693Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
{"id":"bn-zr8","title":"Fault-injection validation for crash recovery paths","description":"# Context\n\nRecovery behavior is defined in bn-3fs.2. This bead focuses on proving those guarantees under realistic crash/fault scenarios so regressions are caught early.\n\n# Scope\n\n- Process-kill simulations during event append (partial TSJSON line scenarios)\n- Corrupt shard and projection-drift injection scenarios\n- Startup recovery assertions (truncate/repair/rebuild behavior)\n- Reproducible fault fixtures with deterministic seeds\n\n# Acceptance Criteria\n\n- [ ] Mid-write crash scenarios recover without panics or silent data corruption\n- [ ] Corrupt shard + stale projection scenarios produce deterministic remediation behavior\n- [ ] Fault fixtures are reproducible in CI/local runs\n- [ ] Diagnostic artifacts (recovery logs + traces) are captured on failure\n- [ ] Coverage path is explicit: unit (recovery helper tests), e2e/workflow (fault-injection scenarios in this bead), diagnostics/log artifacts (bn-1js + bn-m80)\n","acceptance_criteria":"Inject crash during event write: verify recovery on restart\nInject corrupt shard: verify detection and graceful handling\nInject missing SQLite DB: verify auto-rebuild\nInject partial write (truncated last line): verify clean recovery\nAll fault scenarios produce actionable error messages","status":"open","priority":2,"issue_type":"task","owner":"bones-dev","created_at":"2026-02-16T02:43:12.291242981Z","created_by":"bones-dev","updated_at":"2026-02-16T04:45:39.500670670Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["cross-cutting","edge-case","phase-2","reliability"],"dependencies":[{"issue_id":"bn-zr8","depends_on_id":"bn-1js","type":"blocks","created_at":"2026-02-16T03:15:00.536295536Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-zr8","depends_on_id":"bn-3fs","type":"parent-child","created_at":"2026-02-16T03:15:00.756969327Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-zr8","depends_on_id":"bn-3fs.2","type":"blocks","created_at":"2026-02-16T03:15:00.425255441Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-zr8","depends_on_id":"bn-m80","type":"blocks","created_at":"2026-02-16T03:15:00.646493381Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-zr8","depends_on_id":"bn-x2e","type":"blocks","created_at":"2026-02-16T02:43:33.007920852Z","created_by":"bones-dev","metadata":"{}","thread_id":""},{"issue_id":"bn-zr8","depends_on_id":"bn-z23","type":"blocks","created_at":"2026-02-16T02:43:33.115205190Z","created_by":"bones-dev","metadata":"{}","thread_id":""}]}
